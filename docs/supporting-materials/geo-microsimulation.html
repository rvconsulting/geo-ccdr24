<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Renato Vargas">

<title>Georgia CCDR Microsimulation – Georgia CCDR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-86daaaaad7353f9cc0c554efc1dd6d94.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6d64e0474c8223c8682d0bdb31002d9b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Georgia CCDR</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Supporting materials</a></li><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Georgia CCDR Microsimulation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Supporting materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/geo-microsimulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Georgia CCDR Microsimulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/sam-lfs-data-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAM Labor Force Survey Data Request</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/sam-shares-data-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAM Shares Data Request</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/vulnerability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vulnerability Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#preamble" id="toc-preamble" class="nav-link" data-scroll-target="#preamble"><span class="header-section-number">1.1</span> Preamble</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><span class="header-section-number">1.2</span> Datasets</a></li>
  </ul></li>
  <li><a href="#data-preparation-demographic-characteristics-income-outliers-and-missings" id="toc-data-preparation-demographic-characteristics-income-outliers-and-missings" class="nav-link" data-scroll-target="#data-preparation-demographic-characteristics-income-outliers-and-missings"><span class="header-section-number">2</span> Data preparation, demographic characteristics, income outliers and missings</a>
  <ul class="collapse">
  <li><a href="#skill-level" id="toc-skill-level" class="nav-link" data-scroll-target="#skill-level"><span class="header-section-number">2.1</span> Skill level</a></li>
  <li><a href="#labor-status-and-economic-activities" id="toc-labor-status-and-economic-activities" class="nav-link" data-scroll-target="#labor-status-and-economic-activities"><span class="header-section-number">2.2</span> Labor status and Economic Activities</a></li>
  <li><a href="#types-of-income" id="toc-types-of-income" class="nav-link" data-scroll-target="#types-of-income"><span class="header-section-number">2.3</span> Types of income</a></li>
  <li><a href="#missing-and-outliers" id="toc-missing-and-outliers" class="nav-link" data-scroll-target="#missing-and-outliers"><span class="header-section-number">2.4</span> Missing and outliers</a></li>
  <li><a href="#the-income-simulation-regression" id="toc-the-income-simulation-regression" class="nav-link" data-scroll-target="#the-income-simulation-regression"><span class="header-section-number">2.5</span> The income simulation regression</a>
  <ul class="collapse">
  <li><a href="#total-income-and-shares" id="toc-total-income-and-shares" class="nav-link" data-scroll-target="#total-income-and-shares"><span class="header-section-number">2.5.1</span> Total income and shares</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#un-population-projections" id="toc-un-population-projections" class="nav-link" data-scroll-target="#un-population-projections"><span class="header-section-number">3</span> UN Population Projections</a></li>
  <li><a href="#macro-scenarios" id="toc-macro-scenarios" class="nav-link" data-scroll-target="#macro-scenarios"><span class="header-section-number">4</span> Macro Scenarios</a></li>
  <li><a href="#reweighting-of-the-dataset" id="toc-reweighting-of-the-dataset" class="nav-link" data-scroll-target="#reweighting-of-the-dataset"><span class="header-section-number">5</span> Reweighting of the dataset</a>
  <ul class="collapse">
  <li><a href="#aggregation-of-population-data" id="toc-aggregation-of-population-data" class="nav-link" data-scroll-target="#aggregation-of-population-data"><span class="header-section-number">5.1</span> Aggregation of population data</a></li>
  <li><a href="#reweigting" id="toc-reweigting" class="nav-link" data-scroll-target="#reweigting"><span class="header-section-number">5.2</span> Reweigting</a></li>
  </ul></li>
  <li><a href="#rescaling-labor-income-according-to-changes-to-the-wage-bill" id="toc-rescaling-labor-income-according-to-changes-to-the-wage-bill" class="nav-link" data-scroll-target="#rescaling-labor-income-according-to-changes-to-the-wage-bill"><span class="header-section-number">6</span> Rescaling labor income according to changes to the wage bill</a></li>
  <li><a href="#microsimulations" id="toc-microsimulations" class="nav-link" data-scroll-target="#microsimulations"><span class="header-section-number">7</span> Microsimulations</a>
  <ul class="collapse">
  <li><a href="#macro-scenarios-without-additional-impacts" id="toc-macro-scenarios-without-additional-impacts" class="nav-link" data-scroll-target="#macro-scenarios-without-additional-impacts"><span class="header-section-number">7.1</span> Macro scenarios without additional impacts</a></li>
  <li><a href="#climate-change" id="toc-climate-change" class="nav-link" data-scroll-target="#climate-change"><span class="header-section-number">7.2</span> Climate change</a></li>
  </ul></li>
  <li><a href="#poverty-tabulates" id="toc-poverty-tabulates" class="nav-link" data-scroll-target="#poverty-tabulates"><span class="header-section-number">8</span> Poverty tabulates</a></li>
  <li><a href="#maps" id="toc-maps" class="nav-link" data-scroll-target="#maps"><span class="header-section-number">9</span> Maps</a></li>
  <li><a href="#save-to-excel" id="toc-save-to-excel" class="nav-link" data-scroll-target="#save-to-excel"><span class="header-section-number">10</span> Save to Excel</a></li>
  <li><a href="#end" id="toc-end" class="nav-link" data-scroll-target="#end"><span class="header-section-number">11</span> End</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/rvconsulting/geo-ccdr24/blob/master/supporting-materials/geo-microsimulation.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rvconsulting/geo-ccdr24/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Supporting materials</a></li><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Georgia CCDR Microsimulation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Georgia CCDR Microsimulation</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Renato Vargas <a href="mailto:renovargas@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Consultant for The World Bank
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this calculation file, we “age” the Georgian household survey according to demographic projections and different macroeconomic scenarios to explore the impact of climate-related risks and policy measures on the consumption expenditure distribution. It is part of a larger project with all background contributions to Georgia’s CCDR, <a href="https://rvconsulting.github.io/geo-ccdr24/supporting-materials/geo-microsimulation.html">available in this repository</a>.</p>
<p>Using RStudio project makes it possible to not use <code>setwd()</code> to establish the root directory and refer to subdirectories in a relative manner, making interoperability easier within teams and not hard coding a particular computer’s file structure into the code. If you are using Positron or Visual Studio Code (and the Quarto extension) just “open folder” at the root of the repository. If you are using R directly, just add <code>setwd(r'(C:\My\path\to\project\root)')</code> at the beginning of your coding session.</p>
<section id="preamble" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="preamble"><span class="header-section-number">1.1</span> Preamble</h2>
<p>We start with a clean environment, making sure that any objects from a previous session are not present. We keep our country ISO code in a variable <code>iso</code> in case we need it later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean workspace</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Georgia country ISO code</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="st">"GEO"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey year</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>survey_year <span class="ot">&lt;-</span> <span class="dv">2023</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Exchange rate USD per GEL</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>er <span class="ot">&lt;-</span> <span class="fl">0.37</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Years of interest for our macroeconomic scenario analysis</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>analysis_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We call the appropriate libraries.</p>
<p>Rather than calling our libraries as we go, we will make sure we have everything we need from the beginning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-load-packages"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-load-packages-1"><a href="#lst-load-packages-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># includes dplyr, ggplot2, purr...</span></span>
<span id="lst-load-packages-2"><a href="#lst-load-packages-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)     <span class="co"># to read SPSS and Stata datasets</span></span>
<span id="lst-load-packages-3"><a href="#lst-load-packages-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)    <span class="co"># to read from MS-Excel</span></span>
<span id="lst-load-packages-4"><a href="#lst-load-packages-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)  <span class="co"># to write to MS-Excel.</span></span>
<span id="lst-load-packages-5"><a href="#lst-load-packages-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># pretty tables</span></span>
<span id="lst-load-packages-6"><a href="#lst-load-packages-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)       <span class="co"># companion to applied regression</span></span>
<span id="lst-load-packages-7"><a href="#lst-load-packages-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)    <span class="co"># regression models</span></span>
<span id="lst-load-packages-8"><a href="#lst-load-packages-8" aria-hidden="true" tabindex="-1"></a><span class="co">#library(anesrake)  </span></span>
<span id="lst-load-packages-9"><a href="#lst-load-packages-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Raking reweighting but we don't load it, because </span></span>
<span id="lst-load-packages-10"><a href="#lst-load-packages-10" aria-hidden="true" tabindex="-1"></a><span class="co"># it changes the meaning of summarize from dplyr, </span></span>
<span id="lst-load-packages-11"><a href="#lst-load-packages-11" aria-hidden="true" tabindex="-1"></a><span class="co"># so we use the form anesrake::anesrake() when using it.</span></span>
<span id="lst-load-packages-12"><a href="#lst-load-packages-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)   <span class="co"># pretty subtotals</span></span>
<span id="lst-load-packages-13"><a href="#lst-load-packages-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="co"># More regressions</span></span>
<span id="lst-load-packages-14"><a href="#lst-load-packages-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)       <span class="co"># Calculate moving window average and max value</span></span>
<span id="lst-load-packages-15"><a href="#lst-load-packages-15" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ineq) # Inequality measures</span></span>
<span id="lst-load-packages-16"><a href="#lst-load-packages-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(acid)</span></span>
<span id="lst-load-packages-17"><a href="#lst-load-packages-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-load-packages-18"><a href="#lst-load-packages-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Geopackages</span></span>
<span id="lst-load-packages-19"><a href="#lst-load-packages-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="co"># to read and write shapefile maps</span></span>
<span id="lst-load-packages-20"><a href="#lst-load-packages-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="co"># to perform geocalculations</span></span>
<span id="lst-load-packages-21"><a href="#lst-load-packages-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)      <span class="co"># for static and interactive maps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="datasets" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="datasets"><span class="header-section-number">1.2</span> Datasets</h2>
<p>We then load the datasets that we need for this study. These are based on Georgia’s Integrated Living Conditions Survey 2022 <span class="citation" data-cites="geostat_integrated_2023">(<a href="#ref-geostat_integrated_2023" role="doc-biblioref">GEOSTAT, 2023</a>)</span>. We make a note that the household identification variable is <code>UID</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="original-datasets"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="original-datasets-1"><a href="#original-datasets-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Household Unique ID, Weights, Location and other basic variables</span></span>
<span id="original-datasets-2"><a href="#original-datasets-2" aria-hidden="true" tabindex="-1"></a>hh_basics <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-3"><a href="#original-datasets-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/sysschedule.sav"</span>) <span class="sc">|&gt;</span></span>
<span id="original-datasets-4"><a href="#original-datasets-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-5"><a href="#original-datasets-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-6"><a href="#original-datasets-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-7"><a href="#original-datasets-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Household size (includes no. of family members)</span></span>
<span id="original-datasets-8"><a href="#original-datasets-8" aria-hidden="true" tabindex="-1"></a>hh_size <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-9"><a href="#original-datasets-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/familysize.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-10"><a href="#original-datasets-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-11"><a href="#original-datasets-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-12"><a href="#original-datasets-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-13"><a href="#original-datasets-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Processed income at household level</span></span>
<span id="original-datasets-14"><a href="#original-datasets-14" aria-hidden="true" tabindex="-1"></a>hh_income <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-15"><a href="#original-datasets-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblincomes.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-16"><a href="#original-datasets-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-17"><a href="#original-datasets-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-18"><a href="#original-datasets-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-19"><a href="#original-datasets-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Consumption aggregate at household level </span></span>
<span id="original-datasets-20"><a href="#original-datasets-20" aria-hidden="true" tabindex="-1"></a>hh_expenditure <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-21"><a href="#original-datasets-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblexpenditures.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-22"><a href="#original-datasets-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="co"># rename total expenditure variables</span></span>
<span id="original-datasets-23"><a href="#original-datasets-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure =</span> MTlianixarjebi_,</span>
<span id="original-datasets-24"><a href="#original-datasets-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure_aeq06 =</span> MTlianimoxmareba_EqAdScale,</span>
<span id="original-datasets-25"><a href="#original-datasets-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure_aeq08 =</span> Mtlianimoxmareba_EqAdScale_08) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-26"><a href="#original-datasets-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-27"><a href="#original-datasets-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-28"><a href="#original-datasets-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-29"><a href="#original-datasets-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Characteristics of the dwelling</span></span>
<span id="original-datasets-30"><a href="#original-datasets-30" aria-hidden="true" tabindex="-1"></a>hh_chars <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-31"><a href="#original-datasets-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda01.sav"</span>)<span class="sc">|&gt;</span></span>
<span id="original-datasets-32"><a href="#original-datasets-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-33"><a href="#original-datasets-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-34"><a href="#original-datasets-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-35"><a href="#original-datasets-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Persons (pp)</span></span>
<span id="original-datasets-36"><a href="#original-datasets-36" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-37"><a href="#original-datasets-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda02.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-38"><a href="#original-datasets-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-39"><a href="#original-datasets-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-40"><a href="#original-datasets-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo))</span>
<span id="original-datasets-41"><a href="#original-datasets-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-42"><a href="#original-datasets-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor (pp)</span></span>
<span id="original-datasets-43"><a href="#original-datasets-43" aria-hidden="true" tabindex="-1"></a>pp_labor <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-44"><a href="#original-datasets-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda05_1.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-45"><a href="#original-datasets-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-46"><a href="#original-datasets-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-47"><a href="#original-datasets-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo),</span>
<span id="original-datasets-48"><a href="#original-datasets-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q5  =</span> <span class="fu">as.integer</span>(Q5),</span>
<span id="original-datasets-49"><a href="#original-datasets-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q12 =</span> <span class="fu">as.integer</span>(Q12)) </span>
<span id="original-datasets-50"><a href="#original-datasets-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-51"><a href="#original-datasets-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Poverty</span></span>
<span id="original-datasets-52"><a href="#original-datasets-52" aria-hidden="true" tabindex="-1"></a>poverty <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(</span>
<span id="original-datasets-53"><a href="#original-datasets-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/POVERTY_stata.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-54"><a href="#original-datasets-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-55"><a href="#original-datasets-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-56"><a href="#original-datasets-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-57"><a href="#original-datasets-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Ind. Poverty</span></span>
<span id="original-datasets-58"><a href="#original-datasets-58" aria-hidden="true" tabindex="-1"></a>ind_poverty <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(</span>
<span id="original-datasets-59"><a href="#original-datasets-59" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/IND_POVERTY_stata.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-60"><a href="#original-datasets-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MemberNo =</span> memberno) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-61"><a href="#original-datasets-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-62"><a href="#original-datasets-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-63"><a href="#original-datasets-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo))</span>
<span id="original-datasets-64"><a href="#original-datasets-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-65"><a href="#original-datasets-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Food diary</span></span>
<span id="original-datasets-66"><a href="#original-datasets-66" aria-hidden="true" tabindex="-1"></a>food_q <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-67"><a href="#original-datasets-67" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblconsumption.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-68"><a href="#original-datasets-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span>
<span id="original-datasets-69"><a href="#original-datasets-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-70"><a href="#original-datasets-70" aria-hidden="true" tabindex="-1"></a>food_price <span class="ot">&lt;-</span> <span class="fu">read_sav</span>( </span>
<span id="original-datasets-71"><a href="#original-datasets-71" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblavgprices.sav"</span>)</span>
<span id="original-datasets-72"><a href="#original-datasets-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-73"><a href="#original-datasets-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Maps</span></span>
<span id="original-datasets-74"><a href="#original-datasets-74" aria-hidden="true" tabindex="-1"></a>adm1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/gis/geo-adm1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="original-datasets-75"><a href="#original-datasets-75" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RegNo, region, ADM1_PCODE, ADM1_EN, ADM1_KA, geometry) <span class="sc">|&gt;</span></span>
<span id="original-datasets-76"><a href="#original-datasets-76" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(ADM1_PCODE)</span>
<span id="original-datasets-77"><a href="#original-datasets-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-78"><a href="#original-datasets-78" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(adm1) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-79"><a href="#original-datasets-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need look-up tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sam_activities <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM-REV2"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"text"</span>, <span class="st">"text"</span>, <span class="st">"text"</span>,<span class="st">"text"</span>, <span class="st">"numeric"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sam_factors <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM factors"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>coicop <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"COICOP"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">simple_code =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, Coicop)))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>coicop_filtered <span class="ot">&lt;-</span> coicop <span class="sc">|&gt;</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">nchar</span>(<span class="fu">as.character</span>(simple_code)) <span class="sc">&gt;=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have Continuous Labor Survey data at the individual level, which will come in handy if we do not get access to the labor part of the ILCS. See data folder for documents describing the datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="labor-survey"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="labor-survey-1"><a href="#labor-survey-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor Force Survey</span></span>
<span id="labor-survey-2"><a href="#labor-survey-2" aria-hidden="true" tabindex="-1"></a>lfs_2023 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="labor-survey-3"><a href="#labor-survey-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/lfs_2023/LFS_ECSTAT_ENG_2023.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="labor-survey-4"><a href="#labor-survey-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span>
<span id="labor-survey-5"><a href="#labor-survey-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="labor-survey-6"><a href="#labor-survey-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor Force Survey Demographic Characteristics</span></span>
<span id="labor-survey-7"><a href="#labor-survey-7" aria-hidden="true" tabindex="-1"></a>lfs_2023_dem <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="labor-survey-8"><a href="#labor-survey-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/lfs_2023/LFS_Demographic_ENG_2023.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="labor-survey-9"><a href="#labor-survey-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will work non-destructively, meaning we will not rewrite these data sets and we will only create intermediate data frame objects from them to perform transformations, selections and other data management tasks. For example, we will keep household assignment to poverty status and consumption deciles handy by creating a subset of our <code>hh_expenditure</code> data with only our household identifiers, deciles, and poverty if available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-deciles"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-deciles-1"><a href="#lst-deciles-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We will estimate deciles from consumption</span></span>
<span id="lst-deciles-2"><a href="#lst-deciles-2" aria-hidden="true" tabindex="-1"></a>deciles <span class="ot">&lt;-</span> hh_expenditure <span class="sc">|&gt;</span> </span>
<span id="lst-deciles-3"><a href="#lst-deciles-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( </span>
<span id="lst-deciles-4"><a href="#lst-deciles-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep household id and expenditure variables</span></span>
<span id="lst-deciles-5"><a href="#lst-deciles-5" aria-hidden="true" tabindex="-1"></a>    UID, </span>
<span id="lst-deciles-6"><a href="#lst-deciles-6" aria-hidden="true" tabindex="-1"></a>    total_expenditure,</span>
<span id="lst-deciles-7"><a href="#lst-deciles-7" aria-hidden="true" tabindex="-1"></a>    total_expenditure_aeq06, <span class="co"># Adult equivalent * 0.6</span></span>
<span id="lst-deciles-8"><a href="#lst-deciles-8" aria-hidden="true" tabindex="-1"></a>    total_expenditure_aeq08) <span class="co"># Adult equivalent * 0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our population data comes from UN’s projections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-population-projections"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-population-projections-1"><a href="#lst-population-projections-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/population/UN2022_population.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="lst-population-projections-2"><a href="#lst-population-projections-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> iso) <span class="co"># we filter for Georgia</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The macro scenario dataset is an input provided by the Macroeconomic CGE simulation team, with yearly information on GDP, working age population, employment by economic activity (for an aggregation of three sectors: agriculture, manufacturing, and services), wages by economic activity, value added by economic activity, remittances, consumer price index, food price index and energy price index (for a bundle of gas, oil, coal, electricity) by decile (10 representative households in the macro model), and carbon tax revenue transfers to household deciles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-macro-scenarios"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-macro-scenarios-1"><a href="#lst-import-macro-scenarios-1" aria-hidden="true" tabindex="-1"></a>scenario_file <span class="ot">&lt;-</span> <span class="st">"data/sam/MacroScenarioInformation_GEO.xlsx"</span></span>
<span id="lst-import-macro-scenarios-2"><a href="#lst-import-macro-scenarios-2" aria-hidden="true" tabindex="-1"></a>scenario_varlist <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data/sam/GEO_Macro_varlist.xlsx"</span>) <span class="sc">|&gt;</span> </span>
<span id="lst-import-macro-scenarios-3"><a href="#lst-import-macro-scenarios-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category)</span>
<span id="lst-import-macro-scenarios-4"><a href="#lst-import-macro-scenarios-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prices_2030 &lt;-</span></span>
<span id="lst-import-macro-scenarios-5"><a href="#lst-import-macro-scenarios-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   read.csv("data/ARM-Microsimulation/prices2030.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Economic Activities in the Survey are in Georgian. The following dataset is a lookup table with the English names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-economic-activity-codes"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-economic-activity-codes-1"><a href="#lst-import-economic-activity-codes-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalence table</span></span>
<span id="lst-import-economic-activity-codes-2"><a href="#lst-import-economic-activity-codes-2" aria-hidden="true" tabindex="-1"></a>sectors <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="lst-import-economic-activity-codes-3"><a href="#lst-import-economic-activity-codes-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="lst-import-economic-activity-codes-4"><a href="#lst-import-economic-activity-codes-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM-REV2"</span>,</span>
<span id="lst-import-economic-activity-codes-5"><a href="#lst-import-economic-activity-codes-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="lst-import-economic-activity-codes-6"><a href="#lst-import-economic-activity-codes-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="lst-import-economic-activity-codes-7"><a href="#lst-import-economic-activity-codes-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have an Excel file with changes to labor productivity due to climate variability, by sector. Also, we have livestock productivity changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-labor-productivity"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-labor-productivity-1"><a href="#lst-import-labor-productivity-1" aria-hidden="true" tabindex="-1"></a>labor_productivity <span class="ot">&lt;-</span></span>
<span id="lst-import-labor-productivity-2"><a href="#lst-import-labor-productivity-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="lst-import-labor-productivity-3"><a href="#lst-import-labor-productivity-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/climate_productivity/GEO_labour_REF_shock_admin1_bySector.csv"</span>)</span>
<span id="lst-import-labor-productivity-4"><a href="#lst-import-labor-productivity-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-import-labor-productivity-5"><a href="#lst-import-labor-productivity-5" aria-hidden="true" tabindex="-1"></a>livestock_productivity <span class="ot">&lt;-</span></span>
<span id="lst-import-labor-productivity-6"><a href="#lst-import-labor-productivity-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="lst-import-labor-productivity-7"><a href="#lst-import-labor-productivity-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/climate_productivity/GEO_livestock_REF_shock_admin1_high_prop_holstein.csv"</span></span>
<span id="lst-import-labor-productivity-8"><a href="#lst-import-labor-productivity-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-preparation-demographic-characteristics-income-outliers-and-missings" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data preparation, demographic characteristics, income outliers and missings</h1>
<p>We start with various renames for standardization. Naming conventions in the guidance code use traditional abbreviations like <code>nli</code> for non-lablor income. We are opting for more descriptive variable names like <code>non_labor_income</code>, <code>labor_income</code>, etc. to have more easily readable code. We make an exception for total consumption (<code>tc</code>), because it’s a variable that we use in every scenario and it supersedes lenght limits when adding scenario identifiers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment the correct total expenditure variable below</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> hh_expenditure <span class="sc">|&gt;</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tc =</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      total_expenditure</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">#total_expenditure_aeq06 # Adult equivalent * 0.6</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">#total_expenditure_aeq08 # Adult equivalent * 0.8</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We extract demographic characteristics for each individual.</p>
<section id="skill-level" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="skill-level"><span class="header-section-number">2.1</span> Skill level</h2>
<p>For skill level, we will use information on schooling from <code>pp$Education</code> (<code>TblShinda02</code>), which has the following levels:</p>
<ol type="1">
<li>Illiterate</li>
<li>Do not have primary education but can read and write</li>
<li>Pre-primary education</li>
<li>Primary education</li>
<li>Lower secondary education</li>
<li>Upper secondary education</li>
<li>Vocational education without secondary general education</li>
<li>Vocational education on the base of lower secondary education with secondary general education certificate</li>
<li>Vocational education on the base of secondary general education (except higher professional education)</li>
<li>Higher professional program</li>
<li>Bachelor or equivalent</li>
<li>Master or equivalent</li>
<li>Doctor or equivalent</li>
</ol>
<p>We need three skill levels for our SAM template, so we map these levels to:</p>
<p>Low skill (1 - 5): Illiterate through lower secondary. Medium skill (6 - 9): Upper secondary through vocational education. High skill (10 - 13): Higher professional program through Doctor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pp_factor_descriptors <span class="ot">&lt;-</span> pp <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, MemberNo, Gender, Age, Education) <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">factor</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    Gender,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">SkillLevel =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;</span> <span class="dv">9</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">13</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span> ) ) <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">SkillLevel =</span> <span class="fu">factor</span>(</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>      SkillLevel, </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>( <span class="st">"Low Skill"</span>, <span class="st">"Medium Skill"</span>, <span class="st">"High Skill"</span>))</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have skill levels, we need to add information on urban/rural (from <code>hh_basics</code>) and quintile (from <code>ind_poverty</code>), and type of income earner (from <code>pp_labor</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>urb_rur <span class="ot">&lt;-</span> hh_basics <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID,QuartNo, UrbanOrRural, RegNo, Weights) <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">UrbanOrRural =</span> <span class="fu">factor</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      UrbanOrRural,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Rural"</span>, <span class="st">"Urban"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>quintiles <span class="ot">&lt;-</span> poverty <span class="sc">|&gt;</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, quintilc, decilc, hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Quintile =</span> quintilc,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Decile =</span> decilc) <span class="sc">|&gt;</span> </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Quintile =</span> <span class="fu">factor</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>      Quintile,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>, <span class="st">"Q5"</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Decile =</span> <span class="fu">factor</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      Decile,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D01"</span>, <span class="st">"D02"</span>, <span class="st">"D03"</span>, <span class="st">"D04"</span>, <span class="st">"D05"</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D06"</span>, <span class="st">"D07"</span>, <span class="st">"D08"</span>, <span class="st">"D09"</span>, <span class="st">"D10"</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>is_employed <span class="ot">&lt;-</span> ind_poverty <span class="sc">|&gt;</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span> </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">employed =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        empl <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> T,</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        empl <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> F,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>      MemberId, employed</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>pp_lmarket0 <span class="ot">&lt;-</span> pp_labor <span class="sc">|&gt;</span> </span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span> </span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(UID,MemberNo))</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>pp_lmarket1 <span class="ot">&lt;-</span> pp_factor_descriptors <span class="sc">|&gt;</span> </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(urb_rur, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(quintiles, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pp_lmarket0, <span class="fu">join_by</span>(MemberId)) <span class="sc">|&gt;</span> </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(UID, MemberNo, MemberId, QuartNo), <span class="at">.before =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="labor-status-and-economic-activities" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="labor-status-and-economic-activities"><span class="header-section-number">2.2</span> Labor status and Economic Activities</h2>
<p>We work with labor status from <code>Shinda05_1</code>. Since, upon import NACE 2 codes are converted to numbers, we need to convert them back to text, so that we can keep zeros to the left for proper order. We then extract the first two digits and find the correspondence to Rev.&nbsp;2 from the SAM using the look-up table <code>sam_activities</code>. For proper order, we convert the SAM activities columns for job 1 and job 2 to factor, using the order from the dataset <code>sam_factors</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pp_microsim01 <span class="ot">&lt;-</span> pp_lmarket1 <span class="sc">|&gt;</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Job 1 NACE Rev 2 code. </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q5  =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q5),<span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%04d"</span>, Q5)), <span class="cn">NA</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Job 2 NACE Rev 2 code.</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q12 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q12),<span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%04d"</span>, Q12)), <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">job1 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q5),<span class="fu">substr</span>(Q5, <span class="dv">1</span>, <span class="dv">2</span>), <span class="cn">NA</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">job2 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q12),<span class="fu">substr</span>(Q12, <span class="dv">1</span>, <span class="dv">2</span>), <span class="cn">NA</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Is employed?</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    is_employed,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(MemberId)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We match to Rev 2 and SAM classifications (for job 1 and job 2)</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    sam_activities[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)], </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(job1 <span class="sc">==</span> rev2_2d)) <span class="sc">|&gt;</span> </span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    sam_activities[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)],</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(job2 <span class="sc">==</span> rev2_2d),</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> </span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"_job1"</span>, <span class="st">"_job2"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And convert to factors for proper order</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">factor</span>(</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      SAM3_job1, </span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">factor</span>(</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      SAM3_job2, </span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="types-of-income" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="types-of-income"><span class="header-section-number">2.3</span> Types of income</h2>
<p>Before making our multi-dimensional tables, we need to identify different types of income. f-lab (wages) and f-surp (capital income). The instruction is that f-surp needs to be split into wages to entrepreneurs/self employed and capital income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pp_microsim02 <span class="ot">&lt;-</span> pp_microsim01 <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We add accross three months for each source (and coalesce the NAs to 0)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job1 =</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q8_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>))),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job2 =</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q14_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>))),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">surplus_income =</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q10_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>)))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We also add factor labels to Employment Status</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lstatus1 =</span> <span class="fu">factor</span>(</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      Q7,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Employee"</span>, <span class="st">"Employer"</span>, <span class="st">"Own Account (Non-Ag.)"</span>, </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Own Account (Ag.)"</span>, <span class="st">"Unpaid Worker"</span>, <span class="st">"Other"</span>))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lstatus2 =</span> <span class="fu">factor</span>(</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      Q13,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Employee"</span>, <span class="st">"Employer"</span>, <span class="st">"Own Account (Non-Ag.)"</span>, </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Own Account (Ag.)"</span>, <span class="st">"Unpaid Worker"</span>, <span class="st">"Other"</span>))</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="missing-and-outliers" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="missing-and-outliers"><span class="header-section-number">2.4</span> Missing and outliers</h2>
<p>In this section we will assign a labor income for job1 holders with <code>!lstatus1 %in% c(2,5) &amp; labor_income_job1 == 0</code> based on predicted income from everyone else who doesn’t meet the condition. We will estimate annual_labor_total after predictions.</p>
<p>Looking at the data we see that only those that report being an employee or “other” report having labor income 1 or 2; Employer and Own Account non-ag report having surplus; and own account ag and (of course) unpaid worker</p>
<p>We first identify who needs predictions for job1, job2, and surplus. We default to <code>NA</code> because we want to preserve the logic of those who don’t have an income, because they aren’t supposed to have one. However, this introduces an uncertainty element when predicting further down the line, because subsetting does not allow NA’s. Even if we want to match just <code>TRUEs</code>. So it’s a double-edged sword. The fix was using <code>which()</code> to find row numbers of those with <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pp_microsim03 <span class="ot">&lt;-</span> pp_microsim02 <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_job1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) <span class="sc">~</span> F,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_job2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) <span class="sc">~</span> F,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_surplus =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)) <span class="sc">~</span> F,</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> surplus_income <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> surplus_income <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outliers and need to predict.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pp_microsim04 <span class="ot">&lt;-</span> pp_microsim03 <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_job1    =</span> <span class="fu">sd</span>(labor_income_job1, <span class="at">na.rm =</span> T),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_job2    =</span> <span class="fu">sd</span>(labor_income_job2, <span class="at">na.rm =</span> T),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_surplus =</span> <span class="fu">sd</span>(surplus_income   , <span class="at">na.rm =</span> T),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job1 =</span> labor_income_job1 <span class="sc">/</span> sd_job1,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job2 =</span> labor_income_job2 <span class="sc">/</span> sd_job2,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job1 =</span> surplus_income <span class="sc">/</span> sd_surplus,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assign sector to missings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pp_microsim05 <span class="ot">&lt;-</span> pp_microsim04 <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a temporary variable 'other_sector' as a factor</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_sector_job1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(SAM3_job1) <span class="sc">&amp;</span> SAM3_job1 <span class="sc">%in%</span> <span class="fu">levels</span>(SAM3_job1) <span class="sc">~</span> SAM3_job1,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span> <span class="co"># Keep as character NA for now</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(other_sector_job1, <span class="at">.direction =</span> <span class="st">"downup"</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_sector_job1 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Q7), <span class="cn">NA_character_</span>, other_sector_job1)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Impute missing 'sector' values based on 'other_sector'</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">as.factor</span>(<span class="fu">if_else</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7),</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(<span class="fu">coalesce</span>(<span class="fu">as.character</span>(SAM3_job1), other_sector_job1)),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(SAM3_job1)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">as.factor</span>(<span class="fu">if_else</span>(</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q13),</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(<span class="fu">coalesce</span>(<span class="fu">as.character</span>(SAM3_job2), other_sector_job1)),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(SAM3_job2)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-establish levels and labels</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">factor</span>(SAM3_job1, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">factor</span>(SAM3_job2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>))</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-income-simulation-regression" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="the-income-simulation-regression"><span class="header-section-number">2.5</span> The income simulation regression</h2>
<p>Since labor income was a key variable, which we needed to match with the future wage bill by economic activity, we first checked for missing values among employed individuals. We found that almost a third of respondents (28.6%) did not report income for either their primary or secondary job. To overcome this limitation, we used the available information from the remaining respondents to estimate an extended Mincer equation, as shown in <a href="#eq-labor-income-regression" class="quarto-xref">Equation&nbsp;1</a>, and implemented in <a href="#lst-regression-model" class="quarto-xref">Listing&nbsp;1</a>. For the respondents with available information, we also identified outliers as those outside of five standard deviations from the mean labor income.</p>
<p><span id="eq-labor-income-regression"><span class="math display">\[
\begin{equation}
\begin{split}
\ln(lab_i) = \\ \beta_0 + \beta_1 \text{age}_i + \\
\beta_2 \text{gender}_i + \beta_3 \text{education}_i + \\
\beta_4 \text{age}^2_i + \beta_5 \text{marz}_i + \\
\beta_6 \text{sector}_i + \epsilon_i
\end{split}
\end{equation}
\tag{1}\]</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\ln(lab_i)\)</span> is the natural logarithm of labor income for individual <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\beta_0\)</span> is the intercept term.</li>
<li><span class="math inline">\(\beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6\)</span> are the coefficients for the respective independent variables.</li>
<li><span class="math inline">\(\text{age}_i\)</span> is the age of individual <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\text{gender}_i\)</span> is a binary variable indicating the gender of individual <span class="math inline">\(i\)</span> (1 for female, 2 for male).</li>
<li><span class="math inline">\(\text{education}_i\)</span> represents the level of education for individual <span class="math inline">\(i\)</span> (ordered: 1) None to General, 2) Secondary to Vocational, 3) Higher education).</li>
<li><span class="math inline">\(\text{age}^2_i\)</span> is the square of the age of individual <span class="math inline">\(i\)</span>, included to capture non-linear effects of age on labor income.</li>
<li><span class="math inline">\(\text{marz}_i\)</span> represents the region where individual <span class="math inline">\(i\)</span> resides.</li>
<li><span class="math inline">\(\text{sector}_i\)</span> represents the sector of employment for individual <span class="math inline">\(i\)</span> (i.e., agriculture, manufacturing or services).</li>
<li><span class="math inline">\(\epsilon_i\)</span> is the error term for individual <span class="math inline">\(i\)</span>.</li>
</ul>
<p>We first prepare our variables for the regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pp_microsim06 <span class="ot">&lt;-</span> pp_microsim05 <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> Education,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> Age,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> Gender,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> RegNo) <span class="sc">|&gt;</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">education2 =</span> education<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age2 =</span> age<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">male =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_lab1 =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(labor_income_job1) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(labor_income_job1),</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_lab2 =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(labor_income_job2) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(labor_income_job2),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_surplus =</span> <span class="fu">if_else</span>(</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(surplus_income) <span class="sc">&amp;</span> surplus_income <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(surplus_income),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_job1 =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_job2 =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_surplus =</span> <span class="cn">NA_real_</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labor Market Status </span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">~</span> <span class="fu">as.numeric</span>(SAM3_job1),</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">~</span> <span class="dv">4</span>, <span class="co"># Unemployed</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="dv">5</span>,  <span class="co"># OLF</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_integer_</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter the data for regression conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>regression_data_job1 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> fix_job1 <span class="sc">==</span> F)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>regression_data_job2 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> fix_job2 <span class="sc">==</span> F)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>regression_data_surplus <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> fix_surplus <span class="sc">==</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regression model.</p>
<div class="cell">
<div id="lst-regression-model" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-regression-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Income regression model
</figcaption>
<div aria-describedby="lst-regression-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-regression-model"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-regression-model-1"><a href="#lst-regression-model-1" aria-hidden="true" tabindex="-1"></a>model_job1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-2"><a href="#lst-regression-model-2" aria-hidden="true" tabindex="-1"></a>  ln_lab1 <span class="sc">~</span> </span>
<span id="lst-regression-model-3"><a href="#lst-regression-model-3" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-4"><a href="#lst-regression-model-4" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job1,</span>
<span id="lst-regression-model-5"><a href="#lst-regression-model-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_job1)</span>
<span id="lst-regression-model-6"><a href="#lst-regression-model-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-regression-model-7"><a href="#lst-regression-model-7" aria-hidden="true" tabindex="-1"></a>model_job2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-8"><a href="#lst-regression-model-8" aria-hidden="true" tabindex="-1"></a>  ln_lab2 <span class="sc">~</span> </span>
<span id="lst-regression-model-9"><a href="#lst-regression-model-9" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-10"><a href="#lst-regression-model-10" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job2,</span>
<span id="lst-regression-model-11"><a href="#lst-regression-model-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_job2)</span>
<span id="lst-regression-model-12"><a href="#lst-regression-model-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-regression-model-13"><a href="#lst-regression-model-13" aria-hidden="true" tabindex="-1"></a>model_surplus <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-14"><a href="#lst-regression-model-14" aria-hidden="true" tabindex="-1"></a>  ln_surplus <span class="sc">~</span> </span>
<span id="lst-regression-model-15"><a href="#lst-regression-model-15" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-16"><a href="#lst-regression-model-16" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job1,</span>
<span id="lst-regression-model-17"><a href="#lst-regression-model-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_surplus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Applying predictions to those who need it.</p>
<p>Note: The ‘predict’ function in R does not directly support conditions within the function call, so we handle this by filtering or subsetting the data as needed.</p>
<p>Note: ‘type = “response”’ might be needed depending on model type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rows to predict (this removes uncertainty NAs for predictions)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>target_rows_job1    <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_job1    <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>target_rows_job2    <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_job2    <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>target_rows_surplus <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_surplus <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_job1[target_rows_job1] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_job1, ], </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_job2[target_rows_job2] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_job2, ], </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_surplus[target_rows_surplus] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_surplus, ], </span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, if there were negative predictions, we would have to make them zero. There are none such cases in this exercise.</p>
<p>And now, we replace simulated income for those who lack one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pp_microsim07 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job1 =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      fix_job1 <span class="sc">==</span> T,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      sim_job1,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      labor_income_job1</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job2 =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      fix_job2 <span class="sc">==</span> T,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      sim_job2,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      labor_income_job2</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">surplus_income =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      fix_surplus <span class="sc">==</span> T,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      sim_surplus,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      surplus_income</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we estimate total labor income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pp_microsim08 <span class="ot">&lt;-</span> pp_microsim07 <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annual income</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_income_job1 =</span> labor_income_job1 <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_income_job2 =</span> labor_income_job2 <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_surplus_income =</span> surplus_income <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly income</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_job1 =</span> labor_income_job1 <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_job2 =</span> labor_income_job2 <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_surplus_income =</span> surplus_income <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annual labor income in GEL</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>      Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>) <span class="sc">|</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">coalesce</span>(</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        annual_labor_income_job1, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coalesce</span>(</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        annual_labor_income_job2, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coalesce</span>(</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        annual_surplus_income, <span class="dv">0</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly labor income in GEL</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>      Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>) <span class="sc">|</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">coalesce</span>(</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        monthly_labor_income_job1, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coalesce</span>(</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        monthly_labor_income_job2, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coalesce</span>(</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        monthly_surplus_income, <span class="dv">0</span>)</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="total-income-and-shares" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="total-income-and-shares"><span class="header-section-number">2.5.1</span> Total income and shares</h3>
<p>Total labor income at HH level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>pp_microsim09 <span class="ot">&lt;-</span> pp_microsim08 <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_annual_labor_total  =</span> <span class="fu">sum</span>(annual_labor_total,  <span class="at">na.rm =</span> T),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_monthly_labor_total =</span> <span class="fu">sum</span>(monthly_labor_total, <span class="at">na.rm =</span> T)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="un-population-projections" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> UN Population Projections</h1>
<p>Now we are ready to move to our demographic projections and macroeconomic model information.</p>
<p>First, filtering based on country (our <code>iso</code> variable).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span>  </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> iso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Collapsing data by summing up variables starting with “yf” and “ym” and reshaping data to long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variant, country, cohort) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"yf"</span>, <span class="st">"ym"</span>)), sum)) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(population_projections,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"yf"</span>, <span class="st">"ym"</span>)),</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"year"</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_pattern =</span> <span class="st">"(yf|ym)(.*)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating new variable <code>total_population</code> as the sum of <code>yf</code> and <code>ym</code>. Dropping <code>country</code> variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_population =</span> yf <span class="sc">+</span> ym) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span>country) <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summarizing the year to find the range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>minyear <span class="ot">&lt;-</span> survey_year <span class="co"># Make sure `survey_year` is correctly defined</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>maxyear <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(population_projections<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have that the “Min Year” is <code>minyear</code> and the “Max Year” is <code>maxyear</code>. Now we create a population growth rate by demographic variant dataset. We initialize an empty list to store our data by variant and we loop over variants to create this list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With minyear and maxyear defined above</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store growth data</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over variants</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>variants <span class="ot">&lt;-</span> <span class="fu">unique</span>(population_projections<span class="sc">$</span>Variant)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (variant <span class="cf">in</span> variants) {</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> minyear<span class="sc">:</span>maxyear) {</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate population for year t</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    pop_t <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> t, Variant <span class="sc">==</span> variant) <span class="sc">|&gt;</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">sum_pop =</span> <span class="fu">sum</span>(total_population)) <span class="sc">|&gt;</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(sum_pop)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate population for base year</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    pop_base <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> minyear, Variant <span class="sc">==</span> variant) <span class="sc">|&gt;</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">sum_pop =</span> <span class="fu">sum</span>(total_population)) <span class="sc">|&gt;</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(sum_pop)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate growth rate and store in list with dynamic naming</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>    growth_rate <span class="ot">&lt;-</span> pop_t <span class="sc">/</span> pop_base</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>    pop_growth[[<span class="fu">paste0</span>(t, <span class="st">"_"</span>, variant)]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_rate =</span> growth_rate, <span class="at">pop_t =</span> pop_t</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the list ready, we convert back to dataframe by stitching the list elements one on top of the other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert list to dataframe</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">names</span>(pop_growth), <span class="cf">function</span>(x) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract year and variant from the name</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  parts <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">"_"</span>))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(parts[<span class="dv">1</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  variant <span class="ot">&lt;-</span> parts[<span class="dv">2</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a tibble for each entry</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> year, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">variant =</span> variant, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_population =</span> pop_growth[[x]]<span class="sc">$</span>pop_t,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_growth_rate =</span> pop_growth[[x]]<span class="sc">$</span>growth_rate)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the dataframe for better readability</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">arrange</span>(pop_growth, variant, year)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataframe</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>pop_growth[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">09</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
   year variant            total_population pop_growth_rate
  &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;           &lt;dbl&gt;
1  2023 Constant-fertility            3728.           1    
2  2024 Constant-fertility            3718.           0.997
3  2025 Constant-fertility            3710.           0.995
4  2026 Constant-fertility            3702.           0.993
5  2027 Constant-fertility            3693.           0.990
6  2028 Constant-fertility            3683.           0.988
7  2029 Constant-fertility            3673.           0.985
8  2030 Constant-fertility            3663.           0.983
9  2031 Constant-fertility            3653.           0.980</code></pre>
</div>
</div>
</section>
<section id="macro-scenarios" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Macro Scenarios</h1>
<p>Here we use the Excel tab names to create the names of the scenarios going forward, with a previous cleaning in which we convert names to lower case, replace spaces and special characters with underscores, we remove the word scenario from the name, and remove leading or trailing spaces or underscores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Macro Scenario File imported in "Datasets" section (scenario_file) </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(scenario_file)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>scenario_sheets <span class="ot">&lt;-</span> sheets[<span class="fu">c</span>(<span class="dv">1</span>)]</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the names of the scenarios and the variants</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># modify list with the tab numbers in the Excel file</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> scenario_sheets <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert all text to lowercase</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_lower</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace all spaces and hyphens with underscores</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"[ -]"</span>, <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the word 'scenario' or 'scenarios'</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"scenario?s?"</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove leading and trailing underscores</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"^_+|_+$"</span>, <span class="st">""</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our scenarios are: baseline. We now import data from Excel sheets corresponding to each scenario and combine them into one data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty list to store data frames for each scenario</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>scen_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data for each scenario and store it in the list.</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the trick where we use the index `i` from `scenarios`</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># but access the scenario_sheets name to fetch the Excel</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tab.</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(scenarios)) {</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  sheet_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(scenario_file, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> scenario_sheets[i], </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">range =</span> <span class="st">"A3:AX30"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  sheet_data<span class="sc">$</span>scenario_id <span class="ot">&lt;-</span> scenarios[i]</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sheet_data) <span class="ot">&lt;-</span> scenario_varlist<span class="sc">$</span>var_short_name</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  scen_data_list[[i]] <span class="ot">&lt;-</span> sheet_data</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all data frames into one</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(scen_data_list)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary list</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(scen_data_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then rename columns, create a ‘scenid’ to identify scenarios, and merge with population projections. Calculate real wages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename population_m from the data set because we will use </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># UN pop projections from the other data set.</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population_m_macrodata =</span> population_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We prepare our population data to combine it with the macro data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variant, year) <span class="sc">|&gt;</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">male =</span> <span class="fu">sum</span>(ym),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_population =</span> <span class="fu">sum</span>(total_population) ) <span class="sc">|&gt;</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Variant'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter population data to macro model years</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> pop_data <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(macro_data<span class="sc">$</span>year),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>         Variant <span class="sc">==</span> variants[<span class="dv">7</span>])</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the combined data with population projections</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are some calculated variables that we need to estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate real wages</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These result in billion GEL because employment in millions</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and wages in thousand GEL p/person p/year.</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># like multiplying by 1000 then by 1,000,000, and then</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dividing by a billion (1,000,000,000) = 1</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rwage_agr_b_lcu =</span> </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>           (wage_agri_lcu1000s <span class="sc">*</span> emp_agri_million) <span class="sc">/</span> cpi, </span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">rwage_man_b_lcu =</span> </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>           (wage_manu_lcu1000s <span class="sc">*</span> emp_manu_million) <span class="sc">/</span> cpi,</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">rwage_ser_b_lcu =</span> </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>           (wage_serv_lcu1000s <span class="sc">*</span> emp_serv_million) <span class="sc">/</span> cpi,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>         <span class="co"># We also rescale jobs and tot pop to million</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Old code (employment already in million)</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_population =</span> total_population <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">lmarket_1 =</span> emp_agri_million, </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">lmarket_2 =</span> emp_manu_million,  </span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">lmarket_3 =</span> emp_serv_million)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We calculate columns for the totals by labor market group so we can derive our shares.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_4 =</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>      working_age_pop_m <span class="sc">-</span> (lmarket_1 <span class="sc">+</span> lmarket_2 <span class="sc">+</span> lmarket_3),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_5 =</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>      (total_population) <span class="sc">-</span> working_age_pop_m</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># And we label these variables</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>total_population, </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Total population (million)"</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_1, </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in agriculture (million)"</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_2, </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in manufacturing (million)"</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_3, </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in services (million)"</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_4, </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Unemployed and inactive (million)"</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_5, </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Outside the labor force (million)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With our demographic data added to our macroeconomic data, we need to estimate relative growth of some of the variables. For this we create a function to estimate growth per column to a named list of column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to add growth rate columns directly in the dataframe</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>calculate_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(data, value_column) {</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  growth_col_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(value_column, <span class="st">"_growth"</span>) <span class="co"># dynamic name for growth column</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Variant, scenario_id) <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">base_value =</span> <span class="fu">first</span>(<span class="sc">!!</span><span class="fu">sym</span>(value_column)),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(growth_col_name) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(value_column) <span class="sc">/</span> base_value</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>base_value) <span class="sc">|&gt;</span> <span class="co"># optionally remove base_value column if not needed</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to calculate growth for</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>value_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_agr_b_lcu"</span>,     <span class="co"># Real wage agriculture</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_man_b_lcu"</span>,     <span class="co"># Real wage manufacturing</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_ser_b_lcu"</span>,     <span class="co"># Real wage services</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_1"</span>,</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_2"</span>,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_3"</span>,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_4"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_5"</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We create the list and pass it to the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using purrr to apply the function column-wise, without a for loop.</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> <span class="fu">reduce</span>(value_columns, calculate_growth, <span class="at">.init =</span> macro_data)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We relocate some variables for clarity.</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span> </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(scenario_id, Variant, <span class="at">.before =</span> year) <span class="sc">|&gt;</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(scenario_id, Variant, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that <code>macro_data</code> has growth rate columns for each of the variables. We can check, for example, the employment and wage growth rates for our three scenarios in the year 2030 (see ).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>macro_data[macro_data<span class="sc">$</span>year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>),<span class="fu">c</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"scenario_id"</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_1_growth"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_2_growth"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_3_growth"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_4_growth"</span>, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_5_growth"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>)] <span class="sc">|&gt;</span> </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"scenario_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_1_growth =</span> <span class="fu">md</span>(<span class="st">"Agriculture"</span>),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_2_growth =</span> <span class="fu">md</span>(<span class="st">"Manufacturing"</span>),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_3_growth =</span> <span class="fu">md</span>(<span class="st">"Services"</span>),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_4_growth =</span> <span class="fu">md</span>(<span class="st">"Unemployed"</span>),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_5_growth =</span> <span class="fu">md</span>(<span class="st">"OLF"</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-lmarket-growth" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lmarket-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Labor market growth by category in the year 2030
</figcaption>
<div aria-describedby="tbl-lmarket-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="oadgirpsaa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oadgirpsaa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oadgirpsaa thead, #oadgirpsaa tbody, #oadgirpsaa tfoot, #oadgirpsaa tr, #oadgirpsaa td, #oadgirpsaa th {
  border-style: none;
}

#oadgirpsaa p {
  margin: 0;
  padding: 0;
}

#oadgirpsaa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oadgirpsaa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oadgirpsaa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oadgirpsaa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oadgirpsaa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oadgirpsaa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oadgirpsaa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oadgirpsaa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oadgirpsaa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oadgirpsaa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oadgirpsaa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oadgirpsaa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oadgirpsaa .gt_spanner_row {
  border-bottom-style: hidden;
}

#oadgirpsaa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oadgirpsaa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oadgirpsaa .gt_from_md > :first-child {
  margin-top: 0;
}

#oadgirpsaa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oadgirpsaa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oadgirpsaa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oadgirpsaa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oadgirpsaa .gt_row_group_first td {
  border-top-width: 2px;
}

#oadgirpsaa .gt_row_group_first th {
  border-top-width: 2px;
}

#oadgirpsaa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oadgirpsaa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oadgirpsaa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oadgirpsaa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oadgirpsaa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oadgirpsaa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oadgirpsaa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oadgirpsaa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oadgirpsaa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oadgirpsaa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oadgirpsaa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oadgirpsaa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oadgirpsaa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oadgirpsaa .gt_left {
  text-align: left;
}

#oadgirpsaa .gt_center {
  text-align: center;
}

#oadgirpsaa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oadgirpsaa .gt_font_normal {
  font-weight: normal;
}

#oadgirpsaa .gt_font_bold {
  font-weight: bold;
}

#oadgirpsaa .gt_font_italic {
  font-style: italic;
}

#oadgirpsaa .gt_super {
  font-size: 65%;
}

#oadgirpsaa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oadgirpsaa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oadgirpsaa .gt_indent_1 {
  text-indent: 5px;
}

#oadgirpsaa .gt_indent_2 {
  text-indent: 10px;
}

#oadgirpsaa .gt_indent_3 {
  text-indent: 15px;
}

#oadgirpsaa .gt_indent_4 {
  text-indent: 20px;
}

#oadgirpsaa .gt_indent_5 {
  text-indent: 25px;
}

#oadgirpsaa .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#oadgirpsaa div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="lmarket_1_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Agriculture</th>
<th id="lmarket_2_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Manufacturing</th>
<th id="lmarket_3_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Services</th>
<th id="lmarket_4_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Unemployed</th>
<th id="lmarket_5_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">OLF</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_1_growth">0.88</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_2_growth">1.01</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_3_growth">1.01</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_4_growth">0.95</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_5_growth">1.00</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_1_growth">0.81</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_2_growth">0.98</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_3_growth">1.00</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_4_growth">0.76</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_5_growth">0.98</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>macro_data[macro_data<span class="sc">$</span>year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>),<span class="fu">c</span>(</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"scenario_id"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_agr_b_lcu_growth"</span>, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_man_b_lcu_growth"</span>,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_ser_b_lcu_growth"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>)] <span class="sc">|&gt;</span> </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"scenario_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_agr_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Agriculture"</span>),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_man_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Manufacturing"</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_ser_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Services"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-wage-growth" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wage-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Wage bill growth by sector in the year 2030
</figcaption>
<div aria-describedby="tbl-wage-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="yirucruuwp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yirucruuwp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yirucruuwp thead, #yirucruuwp tbody, #yirucruuwp tfoot, #yirucruuwp tr, #yirucruuwp td, #yirucruuwp th {
  border-style: none;
}

#yirucruuwp p {
  margin: 0;
  padding: 0;
}

#yirucruuwp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yirucruuwp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yirucruuwp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yirucruuwp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yirucruuwp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yirucruuwp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yirucruuwp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yirucruuwp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yirucruuwp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yirucruuwp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yirucruuwp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yirucruuwp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yirucruuwp .gt_spanner_row {
  border-bottom-style: hidden;
}

#yirucruuwp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yirucruuwp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yirucruuwp .gt_from_md > :first-child {
  margin-top: 0;
}

#yirucruuwp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yirucruuwp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yirucruuwp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yirucruuwp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yirucruuwp .gt_row_group_first td {
  border-top-width: 2px;
}

#yirucruuwp .gt_row_group_first th {
  border-top-width: 2px;
}

#yirucruuwp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yirucruuwp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yirucruuwp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yirucruuwp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yirucruuwp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yirucruuwp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yirucruuwp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yirucruuwp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yirucruuwp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yirucruuwp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yirucruuwp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yirucruuwp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yirucruuwp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yirucruuwp .gt_left {
  text-align: left;
}

#yirucruuwp .gt_center {
  text-align: center;
}

#yirucruuwp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yirucruuwp .gt_font_normal {
  font-weight: normal;
}

#yirucruuwp .gt_font_bold {
  font-weight: bold;
}

#yirucruuwp .gt_font_italic {
  font-style: italic;
}

#yirucruuwp .gt_super {
  font-size: 65%;
}

#yirucruuwp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yirucruuwp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yirucruuwp .gt_indent_1 {
  text-indent: 5px;
}

#yirucruuwp .gt_indent_2 {
  text-indent: 10px;
}

#yirucruuwp .gt_indent_3 {
  text-indent: 15px;
}

#yirucruuwp .gt_indent_4 {
  text-indent: 20px;
}

#yirucruuwp .gt_indent_5 {
  text-indent: 25px;
}

#yirucruuwp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#yirucruuwp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="rwage_agr_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Agriculture</th>
<th id="rwage_man_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Manufacturing</th>
<th id="rwage_ser_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Services</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_agr_b_lcu_growth">1.14</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_man_b_lcu_growth">1.36</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_ser_b_lcu_growth">1.32</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_agr_b_lcu_growth">2.16</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_man_b_lcu_growth">2.76</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_ser_b_lcu_growth">2.78</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="reweighting-of-the-dataset" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Reweighting of the dataset</h1>
<section id="aggregation-of-population-data" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="aggregation-of-population-data"><span class="header-section-number">5.1</span> Aggregation of population data</h2>
<p>This is based on a custom command to reweight the survey according to macroeconomic data for every possible combination of variant, year, and country. In the macro data we know they only used the “medium” variant and we only need to reweight for two specific years for Georgia (GEO), so we will conduct the reweighting directly with these parameters.</p>
<p>We join several cohorts from 0 to 29 years old and from 60 onwards, because the reweighting procedure works best if each category is at least 5% of the population. The solution here works best for Georgia</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Variant == "Medium") |&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recoding cohorts into ordered factors</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">cohort_short =</span> <span class="fu">factor</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">case_when</span>(</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P0004"</span>, <span class="st">"P0509"</span>,<span class="st">"P1014"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P1519"</span>,<span class="st">"P2024"</span>, <span class="st">"P2529"</span>) <span class="sc">~</span> <span class="st">"P0029"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P3034"</span>, <span class="st">"P3539"</span>) <span class="sc">~</span> <span class="st">"P3039"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P4044"</span>, <span class="st">"P4549"</span>) <span class="sc">~</span> <span class="st">"P4049"</span>,</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P5054"</span>, <span class="st">"P5559"</span>) <span class="sc">~</span> <span class="st">"P5059"</span>,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P6064"</span>, <span class="st">"P6569"</span>,<span class="st">"P7074"</span>, <span class="st">"P7579"</span>,</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P8084"</span>, <span class="st">"P8589"</span>, <span class="st">"P9094"</span>, <span class="st">"P9599"</span>,</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P100up"</span>) <span class="sc">~</span> <span class="st">"P60up"</span>), </span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> </span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"P0029"</span>, <span class="st">"P3039"</span>, <span class="st">"P4049"</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"P5059"</span>, <span class="st">"P60up"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get also factor 'cohort' to numeric codes</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_code =</span> <span class="fu">as.integer</span>(cohort_short))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now create cohorts in our <code>pp_microsim</code> data to match our population projection data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'age' into 'cohort' factor with levels ordered as specified</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>pp_microsim10 <span class="ot">&lt;-</span> pp_microsim09 <span class="sc">|&gt;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">0</span>  <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">~</span> <span class="st">"P0029"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">39</span> <span class="sc">~</span> <span class="st">"P3039"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">"P4049"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">"P5059"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">60</span>  <span class="sc">~</span> <span class="st">"P60up"</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"P0029"</span>, <span class="st">"P3039"</span>, <span class="st">"P4049"</span>, <span class="st">"P5059"</span>, <span class="st">"P60up"</span>)))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 'cohort' and 'gender' factor to numeric codes</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>pp_microsim11 <span class="ot">&lt;-</span> pp_microsim10  <span class="sc">|&gt;</span> </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_code =</span> <span class="fu">as.integer</span>(cohort))  <span class="sc">|&gt;</span>  </span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_code =</span> <span class="fu">as.integer</span>(gender)) <span class="sc">|&gt;</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> Weights <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls(pattern = "^pp_microsim[0-9]+$"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need demographic targets for 2030 and 2050</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure pop_targets_2030 is correctly prepared</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the "Medium" variant = variants[7]</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>pop_targets_2030 <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2030</span>, Variant <span class="sc">==</span> variants[<span class="dv">7</span>])  <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort_code, cohort_short) <span class="sc">|&gt;</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">male   =</span> <span class="fu">sum</span>(ym), </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">total =</span> <span class="fu">sum</span>(total_population),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">|&gt;</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>pop_targets_2050 <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span> </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2050</span>, Variant <span class="sc">==</span> variants[<span class="dv">7</span>])  <span class="sc">|&gt;</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort_code, cohort_short) <span class="sc">|&gt;</span> </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">male   =</span> <span class="fu">sum</span>(ym), </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">total =</span> <span class="fu">sum</span>(total_population),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">|&gt;</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>pop_total_2030 <span class="ot">&lt;-</span> <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>total)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>pop_total_2050 <span class="ot">&lt;-</span> <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>total)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>pop_targets_2030 <span class="ot">&lt;-</span> pop_targets_2030 <span class="sc">|&gt;</span> </span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_total =</span> total <span class="sc">/</span> pop_total_2030)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>pop_targets_2050 <span class="ot">&lt;-</span> pop_targets_2050 <span class="sc">|&gt;</span> </span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_total =</span> total <span class="sc">/</span> pop_total_2050)</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a><span class="co">#writeClipboard(pop_targets_2030)</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(pop_targets_2030, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And economic targets from our macroeconomic scenario data. We deal with this later. Should come back to fix this so we can automate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>economic_targets <span class="ot">&lt;-</span> macro_data  <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2023</span>,analysis_years), </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    Variant <span class="sc">%in%</span> variants[<span class="dv">7</span>], </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    scenario_id <span class="sc">%in%</span> scenarios)  <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_1 =</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>      lmarket_1 <span class="sc">/</span> population_m_macrodata,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_2 =</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      lmarket_2 <span class="sc">/</span> population_m_macrodata,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_3 =</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>      lmarket_3 <span class="sc">/</span> population_m_macrodata,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_4 =</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>      lmarket_4 <span class="sc">/</span> population_m_macrodata,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_5 =</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>      lmarket_5 <span class="sc">/</span> population_m_macrodata</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    scenario_id,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="st">"target"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary_table &lt;- pp_microsim |&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(lmarket) |&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     total = sum(weight, na.rm = TRUE)</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() |&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#     pct = total / sum(total)</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summary_table</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(summary_table$total)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the differences between the totals of the survey and the macro file for the base year are very much different. We’ll adjust the survey only with relative growth instead of total numbers so that labor income doesn’t change completely.</p>
</section>
<section id="reweigting" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="reweigting"><span class="header-section-number">5.2</span> Reweigting</h2>
<p>We use anesrake to calculate targets from known future proportions of sex, age, economic sector. We first create a target list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Target for each variable</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2030 (gender is flipped in this case 1 is Female and 2 is Male) so</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>gender_code_2030 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>female) <span class="sc">/</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>male)<span class="sc">+</span> <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>female)),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>male)   <span class="sc">/</span> </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>male)<span class="sc">+</span> <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>female)) </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>cohort_code_2030 <span class="ot">&lt;-</span> pop_targets_2030<span class="sc">$</span>pct_total</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 2050 (gender is flipped in this case 1 is Female and 2 is Male) so</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>gender_code_2050 <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>female) <span class="sc">/</span> </span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>male)<span class="sc">+</span> <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>female)),</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>male)   <span class="sc">/</span> </span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>male)<span class="sc">+</span> <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>female)) </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>cohort_code_2050 <span class="ot">&lt;-</span> pop_targets_2050<span class="sc">$</span>pct_total</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Four digits are better than two in this case, raking is quite accurate.</span></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Macro shares are vastly different from survey shares, so we</span></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the changes in labor market categories from the macro_data object</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="co"># lmarket_growth and we apply that to the total numbers from the survey</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a><span class="co"># by category, we then compute the new shares based on that in the </span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Excel file "data/sam/LaborMarketChanges.xlsx". Should do it in the code</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="co"># but we'll fix it when we have more time.</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>lmarket_baseline_2030 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1360</span>, <span class="fl">0.0319</span>, <span class="fl">0.2849</span>, <span class="fl">0.3586</span>, <span class="fl">0.1886</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>lmarket_baseline_2050 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.1367</span>, <span class="fl">0.0342</span>, <span class="fl">0.3089</span>, <span class="fl">0.3177</span>, <span class="fl">0.2025</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="co"># lmarket_dry_hot  &lt;- c(0.1348, 0.0490, 0.2582, 0.2459, 0.3120)</span></span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="co"># lmarket_nzs      &lt;- c(0.1237, 0.0510, 0.2594, 0.2488, 0.3171)</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Note how similar the scenarios are</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Target list baseline</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>targets_baseline_2030 <span class="ot">&lt;-</span> <span class="fu">list</span>(gender_code_2030</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>                , cohort_code_2030</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>                , lmarket_baseline_2030</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Target list baseline</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>targets_baseline_2050 <span class="ot">&lt;-</span> <span class="fu">list</span>(gender_code_2050</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>                , cohort_code_2050</span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>                , lmarket_baseline_2050</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(targets_baseline_2030) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender_code"</span>, </span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cohort_code"</span>, </span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lmarket"</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(targets_baseline_2050) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender_code"</span>, </span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"cohort_code"</span>, </span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lmarket"</span></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Target list Dry/Hot</span></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="co"># targets_dry_hot &lt;- list(gender_code</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                 , cohort_code</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                 , lmarket_dry_hot</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a><span class="co"># names(targets_dry_hot) &lt;- c("gender_code", </span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "cohort_code", </span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "lmarket"</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a><span class="co">#                     )</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Target list NZS</span></span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a><span class="co"># targets_nzs &lt;- list(gender_code</span></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="co">#                 , cohort_code</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a><span class="co">#                 , lmarket_nzs</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a><span class="co">#                 )</span></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a><span class="co"># names(targets_nzs) &lt;- c("gender_code", </span></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "cohort_code", </span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co">#                     "lmarket"</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="co">#                     )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we perform the reweighting, using the original weights. Initially we had used the default option type = “pctlim” combined with pctlim=0.05, because the method recommends that if reweighting changes for one variable according to its target are not of at least 5%, then it’s not worth burdening the procedure with it. It then ignored sex as a reweighting variable, leaving a small percentage difference between the target and the final population. However, we then tried removing this limitation and the procedure reached convergence in 40 and 49 iterations very efficiently for 2030 and 2050, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since this uses base R, we need to turn the data frame into base R object</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>rakedata <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pp_microsim11)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>outsave_2030 <span class="ot">&lt;-</span> anesrake<span class="sc">::</span><span class="fu">anesrake</span>(targets_baseline_2030, </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                    rakedata, </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">caseid =</span> rakedata<span class="sc">$</span>MemberId, </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#verbose = FALSE,</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">choosemethod =</span> <span class="st">"total"</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#type = "pctlim",</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">"nolim"</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#cap = 100,</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#pctlim = 0.05,</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nlim =</span> <span class="dv">3</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iterate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">force1 =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weightvec =</span> rakedata<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 4170.21575598582"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 785.634483636673"
[1] "Raking...Iteration 3"
[1] "Capping...Iteration 3.1"
[1] "Current iteration changed total weights by 293.652466793572"
[1] "Raking...Iteration 4"
[1] "Capping...Iteration 4.1"
[1] "Capping...Iteration 4.2"
[1] "Current iteration changed total weights by 122.383633593513"
[1] "Raking...Iteration 5"
[1] "Capping...Iteration 5.1"
[1] "Current iteration changed total weights by 51.5298229294155"
[1] "Raking...Iteration 6"
[1] "Capping...Iteration 6.1"
[1] "Current iteration changed total weights by 21.7458526401823"
[1] "Raking...Iteration 7"
[1] "Capping...Iteration 7.1"
[1] "Current iteration changed total weights by 9.149338384695"
[1] "Raking...Iteration 8"
[1] "Capping...Iteration 8.1"
[1] "Current iteration changed total weights by 3.84642165931823"
[1] "Raking...Iteration 9"
[1] "Capping...Iteration 9.1"
[1] "Current iteration changed total weights by 1.61644040703877"
[1] "Raking...Iteration 10"
[1] "Capping...Iteration 10.1"
[1] "Current iteration changed total weights by 0.679193709145567"
[1] "Raking...Iteration 11"
[1] "Capping...Iteration 11.1"
[1] "Current iteration changed total weights by 0.285363402699183"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.121101640563356"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.0502755399578244"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.0205792460141766"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.00843549068114009"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.00345746602393797"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.00141705958220135"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.000580783765593618"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.00023803463211311"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 9.75586340896673e-05"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 3.99844573370362e-05"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 1.63876554279546e-05"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 6.71648476464892e-06"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 2.75275544890652e-06"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 1.12821660284979e-06"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 4.6239819269378e-07"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 1.8951201252726e-07"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 7.76712210381891e-08"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 3.18305389823692e-08"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 1.30450520802183e-08"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 5.34596562851153e-09"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 2.19379273080911e-09"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 8.97591376225471e-10"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 3.70547453831804e-10"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 1.51875720333372e-10"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 6.05985817081489e-11"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.62726923550005e-11"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.20197463093774e-11"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 7.91662568833118e-12"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 1.59369462071624e-11"
[1] "Raking converged in 40 iterations"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>outsave_2050 <span class="ot">&lt;-</span> anesrake<span class="sc">::</span><span class="fu">anesrake</span>(targets_baseline_2050, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                    rakedata, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">caseid =</span> rakedata<span class="sc">$</span>MemberId, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#verbose = FALSE,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">choosemethod =</span> <span class="st">"total"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#type = "pctlim",</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">"nolim"</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#cap = 100,</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#pctlim = 0.05,</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nlim =</span> <span class="dv">3</span>,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">iterate =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">force1 =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>                    <span class="at">weightvec =</span> rakedata<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Capping...Iteration 1.1"
[1] "Current iteration changed total weights by 5364.73169272659"
[1] "Raking...Iteration 2"
[1] "Capping...Iteration 2.1"
[1] "Capping...Iteration 2.2"
[1] "Current iteration changed total weights by 1420.37834979685"
[1] "Raking...Iteration 3"
[1] "Capping...Iteration 3.1"
[1] "Capping...Iteration 3.2"
[1] "Current iteration changed total weights by 177.980380664734"
[1] "Raking...Iteration 4"
[1] "Capping...Iteration 4.1"
[1] "Current iteration changed total weights by 54.2396074294259"
[1] "Raking...Iteration 5"
[1] "Capping...Iteration 5.1"
[1] "Current iteration changed total weights by 24.973366285866"
[1] "Raking...Iteration 6"
[1] "Capping...Iteration 6.1"
[1] "Current iteration changed total weights by 11.966164271702"
[1] "Raking...Iteration 7"
[1] "Capping...Iteration 7.1"
[1] "Current iteration changed total weights by 5.7797850038278"
[1] "Raking...Iteration 8"
[1] "Capping...Iteration 8.1"
[1] "Current iteration changed total weights by 2.79713711644999"
[1] "Raking...Iteration 9"
[1] "Capping...Iteration 9.1"
[1] "Current iteration changed total weights by 1.35453728510844"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 0.656885649225186"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 0.317331530802054"
[1] "Raking...Iteration 12"
[1] "Capping...Iteration 12.1"
[1] "Current iteration changed total weights by 0.156668036645662"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.076022288260348"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.0360303342206468"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.0174612084253723"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.00846086160692096"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.00409993211933158"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.00198681503860201"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.000962814398677153"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 0.000466582613346408"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 0.00022610734700465"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 0.000109572314287924"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 5.30990829480521e-05"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 2.5731980090149e-05"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 1.24697974466723e-05"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 6.04289992797713e-06"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 2.92840932637761e-06"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 1.41911776713882e-06"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 6.87707978418162e-07"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 3.33265600289956e-07"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 1.6150242099916e-07"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 7.82631018672597e-08"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 3.79266106714793e-08"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 1.83793413335853e-08"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 8.90660570296298e-09"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 4.31711324327955e-09"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.08988481381622e-09"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.0141292944299e-09"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 4.92719517963813e-10"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 2.40598277412296e-10"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 1.13014757274765e-10"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 5.623627258311e-11"
[1] "Raking...Iteration 43"
[1] "Current iteration changed total weights by 2.71113201333328e-11"
[1] "Raking...Iteration 44"
[1] "Current iteration changed total weights by 1.70485639494622e-11"
[1] "Raking...Iteration 45"
[1] "Current iteration changed total weights by 8.51289871928174e-12"
[1] "Raking...Iteration 46"
[1] "Current iteration changed total weights by 4.69129596281093e-12"
[1] "Raking...Iteration 47"
[1] "Current iteration changed total weights by 2.38074837621838e-12"
[1] "Raking...Iteration 48"
[1] "Current iteration changed total weights by 0"
[1] "Raking...Iteration 49"
[1] "Current iteration changed total weights by 0"
[1] "Raking converged in 49 iterations"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add weights to the dataset</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>rakedata<span class="sc">$</span>weight_2030_baseline  <span class="ot">&lt;-</span> <span class="fu">unlist</span>(outsave_2030[<span class="dv">1</span>])</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>rakedata<span class="sc">$</span>weight_2050_baseline  <span class="ot">&lt;-</span> <span class="fu">unlist</span>(outsave_2050[<span class="dv">1</span>])</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="fu">length</span>(rakedata<span class="sc">$</span>MemberId)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the sum of original weights</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>original_weight_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(rakedata<span class="sc">$</span>weight)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Target scaling for original weights</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>original_weight_scaling_factor_2030 <span class="ot">&lt;-</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2030</span>] <span class="sc">/</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span>]</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>original_weight_scaling_factor_2050 <span class="ot">&lt;-</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2050</span>] <span class="sc">/</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>  pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span>]</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaled original weights</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>original_weight_sum_2030 <span class="ot">&lt;-</span> (original_weight_sum </span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">*</span> original_weight_scaling_factor_2030)</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>original_weight_sum_2050 <span class="ot">&lt;-</span> (original_weight_sum </span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">*</span> original_weight_scaling_factor_2050)</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the sum of the new weights</span></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>new_weight_sum_2030 <span class="ot">&lt;-</span> <span class="fu">sum</span>(rakedata<span class="sc">$</span>weight_2030_baseline)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>new_weight_sum_2050 <span class="ot">&lt;-</span> <span class="fu">sum</span>(rakedata<span class="sc">$</span>weight_2050_baseline)</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Find out by how much new weights need to be scaled</span></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>scaling_factor_2030 <span class="ot">&lt;-</span> original_weight_sum_2030 <span class="sc">/</span> new_weight_sum_2030</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>scaling_factor_2050 <span class="ot">&lt;-</span> original_weight_sum_2050 <span class="sc">/</span> new_weight_sum_2050</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the new weights to match the sum of the original weights</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>rakedata<span class="sc">$</span>weight_2030_baseline <span class="ot">&lt;-</span> rakedata<span class="sc">$</span>weight_2030_baseline <span class="sc">*</span> scaling_factor_2030</span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>rakedata<span class="sc">$</span>weight_2050_baseline <span class="ot">&lt;-</span> rakedata<span class="sc">$</span>weight_2050_baseline <span class="sc">*</span> scaling_factor_2050</span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the adjustment</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rakedata[, <span class="fu">c</span>(<span class="st">"weight"</span>, <span class="st">"weight_2030_baseline"</span>, <span class="st">"weight_2050_baseline"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    weight weight_2030_baseline weight_2050_baseline
1 47.04044             60.70135             51.19528
2 47.04044             60.70135             51.19528
3 47.04044             51.58993             40.07518
4 47.04044             46.03868             44.81945
5 47.04044             46.72308             46.92772
6 47.04044             48.79902             47.90808</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rakedata<span class="sc">$</span>weight_2030_baseline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  5.484  24.674  56.037  85.083 109.568 425.419 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rakedata<span class="sc">$</span>weight_2050_baseline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  4.254  22.748  51.359  78.736 101.548 393.680 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(rakedata<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  6.955  24.567  59.988  86.729 108.501 337.590 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We get household size</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>hh_size <span class="ot">&lt;-</span> rakedata <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ones =</span> <span class="dv">1</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">hhsize_old =</span> hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span> </span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">hhsize =</span> <span class="fu">sum</span>(ones, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>rakedata <span class="ot">&lt;-</span> rakedata <span class="sc">|&gt;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">hhsize_old =</span> hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_size, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(weight, <span class="at">.before =</span> weight_2030_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2023 =</span> weight <span class="sc">/</span> hhsize,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2030_baseline =</span> weight_2030_baseline <span class="sc">/</span> hhsize,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2050_baseline =</span> weight_2050_baseline <span class="sc">/</span> hhsize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Weights for the household database</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We calculate new weights for households in the hh database</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>weights_scenarios <span class="ot">&lt;-</span> rakedata <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2023 =</span> </span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(hh_weight_2023),</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2030_baseline =</span> </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(hh_weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2050_baseline =</span> </span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(hh_weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We return rakedata to data frame pp_microsim and get rid of rakedata</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>pp_microsim12 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(rakedata)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(rakedata)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="rescaling-labor-income-according-to-changes-to-the-wage-bill" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Rescaling labor income according to changes to the wage bill</h1>
<p>As a last step, we rescale labor income according to changes to the wage bill in the macro scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage rescale factor by sector from macro (Agriculture, Manufacturing, Services)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>wrf_2030_baseline <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(macro_data[</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  macro_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2030</span> <span class="sc">&amp;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    macro_data<span class="sc">$</span>scenario_id <span class="sc">==</span> <span class="st">"baseline"</span>, </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_agr_b_lcu_growth"</span>, </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_man_b_lcu_growth"</span>, </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_ser_b_lcu_growth"</span>)])</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>wrf_2050_baseline  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(macro_data[</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  macro_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2050</span> <span class="sc">&amp;</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    macro_data<span class="sc">$</span>scenario_id <span class="sc">==</span> <span class="st">"baseline"</span>, </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_agr_b_lcu_growth"</span>, </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_man_b_lcu_growth"</span>, </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_ser_b_lcu_growth"</span>)])</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="co"># wrf_2030_dry_hot   &lt;- c(1.24850624, 1.27740284, 1.30020020)</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a><span class="co"># wrf_2030_nzs       &lt;- c(1.05423642, 1.30685398, 1.27521304)</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a><span class="co"># We check the wage bill by sector</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>wages_by_sector <span class="ot">&lt;-</span> pp_microsim12 <span class="sc">|&gt;</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SAM3_job1)) <span class="sc">|&gt;</span> </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(SAM3_job1, <span class="at">.drop =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">wages_2023 =</span> <span class="fu">sum</span>(annual_labor_total <span class="sc">*</span> weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">wages_2030_baseline =</span> </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(annual_labor_total <span class="sc">*</span> weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">wages_2050_baseline =</span> </span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(annual_labor_total <span class="sc">*</span> weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># wages2030_dry_hot   = </span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   sum(annual_labor_total * weight_2030_dry_hot, na.rm = TRUE),</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># wages2030_nzs   = </span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   sum(annual_labor_total * weight_2030_nzs, na.rm = TRUE)</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare how much it changed with reweighting with how it should have changed</span></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive coefficients (wtc_2030) from that</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>wages_by_sector <span class="ot">&lt;-</span> wages_by_sector <span class="sc">|&gt;</span> </span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">wages_target_2030_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2030_baseline[<span class="dv">1</span>],</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2030_baseline[<span class="dv">2</span>],</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2030_baseline[<span class="dv">3</span>],</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">wages_target_2050_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2050_baseline[<span class="dv">1</span>],</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2050_baseline[<span class="dv">2</span>],</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> wrf_2050_baseline[<span class="dv">3</span>],</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add remaining scenarios and years</span></span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Wage target coefficient</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">wtc_2030_baseline =</span> wages_target_2030_baseline <span class="sc">/</span> wages_2030_baseline,</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">wtc_2050_baseline =</span> wages_target_2050_baseline <span class="sc">/</span> wages_2050_baseline,</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add remaining scenarios and years</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then add the coefficient to rescale each wage by sector</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign rescale the annual and monthly wage depending on the sector</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick way, but needs to be put in a sapply statement or loop</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>pp_microsim13 <span class="ot">&lt;-</span> pp_microsim12 <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">monthly_labor_income_2023 =</span> monthly_labor_total,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">annual_labor_total_2023 =</span> annual_labor_total)  <span class="sc">|&gt;</span>  </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_2030_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">1</span>],</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">2</span>],</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">3</span>],</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_total_2030_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">1</span>],</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">2</span>],</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2030_baseline[<span class="dv">3</span>],</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_2050_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">1</span>],</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">2</span>],</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> monthly_labor_income_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">3</span>],</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_total_2050_baseline =</span> <span class="fu">case_when</span>(</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">1</span>],</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">2</span>],</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>(SAM3_job1) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> annual_labor_total_2023 <span class="sc">*</span> wages_by_sector<span class="sc">$</span>wtc_2050_baseline[<span class="dv">3</span>],</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add remaining scenarios and years</span></span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes care of different household members coming from different sectors</span></span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a>hh_li <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span> </span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span> </span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mli_2023 =</span> <span class="fu">sum</span>(monthly_labor_income_2023, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-38"><a href="#cb57-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">mli_2030_baseline =</span> <span class="fu">sum</span>(monthly_labor_income_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-39"><a href="#cb57-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">mli_2050_baseline =</span> <span class="fu">sum</span>(monthly_labor_income_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb57-40"><a href="#cb57-40" aria-hidden="true" tabindex="-1"></a>            <span class="co"># add remaining scenarios and years</span></span>
<span id="cb57-41"><a href="#cb57-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">mli_coef_2030_baseline =</span> <span class="fu">if_else</span>(mli_2023 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, mli_2030_baseline <span class="sc">/</span> mli_2023),</span>
<span id="cb57-42"><a href="#cb57-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">mli_coef_2050_baseline =</span> <span class="fu">if_else</span>(mli_2023 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>, mli_2050_baseline <span class="sc">/</span> mli_2023)</span>
<span id="cb57-43"><a href="#cb57-43" aria-hidden="true" tabindex="-1"></a>            <span class="co"># add remaining scenarios and years</span></span>
<span id="cb57-44"><a href="#cb57-44" aria-hidden="true" tabindex="-1"></a>            )<span class="sc">|&gt;</span> </span>
<span id="cb57-45"><a href="#cb57-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID,</span>
<span id="cb57-46"><a href="#cb57-46" aria-hidden="true" tabindex="-1"></a>         mli_2023,</span>
<span id="cb57-47"><a href="#cb57-47" aria-hidden="true" tabindex="-1"></a>         mli_2030_baseline,</span>
<span id="cb57-48"><a href="#cb57-48" aria-hidden="true" tabindex="-1"></a>         mli_2050_baseline,</span>
<span id="cb57-49"><a href="#cb57-49" aria-hidden="true" tabindex="-1"></a>         mli_coef_2030_baseline,</span>
<span id="cb57-50"><a href="#cb57-50" aria-hidden="true" tabindex="-1"></a>         mli_coef_2050_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb57-51"><a href="#cb57-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb57-52"><a href="#cb57-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-53"><a href="#cb57-53" aria-hidden="true" tabindex="-1"></a>ic_microsim01 <span class="ot">&lt;-</span> hh_income <span class="sc">|&gt;</span> </span>
<span id="cb57-54"><a href="#cb57-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_li, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span></span>
<span id="cb57-55"><a href="#cb57-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_scenarios, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span> </span>
<span id="cb57-56"><a href="#cb57-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">labor_income_2023 =</span> ShemDaq,</span>
<span id="cb57-57"><a href="#cb57-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">self_employment_income_2023 =</span> ShemTviTdasaqm,</span>
<span id="cb57-58"><a href="#cb57-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">agr_income_2023 =</span> Shem_Sof,</span>
<span id="cb57-59"><a href="#cb57-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">totalinc_2023 =</span> Shemosavalisul) <span class="sc">|&gt;</span> </span>
<span id="cb57-60"><a href="#cb57-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-61"><a href="#cb57-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_coef_2030_baseline =</span> </span>
<span id="cb57-62"><a href="#cb57-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb57-63"><a href="#cb57-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(mli_coef_2030_baseline), <span class="dv">1</span>,mli_coef_2030_baseline),</span>
<span id="cb57-64"><a href="#cb57-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_coef_2050_baseline =</span> </span>
<span id="cb57-65"><a href="#cb57-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb57-66"><a href="#cb57-66" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(mli_coef_2050_baseline), <span class="dv">1</span>,mli_coef_2050_baseline),</span>
<span id="cb57-67"><a href="#cb57-67" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb57-68"><a href="#cb57-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-69"><a href="#cb57-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2030 Baseline</span></span>
<span id="cb57-70"><a href="#cb57-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2030_baseline =</span> </span>
<span id="cb57-71"><a href="#cb57-71" aria-hidden="true" tabindex="-1"></a>      labor_income_2023 <span class="sc">*</span> mli_coef_2030_baseline,</span>
<span id="cb57-72"><a href="#cb57-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2030_baseline =</span> </span>
<span id="cb57-73"><a href="#cb57-73" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2023 <span class="sc">*</span> mli_coef_2030_baseline,</span>
<span id="cb57-74"><a href="#cb57-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2050 Baseline</span></span>
<span id="cb57-75"><a href="#cb57-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2050_baseline =</span> </span>
<span id="cb57-76"><a href="#cb57-76" aria-hidden="true" tabindex="-1"></a>      labor_income_2023 <span class="sc">*</span> mli_coef_2050_baseline,</span>
<span id="cb57-77"><a href="#cb57-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2050_baseline =</span> </span>
<span id="cb57-78"><a href="#cb57-78" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2023 <span class="sc">*</span> mli_coef_2050_baseline,</span>
<span id="cb57-79"><a href="#cb57-79" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb57-80"><a href="#cb57-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb57-81"><a href="#cb57-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2030 Baseline</span></span>
<span id="cb57-82"><a href="#cb57-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline =</span> </span>
<span id="cb57-83"><a href="#cb57-83" aria-hidden="true" tabindex="-1"></a>      totalinc_2023 <span class="sc">-</span> </span>
<span id="cb57-84"><a href="#cb57-84" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(labor_income_2023,<span class="dv">0</span>) <span class="sc">-</span> </span>
<span id="cb57-85"><a href="#cb57-85" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(self_employment_income_2023,<span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb57-86"><a href="#cb57-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(labor_income_2030_baseline,<span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb57-87"><a href="#cb57-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(self_employment_income_2030_baseline,<span class="dv">0</span>),</span>
<span id="cb57-88"><a href="#cb57-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2050 Baseline</span></span>
<span id="cb57-89"><a href="#cb57-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline =</span> </span>
<span id="cb57-90"><a href="#cb57-90" aria-hidden="true" tabindex="-1"></a>      totalinc_2023 <span class="sc">-</span> </span>
<span id="cb57-91"><a href="#cb57-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(labor_income_2023,<span class="dv">0</span>) <span class="sc">-</span> </span>
<span id="cb57-92"><a href="#cb57-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(self_employment_income_2023,<span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb57-93"><a href="#cb57-93" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(labor_income_2050_baseline,<span class="dv">0</span>) <span class="sc">+</span> </span>
<span id="cb57-94"><a href="#cb57-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(self_employment_income_2050_baseline,<span class="dv">0</span>),</span>
<span id="cb57-95"><a href="#cb57-95" aria-hidden="true" tabindex="-1"></a>    ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point we re-calculate decile groups for the NZS scenario, to be able to “give back” energy tax revenues to the lower deciles. This scenario is not ready yet, so we need to come back to this. Review Armenia’s microsimulation file for this.</p>
<p>We now take stock of the changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ic_microsim02 <span class="ot">&lt;-</span> ic_microsim01  <span class="sc">|&gt;</span>  </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">totinc_coef_2030_baseline =</span> </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>        totalinc_2023 <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>        totalinc_2030_baseline <span class="sc">/</span> totalinc_2023),</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">totinc_coef_2050_baseline =</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>        totalinc_2023 <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>        totalinc_2050_baseline <span class="sc">/</span> totalinc_2023),</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span>  </span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Making sure totinc coefficients are not NA</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">totinc_coef_2030_baseline =</span> </span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(totinc_coef_2030_baseline), </span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, </span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>        totinc_coef_2030_baseline),</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">totinc_coef_2050_baseline =</span> </span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(totinc_coef_2050_baseline), </span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>, </span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>        totinc_coef_2050_baseline),</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>ic_coef_scenarios <span class="ot">&lt;-</span> ic_microsim02 <span class="sc">|&gt;</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    UID, </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    totinc_coef_2030_baseline,</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    totinc_coef_2050_baseline</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is leftover in case we need to check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table &lt;- pp_microsim13 |&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(cohort) |&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># #  group_by(lmarket) |&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># #  group_by(gender) |&gt;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(no_weight = sum(n(), na.rm = TRUE),</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co">#             total_pp = sum(weight, na.rm = TRUE)) |&gt;</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># table |&gt;</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   gt() |&gt;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   fmt_number(columns = total_pp, decimals = 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="microsimulations" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Microsimulations</h1>
<p>We now implement different shocks according to various scenarios.</p>
<section id="macro-scenarios-without-additional-impacts" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="macro-scenarios-without-additional-impacts"><span class="header-section-number">7.1</span> Macro scenarios without additional impacts</h2>
<p>For the baseline we only adjust labor income according to the reweighting procedure and rescaling of the wage bill.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>ca_microsim01 <span class="ot">&lt;-</span> poverty <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_scenarios, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ic_coef_scenarios, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We adjust total consumption by the income coefficient</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">tc_2023 =</span> totcons</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">|&gt;</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2023 =</span> <span class="fu">if_else</span>(</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>      cpsc <span class="sc">==</span> <span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">0</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tc_2030_baseline   =</span> tc_2023 <span class="sc">*</span> totinc_coef_2030_baseline,</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">tc_2050_baseline   =</span> tc_2023 <span class="sc">*</span> totinc_coef_2050_baseline,</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add remaining scenarios and years</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we need the variable <code>Eq_Skale_0_6</code> (Number of equivalent adults with scale effect 0.6) to divide <code>totinc</code> (total income) and contrast against the 212.8149 poverty line.</p>
<p>And recalculate poverty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ca_microsim02 <span class="ot">&lt;-</span> ca_microsim01 <span class="sc">|&gt;</span> </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">aecons_2023 =</span> aecons,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_2023 =</span> weights,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_2030_baseline =</span> hh_weight_2030_baseline,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_2050_baseline =</span> hh_weight_2050_baseline</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add remaining scenarios and years</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">adult_equivalent =</span> tc_2023 <span class="sc">/</span> aecons_2023</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">aecons_2030_baseline =</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>      tc_2030_baseline <span class="sc">/</span> adult_equivalent,</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">aecons_2050_baseline =</span> </span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>      tc_2050_baseline <span class="sc">/</span> adult_equivalent,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Official poverty line</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_baseline =</span> </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(aecons_2030_baseline <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2050_baseline =</span> </span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(aecons_2050_baseline <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="climate-change" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="climate-change"><span class="header-section-number">7.2</span> Climate change</h2>
<p>In these sections we use Administrative Level 1 data on yield losses and labor productivity losses due to climate change that are provided in the study commissioned for Armenia’s CCDR <em>Estimating the Economic Impacts of Climate Change in Armenia</em> <span class="citation" data-cites="strzepek_estimating_2024">(<a href="#ref-strzepek_estimating_2024" role="doc-biblioref">Strzepek, Boehlert, Castillo, &amp; Smet, 2024</a>)</span>.</p>
<p>In the climate change scenario, we ask ourselves, what would happen if agriculture revenues from crops and livestock are reduced due to losses in productivity due to heat? For this, we use crops data.</p>
<p>We add a moving window average and max value for our labor productivity data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First calculate moving window average</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>labor_productivity01 <span class="ot">&lt;-</span> labor_productivity <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix region names</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ajaria"</span> <span class="sc">~</span> <span class="st">"Adjara A.R."</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Racha-Lechkhumi-Kvemo Svaneti"</span> <span class="sc">~</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span>,</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Abkhazia"</span> <span class="sc">~</span> <span class="st">"Autonomous Republic of Abkhazia"</span>,</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, </span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>           scenario) <span class="sc">|&gt;</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Moving window average 5 years before, 5 after</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">moving_avg =</span> <span class="fu">rollapply</span>(</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>      pct_change,</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> mean,</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">partial =</span> <span class="cn">TRUE</span>,</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Clim scenarios to select</span></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(labor_productivity01<span class="sc">$</span>scenario))</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving average for year of interest</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="co"># We are interested in cs[2] = "Hot/Dry"</span></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>labor_pdcvty_loss <span class="ot">&lt;-</span> labor_productivity01 <span class="sc">|&gt;</span></span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>    regions[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)],</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(region)</span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scenario <span class="sc">==</span> cs[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">%in%</span> analysis_years) <span class="sc">|&gt;</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>pct_change,</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>scenario) <span class="sc">|&gt;</span></span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(sector,year), </span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> moving_avg,</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"labprod_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We add a moving window average and max value for our crops productivity data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Redo select and pivot wider the same as labor productivity above  </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we do the same for livestock productivity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First calculate moving window average</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>livestock_productivity01 <span class="ot">&lt;-</span> livestock_productivity <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix region names</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ajaria"</span> <span class="sc">~</span> <span class="st">"Adjara A.R."</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Racha-Lechkhumi-Kvemo Svaneti"</span> <span class="sc">~</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Abkhazia"</span> <span class="sc">~</span> <span class="st">"Autonomous Republic of Abkhazia"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, </span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>           scenario) <span class="sc">|&gt;</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix missing</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_change =</span> <span class="fu">if_else</span>(</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(pct_change),<span class="dv">0</span>,pct_change</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Moving window average</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">moving_avg =</span> <span class="fu">rollapply</span>(</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>      pct_change,</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 5 years before, 5 after + reference year = 11</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> mean,</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">partial =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Clim scenarios to select</span></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(livestock_productivity01<span class="sc">$</span>scenario))</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving average for year of interest</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>lvstk_pdcvty_loss <span class="ot">&lt;-</span> livestock_productivity01 <span class="sc">|&gt;</span></span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>    regions[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)],</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(region)</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scenario <span class="sc">==</span> cs[<span class="dv">1</span>] <span class="sc">&amp;</span> </span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">%in%</span> analysis_years) <span class="sc">|&gt;</span></span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>pct_change, </span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>scenario,</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>product) <span class="sc">|&gt;</span></span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(year), </span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> moving_avg,</span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"lvstkprod_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then we introduce these values in our ag income and labor income data. First, we attach the percentage losses to the appropriate data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Persons processed dataset</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>pp_microsim_cc01 <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(labor_pdcvty_loss, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(region <span class="sc">==</span> RegNo))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income processed dataset</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc01 <span class="ot">&lt;-</span> ic_microsim02 <span class="sc">|&gt;</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_basics, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lvstk_pdcvty_loss,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(RegNo))</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="do">##write.table(lab_loss_avg, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we first shock labor income (need to automate this in a loop).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor income according to sector</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pp_microsim_cc02 <span class="ot">&lt;-</span> pp_microsim_cc01 <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector =</span> <span class="fu">as.numeric</span>(SAM3_job1)) <span class="sc">|&gt;</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_labprod =</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Industry_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Services_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_labprod =</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Industry_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Services_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We aggregate at household level and take note of the percent difference between the two labor incomes, so that we can impact labor income by that amount. We don’t do it with absolute numbers because we don’t know the assumptions made by the poverty team to construct the income variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>ic_new_incomes01 <span class="ot">&lt;-</span> pp_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_labprod =</span> </span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(mli_2030_baseline_labprod, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_labprod =</span> </span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(mli_2050_baseline_labprod, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_original =</span> </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(monthly_labor_income_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_original =</span> </span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(monthly_labor_income_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_labprod_coef =</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        mli_2030_original <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(mli_2030_original),</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>        mli_2030_baseline_labprod <span class="sc">/</span> mli_2030_original</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_labprod_coef =</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>        mli_2050_original <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(mli_2050_original),</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>        mli_2050_baseline_labprod <span class="sc">/</span> mli_2050_original</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc02 <span class="ot">&lt;-</span> ic_microsim_cc01 <span class="sc">|&gt;</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ic_new_incomes01, </span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2030_baseline_labprod =</span> </span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>      labor_income_2030_baseline <span class="sc">*</span> mli_2030_baseline_labprod_coef,</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2030_baseline_labprod =</span> </span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2030_baseline <span class="sc">*</span> mli_2030_baseline_labprod_coef,</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2050_baseline_labprod =</span> </span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>      labor_income_2050_baseline <span class="sc">*</span> mli_2050_baseline_labprod_coef,</span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2050_baseline_labprod =</span> </span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2050_baseline <span class="sc">*</span> mli_2050_baseline_labprod_coef</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we impact agricultural income <code>agr_income_2030_baseline</code> (there is no livestock income<code>lvstk</code> in this dataset).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ic_microsim_cc &lt;- ic_microsim_cc |&gt; </span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     cropinc_2030_baseline_cc_avg = </span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#       cropinc * (1 + crops_avg_loss),</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     cropinc_2030_baseline_cc_max = </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co">#       cropinc * (1 + crops_max_loss),</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     lvstk_2030_baseline_cc_avg = </span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co">#       lvstk * (1 + lvstk_avg_loss),</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co">#     lvstk_2030_baseline_cc_max = </span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co">#       lvstk * (1 + lvstk_max_loss)</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And recalculate total income. First labor productivity alone. I learned about pick with this one, because the (.) is no longer interpreted as “this”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc03 <span class="ot">&lt;-</span> ic_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_labprod =</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>      totalinc_2030_baseline <span class="sc">-</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2030_baseline, </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2030_baseline), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2030_baseline_labprod, </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2030_baseline_labprod), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_labprod =</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>      totalinc_2050_baseline <span class="sc">-</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2050_baseline, </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2050_baseline), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2050_baseline_labprod, </span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2050_baseline_labprod), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_labprod_coef =</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(totalinc_2030_baseline <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2030_baseline_labprod <span class="sc">/</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>                totalinc_2030_baseline),</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_labprod_coef =</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(totalinc_2050_baseline <span class="sc">==</span> <span class="dv">0</span>, </span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2050_baseline_labprod <span class="sc">/</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>                totalinc_2050_baseline)</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_labprod_coef =</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(<span class="fu">is.na</span>(totalinc_2030_baseline_labprod_coef), </span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2030_baseline_labprod_coef),</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_labprod_coef =</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(<span class="fu">is.na</span>(totalinc_2050_baseline_labprod_coef), </span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2050_baseline_labprod_coef)</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We do the same for agriculture and livestock income alone</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ic_microsim_cc &lt;- ic_microsim_cc |&gt;</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_avg =</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co">#       totalinc_2030_baseline -</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(., c(cropinc,</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                           lvstk)), na.rm = TRUE) +</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         ., c(cropinc_2030_baseline_cc_avg,</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="co">#              lvstk_2030_baseline_cc_avg)), na.rm = TRUE),</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_max =</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co">#       totalinc_2030_baseline -</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(., c(cropinc,</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                           lvstk)), na.rm = TRUE) +</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         ., c(cropinc_2030_baseline_cc_max,</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a><span class="co">#              lvstk_2030_baseline_cc_max)), na.rm = TRUE)</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_avg_coef =</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(totalinc_2030_baseline == 0, </span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_cc_avg </span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="co">#               / totalinc_2030_baseline),</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_max_coef =</span></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(totalinc_2030_baseline == 0, </span></span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_cc_max </span></span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a><span class="co">#               / totalinc_2030_baseline)</span></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_avg_coef =</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(is.na(totalinc_2030_baseline_cc_avg_coef), </span></span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_cc_avg_coef),</span></span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_cc_max_coef =</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(is.na(totalinc_2030_baseline_cc_max_coef), </span></span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_cc_max_coef)</span></span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And yet again for the combined impacts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ic_microsim_cc &lt;- ic_microsim_cc |&gt;</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_avg =</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#       totalinc_2030_baseline -</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(., c(inc2_2030_baseline, </span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                           inc3_2030_baseline,</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                           cropinc,</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                           lvstk)), na.rm = TRUE) +</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#         ., c(inc2_2030_baseline_lab_avg, </span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="co">#              inc3_2030_baseline_lab_avg,</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a><span class="co">#              cropinc_2030_baseline_cc_avg,</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a><span class="co">#              lvstk_2030_baseline_cc_avg)), na.rm = TRUE),</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_max =</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a><span class="co">#       totalinc_2030_baseline -</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(., c(inc2_2030_baseline, </span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                           inc3_2030_baseline,</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                           cropinc,</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                           lvstk)), na.rm = TRUE) +</span></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       rowSums(select(</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a><span class="co">#         ., c(inc2_2030_baseline_lab_max, </span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a><span class="co">#              inc3_2030_baseline_lab_max,</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a><span class="co">#              cropinc_2030_baseline_cc_max,</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a><span class="co">#              lvstk_2030_baseline_cc_max)), na.rm = TRUE)</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_avg_coef =</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(totalinc_2030_baseline == 0, </span></span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_lab_cc_avg /</span></span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                 totalinc_2030_baseline),</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_max_coef =</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(totalinc_2030_baseline == 0, </span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_lab_cc_max /</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                 totalinc_2030_baseline)</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) |&gt;</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_avg_coef =</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(is.na(totalinc_2030_baseline_lab_cc_avg_coef), </span></span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_lab_cc_avg_coef),</span></span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     totalinc_2030_baseline_lab_cc_max_coef =</span></span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a><span class="co">#       if_else(is.na(totalinc_2030_baseline_lab_cc_max_coef), </span></span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a><span class="co">#               1, totalinc_2030_baseline_lab_cc_max_coef)</span></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a><span class="co">#     )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We assume that the loss in income translates into a loss of expenditure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>income_losses <span class="ot">&lt;-</span> ic_microsim_cc03 <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>         totalinc_2030_baseline_labprod, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>         totalinc_2050_baseline_labprod,</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>         totalinc_2030_baseline_labprod_coef, </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>         totalinc_2050_baseline_labprod_coef)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>ca_microsim_cc01 <span class="ot">&lt;-</span> ca_microsim02 <span class="sc">|&gt;</span> </span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(income_losses, <span class="fu">join_by</span>(UID))</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="co"># And now reduce total consumption</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>ca_microsim_cc02 <span class="ot">&lt;-</span> ca_microsim_cc01 <span class="sc">|&gt;</span> </span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tc_2030_baseline_labprod =</span> tc_2030_baseline <span class="sc">*</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>           totalinc_2030_baseline_labprod_coef,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">tc_2050_baseline_labprod =</span> tc_2050_baseline <span class="sc">*</span></span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>           totalinc_2050_baseline_labprod_coef         </span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">aecons_2030_baseline_labprod =</span> </span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>           tc_2030_baseline_labprod <span class="sc">/</span> adult_equivalent,</span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">aecons_2050_baseline_labprod =</span> </span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>           tc_2050_baseline_labprod <span class="sc">/</span> adult_equivalent) <span class="sc">|&gt;</span> </span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poor_2030_baseline_labprod =</span> </span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(aecons_2030_baseline_labprod <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">poor_2050_baseline_labprod =</span> </span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(aecons_2050_baseline_labprod <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a><span class="do">##write.table(test, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="poverty-tabulates" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Poverty tabulates</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>poor_2023 <span class="ot">&lt;-</span> ca_microsim02 <span class="sc">|&gt;</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2023) <span class="sc">|&gt;</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2023 =</span> <span class="fu">sum</span>(weight_2023, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2023 =</span> <span class="fu">sum</span>(weight_2023 <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline <span class="ot">&lt;-</span> ca_microsim02 <span class="sc">|&gt;</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_baseline =</span> <span class="fu">sum</span>(weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline =</span> <span class="fu">sum</span>(weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>poor_2050_baseline <span class="ot">&lt;-</span> ca_microsim02 <span class="sc">|&gt;</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_baseline =</span> <span class="fu">sum</span>(weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_baseline =</span> <span class="fu">sum</span>(weight_2050_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline_labprod <span class="ot">&lt;-</span> ca_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_baseline_labprod) <span class="sc">|&gt;</span> </span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_baseline_labprod =</span> <span class="fu">sum</span>(weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline_labprod =</span> <span class="fu">sum</span>(weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>poor_2050_baseline_labprod <span class="ot">&lt;-</span> ca_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_baseline_labprod) <span class="sc">|&gt;</span> </span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_baseline_labprod =</span> <span class="fu">sum</span>(weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_baseline_labprod =</span> <span class="fu">sum</span>(weight_2050_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_baseline_labprod, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maps" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Maps</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>poor_2023_region <span class="ot">&lt;-</span> ca_microsim02  <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2023) <span class="sc">|&gt;</span>  </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2023 =</span> <span class="fu">sum</span>(weight_2023 <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2023,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2023)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>poor_2023_region_map <span class="ot">&lt;-</span> adm1 <span class="sc">|&gt;</span> </span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2023_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-27"><a href="#cb74-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-28"><a href="#cb74-28" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb74-29"><a href="#cb74-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Racha-Lechkhumi</span><span class="sc">\n</span><span class="st">and Kvemo Svaneti"</span>,</span>
<span id="cb74-30"><a href="#cb74-30" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samegrelo-Zemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb74-31"><a href="#cb74-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samegrelo-</span><span class="sc">\n</span><span class="st">Zemo</span><span class="sc">\n</span><span class="st">Svaneti"</span>,</span>
<span id="cb74-32"><a href="#cb74-32" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Mtskheta-Mtianeti"</span> <span class="sc">~</span></span>
<span id="cb74-33"><a href="#cb74-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Mtskheta-</span><span class="sc">\n</span><span class="st">Mtianeti"</span>,</span>
<span id="cb74-34"><a href="#cb74-34" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samtskhe-Javakheti"</span> <span class="sc">~</span></span>
<span id="cb74-35"><a href="#cb74-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samtskhe-</span><span class="sc">\n</span><span class="st">Javakheti"</span>,</span>
<span id="cb74-36"><a href="#cb74-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb74-37"><a href="#cb74-37" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb74-38"><a href="#cb74-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb74-39"><a href="#cb74-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(pct_poor), </span>
<span id="cb74-40"><a href="#cb74-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb74-41"><a href="#cb74-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb74-42"><a href="#cb74-42" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb74-43"><a href="#cb74-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, pct_poor)</span>
<span id="cb74-44"><a href="#cb74-44" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb74-45"><a href="#cb74-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-46"><a href="#cb74-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb74-47"><a href="#cb74-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-48"><a href="#cb74-48" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb74-49"><a href="#cb74-49" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2023_region_map) <span class="sc">+</span></span>
<span id="cb74-50"><a href="#cb74-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"pct_poor"</span>,</span>
<span id="cb74-51"><a href="#cb74-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">"Percent"</span>, </span>
<span id="cb74-52"><a href="#cb74-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb74-53"><a href="#cb74-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb74-54"><a href="#cb74-54" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale =</span> <span class="fl">0.5</span>,</span>
<span id="cb74-55"><a href="#cb74-55" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>),</span>
<span id="cb74-56"><a href="#cb74-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb74-57"><a href="#cb74-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">textNA =</span> <span class="st">"Unavailable"</span>,</span>
<span id="cb74-58"><a href="#cb74-58" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey"</span></span>
<span id="cb74-59"><a href="#cb74-59" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb74-60"><a href="#cb74-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_poor_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb74-61"><a href="#cb74-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb74-62"><a href="#cb74-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.outside = TRUE,</span></span>
<span id="cb74-63"><a href="#cb74-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb74-64"><a href="#cb74-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#title.snap.to.legend = FALSE,</span></span>
<span id="cb74-65"><a href="#cb74-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> </span>
<span id="cb74-66"><a href="#cb74-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Percent below poverty line"</span>,</span>
<span id="cb74-67"><a href="#cb74-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb74-68"><a href="#cb74-68" aria-hidden="true" tabindex="-1"></a><span class="co">#            outer.margins=c(.10,.10, .10, .10), </span></span>
<span id="cb74-69"><a href="#cb74-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb74-70"><a href="#cb74-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb74-71"><a href="#cb74-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-72"><a href="#cb74-72" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(</span>
<span id="cb74-73"><a href="#cb74-73" aria-hidden="true" tabindex="-1"></a>  map_object,</span>
<span id="cb74-74"><a href="#cb74-74" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/outputs/vulnerability_img/other/poverty_by_region.svg"</span>,</span>
<span id="cb74-75"><a href="#cb74-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">8</span>,</span>
<span id="cb74-76"><a href="#cb74-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">5</span>,</span>
<span id="cb74-77"><a href="#cb74-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">units =</span> <span class="st">"in"</span></span>
<span id="cb74-78"><a href="#cb74-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-79"><a href="#cb74-79" aria-hidden="true" tabindex="-1"></a>map_object</span>
<span id="cb74-80"><a href="#cb74-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-81"><a href="#cb74-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-82"><a href="#cb74-82" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_numbers, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-exposed-and-poor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exposed-and-poor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geo-microsimulation_files/figure-html/fig-exposed-and-poor-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exposed-and-poor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Percent below poverty line by region
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="save-to-excel" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Save to Excel</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>wb <span class="ot">&lt;-</span> <span class="fu">loadWorkbook</span>(<span class="st">"data/outputs/microsimulation_results.xlsx"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(wb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Poverty"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  wb, </span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty"</span>, </span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  poor_2023 , </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">startRow =</span> <span class="dv">3</span>, </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">startCol =</span> <span class="dv">1</span>, </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowNames =</span> F,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.string =</span> <span class="st">""</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  wb, </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty"</span>, </span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>  poor_2030_baseline , </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">startRow =</span> <span class="dv">3</span> <span class="sc">+</span> (<span class="fu">dim</span>(poor_2023)[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">1</span>, </span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">startCol =</span> <span class="dv">1</span>, </span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowNames =</span> F,</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.string =</span> <span class="st">""</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a><span class="fu">writeData</span>(</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  wb, </span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty"</span>, </span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  poor_2050_baseline , </span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">startRow =</span> <span class="dv">3</span> <span class="sc">+</span> (<span class="fu">dim</span>(poor_2023)[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">3</span>) <span class="sc">*</span> <span class="dv">2</span>, </span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">startCol =</span> <span class="dv">1</span>, </span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowNames =</span> F,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.string =</span> <span class="st">""</span>)</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a><span class="fu">saveWorkbook</span>(</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>  wb,</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/outputs/microsimulation_results.xlsx"</span>,</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="end" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> End</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- poverty |&gt; </span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(cpsc) |&gt; </span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     hh_total = sum(weights, na.rm = T),</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     pp_total = sum(weights * hhsize, na.rm =T)</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-geostat_integrated_2023" class="csl-entry" role="listitem">
GEOSTAT. (2023). <em>Integrated <span>Living</span> <span>Conditions</span> <span>Survey</span> 2023</em>.
</div>
<div id="ref-strzepek_estimating_2024" class="csl-entry" role="listitem">
Strzepek, K., Boehlert, B., Castillo, D., &amp; Smet, K. (2024). <em>Estimating the <span>Economic</span> <span>Impacts</span> of <span>Climate</span> <span>Change</span> in <span>Armenia</span></em>. Industrial Economics, Incorporated / The World Bank.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rvconsulting/geo-ccdr24/blob/master/supporting-materials/geo-microsimulation.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rvconsulting/geo-ccdr24/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>