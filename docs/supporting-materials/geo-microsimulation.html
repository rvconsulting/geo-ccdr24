<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Renato Vargas">

<title>Georgia CCDR Microsimulation – Georgia CCDR</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-86daaaaad7353f9cc0c554efc1dd6d94.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6d64e0474c8223c8682d0bdb31002d9b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Georgia CCDR</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Supporting materials</a></li><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Georgia CCDR Microsimulation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Supporting materials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/geo-microsimulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Georgia CCDR Microsimulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/sam-lfs-data-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAM Labor Force Survey Data Request</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/sam-shares-data-request.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">SAM Shares Data Request</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../supporting-materials/vulnerability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vulnerability Analysis</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#preamble" id="toc-preamble" class="nav-link" data-scroll-target="#preamble"><span class="header-section-number">1.1</span> Preamble</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets"><span class="header-section-number">1.2</span> Datasets</a></li>
  </ul></li>
  <li><a href="#data-preparation-demographic-characteristics-income-outliers-and-missings" id="toc-data-preparation-demographic-characteristics-income-outliers-and-missings" class="nav-link" data-scroll-target="#data-preparation-demographic-characteristics-income-outliers-and-missings"><span class="header-section-number">2</span> Data preparation, demographic characteristics, income outliers and missings</a>
  <ul class="collapse">
  <li><a href="#skill-level" id="toc-skill-level" class="nav-link" data-scroll-target="#skill-level"><span class="header-section-number">2.1</span> Skill level</a></li>
  <li><a href="#labor-status-and-economic-activities" id="toc-labor-status-and-economic-activities" class="nav-link" data-scroll-target="#labor-status-and-economic-activities"><span class="header-section-number">2.2</span> Labor status and Economic Activities</a></li>
  <li><a href="#types-of-income" id="toc-types-of-income" class="nav-link" data-scroll-target="#types-of-income"><span class="header-section-number">2.3</span> Types of income</a></li>
  <li><a href="#missing-and-outliers" id="toc-missing-and-outliers" class="nav-link" data-scroll-target="#missing-and-outliers"><span class="header-section-number">2.4</span> Missing and outliers</a></li>
  <li><a href="#the-income-simulation-regression" id="toc-the-income-simulation-regression" class="nav-link" data-scroll-target="#the-income-simulation-regression"><span class="header-section-number">2.5</span> The income simulation regression</a>
  <ul class="collapse">
  <li><a href="#total-income-and-shares" id="toc-total-income-and-shares" class="nav-link" data-scroll-target="#total-income-and-shares"><span class="header-section-number">2.5.1</span> Total income and shares</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#un-population-projections" id="toc-un-population-projections" class="nav-link" data-scroll-target="#un-population-projections"><span class="header-section-number">3</span> UN Population Projections</a></li>
  <li><a href="#macro-scenarios" id="toc-macro-scenarios" class="nav-link" data-scroll-target="#macro-scenarios"><span class="header-section-number">4</span> Macro Scenarios</a></li>
  <li><a href="#reweighting-of-the-dataset" id="toc-reweighting-of-the-dataset" class="nav-link" data-scroll-target="#reweighting-of-the-dataset"><span class="header-section-number">5</span> Reweighting of the dataset</a>
  <ul class="collapse">
  <li><a href="#aggregation-of-population-data" id="toc-aggregation-of-population-data" class="nav-link" data-scroll-target="#aggregation-of-population-data"><span class="header-section-number">5.1</span> Aggregation of population data</a></li>
  <li><a href="#reweigting" id="toc-reweigting" class="nav-link" data-scroll-target="#reweigting"><span class="header-section-number">5.2</span> Reweigting</a></li>
  </ul></li>
  <li><a href="#rescaling-labor-income-according-to-changes-to-the-wage-bill" id="toc-rescaling-labor-income-according-to-changes-to-the-wage-bill" class="nav-link" data-scroll-target="#rescaling-labor-income-according-to-changes-to-the-wage-bill"><span class="header-section-number">6</span> Rescaling labor income according to changes to the wage bill</a></li>
  <li><a href="#microsimulations" id="toc-microsimulations" class="nav-link" data-scroll-target="#microsimulations"><span class="header-section-number">7</span> Microsimulations</a>
  <ul class="collapse">
  <li><a href="#macro-scenarios-without-additional-impacts" id="toc-macro-scenarios-without-additional-impacts" class="nav-link" data-scroll-target="#macro-scenarios-without-additional-impacts"><span class="header-section-number">7.1</span> Macro scenarios without additional impacts</a></li>
  <li><a href="#climate-change" id="toc-climate-change" class="nav-link" data-scroll-target="#climate-change"><span class="header-section-number">7.2</span> Climate change</a></li>
  </ul></li>
  <li><a href="#agregate-consumption-effects" id="toc-agregate-consumption-effects" class="nav-link" data-scroll-target="#agregate-consumption-effects"><span class="header-section-number">8</span> Agregate consumption effects</a></li>
  <li><a href="#poverty-tabulates" id="toc-poverty-tabulates" class="nav-link" data-scroll-target="#poverty-tabulates"><span class="header-section-number">9</span> Poverty tabulates</a></li>
  <li><a href="#inequality-measurements" id="toc-inequality-measurements" class="nav-link" data-scroll-target="#inequality-measurements"><span class="header-section-number">10</span> Inequality measurements</a></li>
  <li><a href="#maps" id="toc-maps" class="nav-link" data-scroll-target="#maps"><span class="header-section-number">11</span> Maps</a></li>
  <li><a href="#save-to-excel" id="toc-save-to-excel" class="nav-link" data-scroll-target="#save-to-excel"><span class="header-section-number">12</span> Save to Excel</a></li>
  <li><a href="#end" id="toc-end" class="nav-link" data-scroll-target="#end"><span class="header-section-number">13</span> End</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/rvconsulting/geo-ccdr24/blob/master/supporting-materials/geo-microsimulation.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rvconsulting/geo-ccdr24/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Supporting materials</a></li><li class="breadcrumb-item"><a href="../supporting-materials/geo-microsimulation.html">Georgia CCDR Microsimulation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Georgia CCDR Microsimulation</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Renato Vargas <a href="mailto:renovargas@gmail.com" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Consultant for The World Bank
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this calculation file, we “age” the Georgian household survey according to demographic projections and different macroeconomic scenarios to explore the impact of climate-related risks and policy measures on the consumption expenditure distribution. It is part of a larger project with all background contributions to Georgia’s CCDR, <a href="https://rvconsulting.github.io/geo-ccdr24/supporting-materials/geo-microsimulation.html">available in this repository</a>.</p>
<p>Using RStudio project makes it possible to not use <code>setwd()</code> to establish the root directory and refer to subdirectories in a relative manner, making interoperability easier within teams and not hard coding a particular computer’s file structure into the code. If you are using Positron or Visual Studio Code (and the Quarto extension) just “open folder” at the root of the repository. If you are using R directly, just add <code>setwd(r'(C:\My\path\to\project\root)')</code> at the beginning of your coding session.</p>
<section id="preamble" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="preamble"><span class="header-section-number">1.1</span> Preamble</h2>
<p>We start with a clean environment, making sure that any objects from a previous session are not present. We keep our country ISO code in a variable <code>iso</code> in case we need it later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean workspace</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Georgia country ISO code</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>iso <span class="ot">&lt;-</span> <span class="st">"GEO"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey year</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>survey_year <span class="ot">&lt;-</span> <span class="dv">2023</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # Exchange rate USD per GEL (Multiply by this to show results in USD)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># er &lt;- 0.37</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Exchange rate 2017 (PPP) 2.6280 GEL per 1 US$ </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Poverty lines</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>pline0 <span class="ot">&lt;-</span> <span class="fl">212.8149</span> <span class="co"># Official USD3.60/Person/Day</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Using Georgia CPI, the 6.85 line would be (2023) GEL 355.10/person/month</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Using $3.60 in email, the 6.85 line would be (2023) GEL 404.9395</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>pline61 <span class="ot">&lt;-</span> <span class="fl">355.10</span> <span class="co"># Intl. Poverty line of USD6.85/Person/Day</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>pline62 <span class="ot">&lt;-</span> <span class="fl">404.9395</span> <span class="co"># Intl. Poverty line of USD6.85/Person/Day</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Poverty line used in the script below</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>pline <span class="ot">&lt;-</span> pline0</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Years of interest for our macroeconomic scenario analysis</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>analysis_years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We call the appropriate libraries.</p>
<p>Rather than calling our libraries as we go, we will make sure we have everything we need from the beginning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-load-packages"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-load-packages-1"><a href="#lst-load-packages-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># includes dplyr, ggplot2, purr...</span></span>
<span id="lst-load-packages-2"><a href="#lst-load-packages-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)     <span class="co"># to read SPSS and Stata datasets</span></span>
<span id="lst-load-packages-3"><a href="#lst-load-packages-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)    <span class="co"># to read from MS-Excel</span></span>
<span id="lst-load-packages-4"><a href="#lst-load-packages-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx)  <span class="co"># to write to MS-Excel.</span></span>
<span id="lst-load-packages-5"><a href="#lst-load-packages-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)        <span class="co"># pretty tables</span></span>
<span id="lst-load-packages-6"><a href="#lst-load-packages-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)       <span class="co"># companion to applied regression</span></span>
<span id="lst-load-packages-7"><a href="#lst-load-packages-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)    <span class="co"># regression models</span></span>
<span id="lst-load-packages-8"><a href="#lst-load-packages-8" aria-hidden="true" tabindex="-1"></a><span class="co">#library(anesrake)  </span></span>
<span id="lst-load-packages-9"><a href="#lst-load-packages-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Raking reweighting but we don't load it, because </span></span>
<span id="lst-load-packages-10"><a href="#lst-load-packages-10" aria-hidden="true" tabindex="-1"></a><span class="co"># it changes the meaning of summarize from dplyr, </span></span>
<span id="lst-load-packages-11"><a href="#lst-load-packages-11" aria-hidden="true" tabindex="-1"></a><span class="co"># so we use the form anesrake::anesrake() when using it.</span></span>
<span id="lst-load-packages-12"><a href="#lst-load-packages-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)   <span class="co"># pretty subtotals</span></span>
<span id="lst-load-packages-13"><a href="#lst-load-packages-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)     <span class="co"># More regressions</span></span>
<span id="lst-load-packages-14"><a href="#lst-load-packages-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)       <span class="co"># Calculate moving window average and max value</span></span>
<span id="lst-load-packages-15"><a href="#lst-load-packages-15" aria-hidden="true" tabindex="-1"></a><span class="co"># library(Hmisc)     # Estimates deciles, quintiles but use :: version too</span></span>
<span id="lst-load-packages-16"><a href="#lst-load-packages-16" aria-hidden="true" tabindex="-1"></a><span class="co"># library(ineq) # Inequality measures</span></span>
<span id="lst-load-packages-17"><a href="#lst-load-packages-17" aria-hidden="true" tabindex="-1"></a><span class="co"># library(acid) # Inequality measures we use acid::weighted.gini()</span></span>
<span id="lst-load-packages-18"><a href="#lst-load-packages-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-load-packages-19"><a href="#lst-load-packages-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Geopackages</span></span>
<span id="lst-load-packages-20"><a href="#lst-load-packages-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="co"># to read and write shapefile maps</span></span>
<span id="lst-load-packages-21"><a href="#lst-load-packages-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="co"># to perform geocalculations</span></span>
<span id="lst-load-packages-22"><a href="#lst-load-packages-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)      <span class="co"># for static and interactive maps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="datasets" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="datasets"><span class="header-section-number">1.2</span> Datasets</h2>
<p>We then load the datasets that we need for this study. These are based on Georgia’s Integrated Living Conditions Survey 2022 <span class="citation" data-cites="geostat_integrated_2023">(<a href="#ref-geostat_integrated_2023" role="doc-biblioref">GEOSTAT, 2023</a>)</span>. We make a note that the household identification variable is <code>UID</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="original-datasets"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="original-datasets-1"><a href="#original-datasets-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Household Unique ID, Weights, Location and other basic variables</span></span>
<span id="original-datasets-2"><a href="#original-datasets-2" aria-hidden="true" tabindex="-1"></a>hh_basics <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-3"><a href="#original-datasets-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/sysschedule.sav"</span>) <span class="sc">|&gt;</span></span>
<span id="original-datasets-4"><a href="#original-datasets-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-5"><a href="#original-datasets-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-6"><a href="#original-datasets-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-7"><a href="#original-datasets-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Household size (includes no. of family members)</span></span>
<span id="original-datasets-8"><a href="#original-datasets-8" aria-hidden="true" tabindex="-1"></a>hh_size <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-9"><a href="#original-datasets-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/familysize.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-10"><a href="#original-datasets-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-11"><a href="#original-datasets-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-12"><a href="#original-datasets-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-13"><a href="#original-datasets-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Processed income at household level</span></span>
<span id="original-datasets-14"><a href="#original-datasets-14" aria-hidden="true" tabindex="-1"></a>hh_income <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-15"><a href="#original-datasets-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblincomes.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-16"><a href="#original-datasets-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-17"><a href="#original-datasets-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-18"><a href="#original-datasets-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-19"><a href="#original-datasets-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Consumption aggregate at household level </span></span>
<span id="original-datasets-20"><a href="#original-datasets-20" aria-hidden="true" tabindex="-1"></a>hh_expenditure <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-21"><a href="#original-datasets-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblexpenditures.sav"</span>)<span class="sc">|&gt;</span> </span>
<span id="original-datasets-22"><a href="#original-datasets-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="co"># rename total expenditure variables</span></span>
<span id="original-datasets-23"><a href="#original-datasets-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure =</span> MTlianixarjebi_,</span>
<span id="original-datasets-24"><a href="#original-datasets-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure_aeq06 =</span> MTlianimoxmareba_EqAdScale,</span>
<span id="original-datasets-25"><a href="#original-datasets-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_expenditure_aeq08 =</span> Mtlianimoxmareba_EqAdScale_08) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-26"><a href="#original-datasets-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-27"><a href="#original-datasets-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-28"><a href="#original-datasets-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-29"><a href="#original-datasets-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Characteristics of the dwelling</span></span>
<span id="original-datasets-30"><a href="#original-datasets-30" aria-hidden="true" tabindex="-1"></a>hh_chars <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-31"><a href="#original-datasets-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda01.sav"</span>)<span class="sc">|&gt;</span></span>
<span id="original-datasets-32"><a href="#original-datasets-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-33"><a href="#original-datasets-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID))</span>
<span id="original-datasets-34"><a href="#original-datasets-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-35"><a href="#original-datasets-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Persons (pp)</span></span>
<span id="original-datasets-36"><a href="#original-datasets-36" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-37"><a href="#original-datasets-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda02.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-38"><a href="#original-datasets-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-39"><a href="#original-datasets-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-40"><a href="#original-datasets-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo))</span>
<span id="original-datasets-41"><a href="#original-datasets-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-42"><a href="#original-datasets-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor (pp)</span></span>
<span id="original-datasets-43"><a href="#original-datasets-43" aria-hidden="true" tabindex="-1"></a>pp_labor <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-44"><a href="#original-datasets-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblshinda05_1.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-45"><a href="#original-datasets-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-46"><a href="#original-datasets-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-47"><a href="#original-datasets-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo),</span>
<span id="original-datasets-48"><a href="#original-datasets-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q5  =</span> <span class="fu">as.integer</span>(Q5),</span>
<span id="original-datasets-49"><a href="#original-datasets-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q12 =</span> <span class="fu">as.integer</span>(Q12)) </span>
<span id="original-datasets-50"><a href="#original-datasets-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-51"><a href="#original-datasets-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Poverty</span></span>
<span id="original-datasets-52"><a href="#original-datasets-52" aria-hidden="true" tabindex="-1"></a>poverty <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(</span>
<span id="original-datasets-53"><a href="#original-datasets-53" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/POVERTY_stata.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-54"><a href="#original-datasets-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">official_pline =</span> pline) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-55"><a href="#original-datasets-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-56"><a href="#original-datasets-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-57"><a href="#original-datasets-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2023 =</span> <span class="fu">if_else</span>(aecons <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="original-datasets-58"><a href="#original-datasets-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-59"><a href="#original-datasets-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Ind. Poverty</span></span>
<span id="original-datasets-60"><a href="#original-datasets-60" aria-hidden="true" tabindex="-1"></a>ind_poverty <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(</span>
<span id="original-datasets-61"><a href="#original-datasets-61" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/IND_POVERTY_stata.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-62"><a href="#original-datasets-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">MemberNo =</span> memberno) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-63"><a href="#original-datasets-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="original-datasets-64"><a href="#original-datasets-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">UID =</span> <span class="fu">as.integer</span>(UID),</span>
<span id="original-datasets-65"><a href="#original-datasets-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberNo =</span> <span class="fu">as.integer</span>(MemberNo))</span>
<span id="original-datasets-66"><a href="#original-datasets-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-67"><a href="#original-datasets-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Food diary</span></span>
<span id="original-datasets-68"><a href="#original-datasets-68" aria-hidden="true" tabindex="-1"></a>food_q <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="original-datasets-69"><a href="#original-datasets-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblconsumption.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-70"><a href="#original-datasets-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span>
<span id="original-datasets-71"><a href="#original-datasets-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-72"><a href="#original-datasets-72" aria-hidden="true" tabindex="-1"></a>food_price <span class="ot">&lt;-</span> <span class="fu">read_sav</span>( </span>
<span id="original-datasets-73"><a href="#original-datasets-73" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/ilcs_2023/tblavgprices.sav"</span>)</span>
<span id="original-datasets-74"><a href="#original-datasets-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-75"><a href="#original-datasets-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Maps</span></span>
<span id="original-datasets-76"><a href="#original-datasets-76" aria-hidden="true" tabindex="-1"></a>adm1 <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/gis/geo-adm1.shp"</span>) <span class="sc">|&gt;</span></span>
<span id="original-datasets-77"><a href="#original-datasets-77" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(RegNo, region, ADM1_PCODE, ADM1_EN, ADM1_KA, geometry) <span class="sc">|&gt;</span></span>
<span id="original-datasets-78"><a href="#original-datasets-78" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(ADM1_PCODE)</span>
<span id="original-datasets-79"><a href="#original-datasets-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="original-datasets-80"><a href="#original-datasets-80" aria-hidden="true" tabindex="-1"></a>regions <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(adm1) <span class="sc">|&gt;</span> </span>
<span id="original-datasets-81"><a href="#original-datasets-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>geometry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need look-up tables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>sam_activities <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM-REV2"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">"text"</span>, <span class="st">"text"</span>, <span class="st">"text"</span>,<span class="st">"text"</span>, <span class="st">"numeric"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>sam_factors <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM factors"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>coicop <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"COICOP"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">simple_code =</span> <span class="fu">as.integer</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>, <span class="st">""</span>, Coicop)))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>coicop_filtered <span class="ot">&lt;-</span> coicop <span class="sc">|&gt;</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( <span class="fu">nchar</span>(<span class="fu">as.character</span>(simple_code)) <span class="sc">&gt;=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have Continuous Labor Survey data at the individual level, which will come in handy if we do not get access to the labor part of the ILCS. See data folder for documents describing the datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="labor-survey"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="labor-survey-1"><a href="#labor-survey-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor Force Survey</span></span>
<span id="labor-survey-2"><a href="#labor-survey-2" aria-hidden="true" tabindex="-1"></a>lfs_2023 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="labor-survey-3"><a href="#labor-survey-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/lfs_2023/LFS_ECSTAT_ENG_2023.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="labor-survey-4"><a href="#labor-survey-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span>
<span id="labor-survey-5"><a href="#labor-survey-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="labor-survey-6"><a href="#labor-survey-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor Force Survey Demographic Characteristics</span></span>
<span id="labor-survey-7"><a href="#labor-survey-7" aria-hidden="true" tabindex="-1"></a>lfs_2023_dem <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(</span>
<span id="labor-survey-8"><a href="#labor-survey-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data/lfs_2023/LFS_Demographic_ENG_2023.sav"</span>) <span class="sc">|&gt;</span> </span>
<span id="labor-survey-9"><a href="#labor-survey-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">UID =</span> UID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will work non-destructively, meaning we will not rewrite these data sets and we will only create intermediate data frame objects from them to perform transformations, selections and other data management tasks. For example, we will keep household assignment to poverty status and consumption deciles handy by creating a subset of our <code>hh_expenditure</code> data with only our household identifiers, deciles, and poverty if available.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-deciles"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-deciles-1"><a href="#lst-deciles-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We will estimate deciles from consumption</span></span>
<span id="lst-deciles-2"><a href="#lst-deciles-2" aria-hidden="true" tabindex="-1"></a>deciles <span class="ot">&lt;-</span> hh_expenditure <span class="sc">|&gt;</span> </span>
<span id="lst-deciles-3"><a href="#lst-deciles-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( </span>
<span id="lst-deciles-4"><a href="#lst-deciles-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep household id and expenditure variables</span></span>
<span id="lst-deciles-5"><a href="#lst-deciles-5" aria-hidden="true" tabindex="-1"></a>    UID, </span>
<span id="lst-deciles-6"><a href="#lst-deciles-6" aria-hidden="true" tabindex="-1"></a>    total_expenditure,</span>
<span id="lst-deciles-7"><a href="#lst-deciles-7" aria-hidden="true" tabindex="-1"></a>    total_expenditure_aeq06, <span class="co"># Adult equivalent * 0.6</span></span>
<span id="lst-deciles-8"><a href="#lst-deciles-8" aria-hidden="true" tabindex="-1"></a>    total_expenditure_aeq08) <span class="co"># Adult equivalent * 0.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our population data comes from UN’s projections.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-population-projections"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-population-projections-1"><a href="#lst-population-projections-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/population/UN2022_population.dta"</span>) <span class="sc">|&gt;</span> </span>
<span id="lst-population-projections-2"><a href="#lst-population-projections-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> iso) <span class="co"># we filter for Georgia</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The macro scenario dataset is an input provided by the Macroeconomic CGE simulation team, with yearly information on GDP, working age population, employment by economic activity (for an aggregation of three sectors: agriculture, manufacturing, and services), wages by economic activity, value added by economic activity, remittances, consumer price index, food price index and energy price index (for a bundle of gas, oil, coal, electricity) by decile (10 representative households in the macro model), and carbon tax revenue transfers to household deciles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-macro-scenarios"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-macro-scenarios-1"><a href="#lst-import-macro-scenarios-1" aria-hidden="true" tabindex="-1"></a>scenario_file <span class="ot">&lt;-</span> <span class="st">"data/sam/MacroScenarioInformation_GEO.xlsx"</span></span>
<span id="lst-import-macro-scenarios-2"><a href="#lst-import-macro-scenarios-2" aria-hidden="true" tabindex="-1"></a>scenario_varlist <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">"data/sam/GEO_Macro_varlist.xlsx"</span>) <span class="sc">|&gt;</span> </span>
<span id="lst-import-macro-scenarios-3"><a href="#lst-import-macro-scenarios-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>category)</span>
<span id="lst-import-macro-scenarios-4"><a href="#lst-import-macro-scenarios-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prices_2030 &lt;-</span></span>
<span id="lst-import-macro-scenarios-5"><a href="#lst-import-macro-scenarios-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   read.csv("data/ARM-Microsimulation/prices2030.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Economic Activities in the Survey are in Georgian. The following dataset is a lookup table with the English names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-economic-activity-codes"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-economic-activity-codes-1"><a href="#lst-import-economic-activity-codes-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equivalence table</span></span>
<span id="lst-import-economic-activity-codes-2"><a href="#lst-import-economic-activity-codes-2" aria-hidden="true" tabindex="-1"></a>sectors <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="lst-import-economic-activity-codes-3"><a href="#lst-import-economic-activity-codes-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/classifications.xlsx"</span>,</span>
<span id="lst-import-economic-activity-codes-4"><a href="#lst-import-economic-activity-codes-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"SAM-REV2"</span>,</span>
<span id="lst-import-economic-activity-codes-5"><a href="#lst-import-economic-activity-codes-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> T,</span>
<span id="lst-import-economic-activity-codes-6"><a href="#lst-import-economic-activity-codes-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_types =</span> <span class="st">"text"</span>,</span>
<span id="lst-import-economic-activity-codes-7"><a href="#lst-import-economic-activity-codes-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also have an Excel file with changes to labor productivity due to climate variability, by sector. Also, we have livestock productivity changes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="lst-import-labor-productivity"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-import-labor-productivity-1"><a href="#lst-import-labor-productivity-1" aria-hidden="true" tabindex="-1"></a>labor_productivity <span class="ot">&lt;-</span></span>
<span id="lst-import-labor-productivity-2"><a href="#lst-import-labor-productivity-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="lst-import-labor-productivity-3"><a href="#lst-import-labor-productivity-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/climate_productivity/GEO_labour_REF_shock_admin1_bySector.csv"</span>)</span>
<span id="lst-import-labor-productivity-4"><a href="#lst-import-labor-productivity-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-import-labor-productivity-5"><a href="#lst-import-labor-productivity-5" aria-hidden="true" tabindex="-1"></a>agriculture_productivity <span class="ot">&lt;-</span></span>
<span id="lst-import-labor-productivity-6"><a href="#lst-import-labor-productivity-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="lst-import-labor-productivity-7"><a href="#lst-import-labor-productivity-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/climate_productivity/GEO_agriculture_revenue_impact_GCM-Historical.csv"</span></span>
<span id="lst-import-labor-productivity-8"><a href="#lst-import-labor-productivity-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="lst-import-labor-productivity-9"><a href="#lst-import-labor-productivity-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-import-labor-productivity-10"><a href="#lst-import-labor-productivity-10" aria-hidden="true" tabindex="-1"></a>livestock_productivity <span class="ot">&lt;-</span></span>
<span id="lst-import-labor-productivity-11"><a href="#lst-import-labor-productivity-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>(</span>
<span id="lst-import-labor-productivity-12"><a href="#lst-import-labor-productivity-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/climate_productivity/GEO_livestock_REF_shock_admin1_high_prop_holstein.csv"</span></span>
<span id="lst-import-labor-productivity-13"><a href="#lst-import-labor-productivity-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And finally, direct effects on consumption of Macro scenarios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># HH Consumption Macro Effect</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>hh_consumption_effects <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/sam/MacroconsumptionEffect_HH_GEO.xlsx"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sheet =</span> <span class="st">"HH_consumption_value"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">col_names =</span> F,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">range =</span> <span class="st">"A90:AD119"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...1`
• `` -&gt; `...2`
• `` -&gt; `...3`
• `` -&gt; `...4`
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...7`
• `` -&gt; `...8`
• `` -&gt; `...9`
• `` -&gt; `...10`
• `` -&gt; `...11`
• `` -&gt; `...12`
• `` -&gt; `...13`
• `` -&gt; `...14`
• `` -&gt; `...15`
• `` -&gt; `...16`
• `` -&gt; `...17`
• `` -&gt; `...18`
• `` -&gt; `...19`
• `` -&gt; `...20`
• `` -&gt; `...21`
• `` -&gt; `...22`
• `` -&gt; `...23`
• `` -&gt; `...24`
• `` -&gt; `...25`
• `` -&gt; `...26`
• `` -&gt; `...27`
• `` -&gt; `...28`
• `` -&gt; `...29`
• `` -&gt; `...30`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hh_consumption_effects) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"scenario_id"</span>, <span class="st">"hh_type"</span>,<span class="fu">c</span>(<span class="dv">2023</span><span class="sc">:</span><span class="dv">2050</span>))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>hh_consumption_effects <span class="ot">&lt;-</span> hh_consumption_effects <span class="sc">|&gt;</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario_id =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      scenario_id <span class="sc">==</span> <span class="st">"ccdr_all_dry_hot"</span> <span class="sc">~</span> <span class="st">"dryhot"</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      scenario_id <span class="sc">==</span> <span class="st">"ccdr_all_wet_warm"</span> <span class="sc">~</span> <span class="st">"wetwarm"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      scenario_id <span class="sc">==</span> <span class="st">"ccdr_NZS_10_10"</span> <span class="sc">~</span> <span class="st">"nzs"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> scenario_id</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">|&gt;</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="data-preparation-demographic-characteristics-income-outliers-and-missings" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data preparation, demographic characteristics, income outliers and missings</h1>
<p>We start with various renames for standardization. Naming conventions in the guidance code use traditional abbreviations like <code>nli</code> for non-lablor income. We are opting for more descriptive variable names like <code>non_labor_income</code>, <code>labor_income</code>, etc. to have more easily readable code. We make an exception for total consumption (<code>tc</code>), because it’s a variable that we use in every scenario and it supersedes lenght limits when adding scenario identifiers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Uncomment the correct total expenditure variable below</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ex <span class="ot">&lt;-</span> hh_expenditure <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tc =</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      total_expenditure</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="co">#total_expenditure_aeq06 # Adult equivalent * 0.6</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="co">#total_expenditure_aeq08 # Adult equivalent * 0.8</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We extract demographic characteristics for each individual.</p>
<section id="skill-level" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="skill-level"><span class="header-section-number">2.1</span> Skill level</h2>
<p>For skill level, we will use information on schooling from <code>pp$Education</code> (<code>TblShinda02</code>), which has the following levels:</p>
<ol type="1">
<li>Illiterate</li>
<li>Do not have primary education but can read and write</li>
<li>Pre-primary education</li>
<li>Primary education</li>
<li>Lower secondary education</li>
<li>Upper secondary education</li>
<li>Vocational education without secondary general education</li>
<li>Vocational education on the base of lower secondary education with secondary general education certificate</li>
<li>Vocational education on the base of secondary general education (except higher professional education)</li>
<li>Higher professional program</li>
<li>Bachelor or equivalent</li>
<li>Master or equivalent</li>
<li>Doctor or equivalent</li>
</ol>
<p>We need three skill levels for our SAM template, so we map these levels to:</p>
<p>Low skill (1 - 5): Illiterate through lower secondary. Medium skill (6 - 9): Upper secondary through vocational education. High skill (10 - 13): Higher professional program through Doctor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pp_factor_descriptors <span class="ot">&lt;-</span> pp <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, MemberNo, Gender, Age, Education) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Gender =</span> <span class="fu">factor</span>(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    Gender,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">SkillLevel =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      Education <span class="sc">&gt;</span> <span class="dv">9</span> <span class="sc">&amp;</span> Education <span class="sc">&lt;=</span> <span class="dv">13</span> <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span> ) ) <span class="sc">|&gt;</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">SkillLevel =</span> <span class="fu">factor</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      SkillLevel, </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>( <span class="st">"Low Skill"</span>, <span class="st">"Medium Skill"</span>, <span class="st">"High Skill"</span>))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have skill levels, we need to add information on urban/rural (from <code>hh_basics</code>) and quintile (from <code>ind_poverty</code>), and type of income earner (from <code>pp_labor</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>urb_rur <span class="ot">&lt;-</span> hh_basics <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID,QuartNo, UrbanOrRural, RegNo, Weights) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">UrbanOrRural =</span> <span class="fu">factor</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>      UrbanOrRural,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Rural"</span>, <span class="st">"Urban"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>quintiles <span class="ot">&lt;-</span> poverty <span class="sc">|&gt;</span> </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, quintilc, decilc, hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Quintile =</span> quintilc,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Decile =</span> decilc) <span class="sc">|&gt;</span> </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Quintile =</span> <span class="fu">factor</span>(</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>      Quintile,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Q1"</span>, <span class="st">"Q2"</span>, <span class="st">"Q3"</span>, <span class="st">"Q4"</span>, <span class="st">"Q5"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Decile =</span> <span class="fu">factor</span>(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      Decile,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D01"</span>, <span class="st">"D02"</span>, <span class="st">"D03"</span>, <span class="st">"D04"</span>, <span class="st">"D05"</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"D06"</span>, <span class="st">"D07"</span>, <span class="st">"D08"</span>, <span class="st">"D09"</span>, <span class="st">"D10"</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>is_employed <span class="ot">&lt;-</span> ind_poverty <span class="sc">|&gt;</span> </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span> </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">employed =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        empl <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> T,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        empl <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> F,</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>      MemberId, employed</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>pp_lmarket0 <span class="ot">&lt;-</span> pp_labor <span class="sc">|&gt;</span> </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span> </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(UID,MemberNo))</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>pp_lmarket1 <span class="ot">&lt;-</span> pp_factor_descriptors <span class="sc">|&gt;</span> </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(urb_rur, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(quintiles, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pp_lmarket0, <span class="fu">join_by</span>(MemberId)) <span class="sc">|&gt;</span> </span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">c</span>(UID, MemberNo, MemberId, QuartNo), <span class="at">.before =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="labor-status-and-economic-activities" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="labor-status-and-economic-activities"><span class="header-section-number">2.2</span> Labor status and Economic Activities</h2>
<p>We work with labor status from <code>Shinda05_1</code>. Since, upon import NACE 2 codes are converted to numbers, we need to convert them back to text, so that we can keep zeros to the left for proper order. We then extract the first two digits and find the correspondence to Rev.&nbsp;2 from the SAM using the look-up table <code>sam_activities</code>. For proper order, we convert the SAM activities columns for job 1 and job 2 to factor, using the order from the dataset <code>sam_factors</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>pp_microsim01 <span class="ot">&lt;-</span> pp_lmarket1 <span class="sc">|&gt;</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">MemberId =</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%06d"</span>, UID), <span class="fu">sprintf</span>(<span class="st">"%02d"</span>, MemberNo))) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Job 1 NACE Rev 2 code. </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q5  =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q5),<span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%04d"</span>, Q5)), <span class="cn">NA</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Job 2 NACE Rev 2 code.</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q12 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q12),<span class="fu">paste0</span>(<span class="fu">sprintf</span>(<span class="st">"%04d"</span>, Q12)), <span class="cn">NA</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">job1 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q5),<span class="fu">substr</span>(Q5, <span class="dv">1</span>, <span class="dv">2</span>), <span class="cn">NA</span>),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">job2 =</span> <span class="fu">if_else</span>(<span class="sc">!</span><span class="fu">is.na</span>(Q12),<span class="fu">substr</span>(Q12, <span class="dv">1</span>, <span class="dv">2</span>), <span class="cn">NA</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Is employed?</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    is_employed,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(MemberId)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We match to Rev 2 and SAM classifications (for job 1 and job 2)</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    sam_activities[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)], </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(job1 <span class="sc">==</span> rev2_2d)) <span class="sc">|&gt;</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    sam_activities[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>)],</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(job2 <span class="sc">==</span> rev2_2d),</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"_job1"</span>, <span class="st">"_job2"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># And convert to factors for proper order</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">factor</span>(</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      SAM3_job1, </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">factor</span>(</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      SAM3_job2, </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="types-of-income" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="types-of-income"><span class="header-section-number">2.3</span> Types of income</h2>
<p>Before making our multi-dimensional tables, we need to identify different types of income. f-lab (wages) and f-surp (capital income). The instruction is that f-surp needs to be split into wages to entrepreneurs/self employed and capital income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pp_microsim02 <span class="ot">&lt;-</span> pp_microsim01 <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We add accross three months for each source (and coalesce the NAs to 0)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job1 =</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q8_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>))),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job2 =</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q14_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>))),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">surplus_income =</span> </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Q10_faqti_"</span>), \(x) <span class="fu">coalesce</span>(x, <span class="dv">0</span>)))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We also add factor labels to Employment Status</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">lstatus1 =</span> <span class="fu">factor</span>(</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>      Q7,</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Employee"</span>, <span class="st">"Employer"</span>, <span class="st">"Own Account (Non-Ag.)"</span>, </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Own Account (Ag.)"</span>, <span class="st">"Unpaid Worker"</span>, <span class="st">"Other"</span>))</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lstatus2 =</span> <span class="fu">factor</span>(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>      Q13,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>),</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Employee"</span>, <span class="st">"Employer"</span>, <span class="st">"Own Account (Non-Ag.)"</span>, </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Own Account (Ag.)"</span>, <span class="st">"Unpaid Worker"</span>, <span class="st">"Other"</span>))</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="missing-and-outliers" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="missing-and-outliers"><span class="header-section-number">2.4</span> Missing and outliers</h2>
<p>In this section we will assign a labor income for job1 holders with <code>!lstatus1 %in% c(2,5) &amp; labor_income_job1 == 0</code> based on predicted income from everyone else who doesn’t meet the condition. We will estimate annual_labor_total after predictions.</p>
<p>Looking at the data we see that only those that report being an employee or “other” report having labor income 1 or 2; Employer and Own Account non-ag report having surplus; and own account ag and (of course) unpaid worker</p>
<p>We first identify who needs predictions for job1, job2, and surplus. We default to <code>NA</code> because we want to preserve the logic of those who don’t have an income, because they aren’t supposed to have one. However, this introduces an uncertainty element when predicting further down the line, because subsetting does not allow NA’s. Even if we want to match just <code>TRUEs</code>. So it’s a double-edged sword. The fix was using <code>which()</code> to find row numbers of those with <code>TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>pp_microsim03 <span class="ot">&lt;-</span> pp_microsim02 <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_job1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) <span class="sc">~</span> F,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_job2 =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)) <span class="sc">~</span> F,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q13) <span class="sc">&amp;</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fix_surplus =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)) <span class="sc">~</span> F,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> surplus_income <span class="sc">&gt;</span>  <span class="dv">0</span>) <span class="sc">~</span> F,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>      (<span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> surplus_income <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> T,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outliers and need to predict.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pp_microsim04 <span class="ot">&lt;-</span> pp_microsim03 <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_job1    =</span> <span class="fu">sd</span>(labor_income_job1, <span class="at">na.rm =</span> T),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_job2    =</span> <span class="fu">sd</span>(labor_income_job2, <span class="at">na.rm =</span> T),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_surplus =</span> <span class="fu">sd</span>(surplus_income   , <span class="at">na.rm =</span> T),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job1 =</span> labor_income_job1 <span class="sc">/</span> sd_job1,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job2 =</span> labor_income_job2 <span class="sc">/</span> sd_job2,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">d_job1 =</span> surplus_income <span class="sc">/</span> sd_surplus,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Assign sector to missings.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pp_microsim05 <span class="ot">&lt;-</span> pp_microsim04 <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a temporary variable 'other_sector' as a factor</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_sector_job1 =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(SAM3_job1) <span class="sc">&amp;</span> SAM3_job1 <span class="sc">%in%</span> <span class="fu">levels</span>(SAM3_job1) <span class="sc">~</span> SAM3_job1,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA_character_</span> <span class="co"># Keep as character NA for now</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(other_sector_job1, <span class="at">.direction =</span> <span class="st">"downup"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">other_sector_job1 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Q7), <span class="cn">NA_character_</span>, other_sector_job1)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Impute missing 'sector' values based on 'other_sector'</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">as.factor</span>(<span class="fu">if_else</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(<span class="fu">coalesce</span>(<span class="fu">as.character</span>(SAM3_job1), other_sector_job1)),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(SAM3_job1)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">as.factor</span>(<span class="fu">if_else</span>(</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q13),</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(<span class="fu">coalesce</span>(<span class="fu">as.character</span>(SAM3_job2), other_sector_job1)),</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(SAM3_job2)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    )),</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Re-establish levels and labels</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job1 =</span> <span class="fu">factor</span>(SAM3_job1, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>)),</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">SAM3_job2 =</span> <span class="fu">factor</span>(SAM3_job2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Agriculture"</span>, <span class="st">"Manufactures"</span>, <span class="st">"Services"</span>))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-income-simulation-regression" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="the-income-simulation-regression"><span class="header-section-number">2.5</span> The income simulation regression</h2>
<p>Since labor income was a key variable, which we needed to match with the future wage bill by economic activity, we first checked for missing values among employed individuals. We found that almost a third of respondents (28.6%) did not report income for either their primary or secondary job. To overcome this limitation, we used the available information from the remaining respondents to estimate an extended Mincer equation, as shown in <a href="#eq-labor-income-regression" class="quarto-xref">Equation&nbsp;1</a>, and implemented in <a href="#lst-regression-model" class="quarto-xref">Listing&nbsp;1</a>. For the respondents with available information, we also identified outliers as those outside of five standard deviations from the mean labor income.</p>
<p><span id="eq-labor-income-regression"><span class="math display">\[
\begin{equation}
\begin{split}
\ln(lab_i) = \\ \beta_0 + \beta_1 \text{age}_i + \\
\beta_2 \text{gender}_i + \beta_3 \text{education}_i + \\
\beta_4 \text{age}^2_i + \beta_5 \text{marz}_i + \\
\beta_6 \text{sector}_i + \epsilon_i
\end{split}
\end{equation}
\tag{1}\]</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\ln(lab_i)\)</span> is the natural logarithm of labor income for individual <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\beta_0\)</span> is the intercept term.</li>
<li><span class="math inline">\(\beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6\)</span> are the coefficients for the respective independent variables.</li>
<li><span class="math inline">\(\text{age}_i\)</span> is the age of individual <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\text{gender}_i\)</span> is a binary variable indicating the gender of individual <span class="math inline">\(i\)</span> (1 for female, 2 for male).</li>
<li><span class="math inline">\(\text{education}_i\)</span> represents the level of education for individual <span class="math inline">\(i\)</span> (ordered: 1) None to General, 2) Secondary to Vocational, 3) Higher education).</li>
<li><span class="math inline">\(\text{age}^2_i\)</span> is the square of the age of individual <span class="math inline">\(i\)</span>, included to capture non-linear effects of age on labor income.</li>
<li><span class="math inline">\(\text{marz}_i\)</span> represents the region where individual <span class="math inline">\(i\)</span> resides.</li>
<li><span class="math inline">\(\text{sector}_i\)</span> represents the sector of employment for individual <span class="math inline">\(i\)</span> (i.e., agriculture, manufacturing or services).</li>
<li><span class="math inline">\(\epsilon_i\)</span> is the error term for individual <span class="math inline">\(i\)</span>.</li>
</ul>
<p>We first prepare our variables for the regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pp_microsim06 <span class="ot">&lt;-</span> pp_microsim05 <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> Education,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> Age,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">gender =</span> Gender,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> RegNo) <span class="sc">|&gt;</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">education2 =</span> education<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">age2 =</span> age<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">male =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      gender <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_lab1 =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(labor_income_job1) <span class="sc">&amp;</span> labor_income_job1 <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(labor_income_job1),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_lab2 =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(labor_income_job2) <span class="sc">&amp;</span> labor_income_job2 <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(labor_income_job2),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ln_surplus =</span> <span class="fu">if_else</span>(</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(surplus_income) <span class="sc">&amp;</span> surplus_income <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">log</span>(surplus_income),</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA</span>),</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_job1 =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_job2 =</span> <span class="cn">NA_real_</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_surplus =</span> <span class="cn">NA_real_</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labor Market Status </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket =</span> <span class="fu">case_when</span>(</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(Q7) <span class="sc">~</span> <span class="fu">as.numeric</span>(SAM3_job1),</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> age <span class="sc">&gt;=</span> <span class="dv">15</span> <span class="sc">~</span> <span class="dv">4</span>, <span class="co"># Unemployed</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Q7) <span class="sc">&amp;</span> age <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="dv">5</span>,  <span class="co"># OLF</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="cn">NA_integer_</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Filter the data for regression conditions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>regression_data_job1 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> fix_job1 <span class="sc">==</span> F)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>regression_data_job2 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>) <span class="sc">&amp;</span> fix_job2 <span class="sc">==</span> F)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>regression_data_surplus <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>) <span class="sc">&amp;</span> fix_surplus <span class="sc">==</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Regression model.</p>
<div class="cell">
<div id="lst-regression-model" class="r cell-code listing quarto-float quarto-figure quarto-figure-left anchored">
<figure class="quarto-float quarto-float-lst figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-regression-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Income regression model
</figcaption>
<div aria-describedby="lst-regression-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="lst-regression-model"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="lst-regression-model-1"><a href="#lst-regression-model-1" aria-hidden="true" tabindex="-1"></a>model_job1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-2"><a href="#lst-regression-model-2" aria-hidden="true" tabindex="-1"></a>  ln_lab1 <span class="sc">~</span> </span>
<span id="lst-regression-model-3"><a href="#lst-regression-model-3" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-4"><a href="#lst-regression-model-4" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job1,</span>
<span id="lst-regression-model-5"><a href="#lst-regression-model-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_job1)</span>
<span id="lst-regression-model-6"><a href="#lst-regression-model-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-regression-model-7"><a href="#lst-regression-model-7" aria-hidden="true" tabindex="-1"></a>model_job2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-8"><a href="#lst-regression-model-8" aria-hidden="true" tabindex="-1"></a>  ln_lab2 <span class="sc">~</span> </span>
<span id="lst-regression-model-9"><a href="#lst-regression-model-9" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-10"><a href="#lst-regression-model-10" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job2,</span>
<span id="lst-regression-model-11"><a href="#lst-regression-model-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_job2)</span>
<span id="lst-regression-model-12"><a href="#lst-regression-model-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-regression-model-13"><a href="#lst-regression-model-13" aria-hidden="true" tabindex="-1"></a>model_surplus <span class="ot">&lt;-</span> <span class="fu">lm</span>(</span>
<span id="lst-regression-model-14"><a href="#lst-regression-model-14" aria-hidden="true" tabindex="-1"></a>  ln_surplus <span class="sc">~</span> </span>
<span id="lst-regression-model-15"><a href="#lst-regression-model-15" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">+</span> gender <span class="sc">+</span> education <span class="sc">+</span> </span>
<span id="lst-regression-model-16"><a href="#lst-regression-model-16" aria-hidden="true" tabindex="-1"></a>    age2 <span class="sc">+</span> region <span class="sc">+</span> SAM3_job1,</span>
<span id="lst-regression-model-17"><a href="#lst-regression-model-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> regression_data_surplus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
</div>
<p>Applying predictions to those who need it.</p>
<p>Note: The ‘predict’ function in R does not directly support conditions within the function call, so we handle this by filtering or subsetting the data as needed.</p>
<p>Note: ‘type = “response”’ might be needed depending on model type.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rows to predict (this removes uncertainty NAs for predictions)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>target_rows_job1    <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_job1    <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>target_rows_job2    <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_job2    <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>target_rows_surplus <span class="ot">&lt;-</span> <span class="fu">which</span>(pp_microsim06<span class="sc">$</span>fix_surplus <span class="sc">==</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_job1[target_rows_job1] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_job1, ], </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_job2[target_rows_job2] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_job2, ], </span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>pp_microsim06<span class="sc">$</span>sim_surplus[target_rows_surplus] <span class="ot">&lt;-</span> <span class="fu">exp</span>(</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    model_job1, </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    pp_microsim06[target_rows_surplus, ], </span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point, if there were negative predictions, we would have to make them zero. There are none such cases in this exercise.</p>
<p>And now, we replace simulated income for those who lack one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pp_microsim07 <span class="ot">&lt;-</span> pp_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job1 =</span> <span class="fu">if_else</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>      fix_job1 <span class="sc">==</span> T,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>      sim_job1,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>      labor_income_job1</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_job2 =</span> <span class="fu">if_else</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>      fix_job2 <span class="sc">==</span> T,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>      sim_job2,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>      labor_income_job2</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">surplus_income =</span> <span class="fu">if_else</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>      fix_surplus <span class="sc">==</span> T,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>      sim_surplus,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>      surplus_income</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we estimate total labor income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pp_microsim08 <span class="ot">&lt;-</span> pp_microsim07 <span class="sc">|&gt;</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annual income</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_income_job1 =</span> labor_income_job1 <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_income_job2 =</span> labor_income_job2 <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_surplus_income =</span> surplus_income <span class="sc">*</span> <span class="dv">4</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly income</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_job1 =</span> labor_income_job1 <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_job2 =</span> labor_income_job2 <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_surplus_income =</span> surplus_income <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Annual labor income in GEL</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>      Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>) <span class="sc">|</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">coalesce</span>(</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        annual_labor_income_job1, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coalesce</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        annual_labor_income_job2, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coalesce</span>(</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        annual_surplus_income, <span class="dv">0</span>)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Monthly labor income in GEL</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_total =</span> <span class="fu">if_else</span>(</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      Q7 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>) <span class="sc">|</span> Q13 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>),</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">coalesce</span>(</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>        monthly_labor_income_job1, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coalesce</span>(</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>        monthly_labor_income_job2, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coalesce</span>(</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>        monthly_surplus_income, <span class="dv">0</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="total-income-and-shares" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="total-income-and-shares"><span class="header-section-number">2.5.1</span> Total income and shares</h3>
<p>Total labor income at HH level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pp_microsim09 <span class="ot">&lt;-</span> pp_microsim08 <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_annual_labor_total  =</span> <span class="fu">sum</span>(annual_labor_total,  <span class="at">na.rm =</span> T),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_monthly_labor_total =</span> <span class="fu">sum</span>(monthly_labor_total, <span class="at">na.rm =</span> T)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="un-population-projections" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> UN Population Projections</h1>
<p>Now we are ready to move to our demographic projections and macroeconomic model information.</p>
<p>First, filtering based on country (our <code>iso</code> variable).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span>  </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country <span class="sc">==</span> iso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Collapsing data by summing up variables starting with “yf” and “ym” and reshaping data to long format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variant, country, cohort) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"yf"</span>, <span class="st">"ym"</span>)), sum)) <span class="sc">|&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(population_projections,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">"yf"</span>, <span class="st">"ym"</span>)),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"year"</span>),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_pattern =</span> <span class="st">"(yf|ym)(.*)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating new variable <code>total_population</code> as the sum of <code>yf</code> and <code>ym</code>. Dropping <code>country</code> variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_population =</span> yf <span class="sc">+</span> ym) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( <span class="sc">-</span>country) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summarizing the year to find the range.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>minyear <span class="ot">&lt;-</span> survey_year <span class="co"># Make sure `survey_year` is correctly defined</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>maxyear <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">as.numeric</span>(population_projections<span class="sc">$</span>year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have that the “Min Year” is <code>minyear</code> and the “Max Year” is <code>maxyear</code>. Now we create a population growth rate by demographic variant dataset. We initialize an empty list to store our data by variant and we loop over variants to create this list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With minyear and maxyear defined above</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a list to store growth data</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over variants</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>variants <span class="ot">&lt;-</span> <span class="fu">unique</span>(population_projections<span class="sc">$</span>Variant)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (variant <span class="cf">in</span> variants) {</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> minyear<span class="sc">:</span>maxyear) {</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate population for year t</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    pop_t <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> t, Variant <span class="sc">==</span> variant) <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">sum_pop =</span> <span class="fu">sum</span>(total_population)) <span class="sc">|&gt;</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(sum_pop)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate population for base year</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    pop_base <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> minyear, Variant <span class="sc">==</span> variant) <span class="sc">|&gt;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">sum_pop =</span> <span class="fu">sum</span>(total_population)) <span class="sc">|&gt;</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(sum_pop)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate growth rate and store in list with dynamic naming</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    growth_rate <span class="ot">&lt;-</span> pop_t <span class="sc">/</span> pop_base</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    pop_growth[[<span class="fu">paste0</span>(t, <span class="st">"_"</span>, variant)]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">growth_rate =</span> growth_rate, <span class="at">pop_t =</span> pop_t</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With the list ready, we convert back to dataframe by stitching the list elements one on top of the other.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert list to dataframe</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(<span class="fu">names</span>(pop_growth), <span class="cf">function</span>(x) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract year and variant from the name</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  parts <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">"_"</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(parts[<span class="dv">1</span>])</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  variant <span class="ot">&lt;-</span> parts[<span class="dv">2</span>]</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a tibble for each entry</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">year =</span> year, </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">variant =</span> variant, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_population =</span> pop_growth[[x]]<span class="sc">$</span>pop_t,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_growth_rate =</span> pop_growth[[x]]<span class="sc">$</span>growth_rate)</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the dataframe for better readability</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>pop_growth <span class="ot">&lt;-</span> <span class="fu">arrange</span>(pop_growth, variant, year)</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the dataframe</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>pop_growth[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">09</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 4
   year variant            total_population pop_growth_rate
  &lt;int&gt; &lt;chr&gt;                         &lt;dbl&gt;           &lt;dbl&gt;
1  2023 Constant-fertility            3728.           1    
2  2024 Constant-fertility            3718.           0.997
3  2025 Constant-fertility            3710.           0.995
4  2026 Constant-fertility            3702.           0.993
5  2027 Constant-fertility            3693.           0.990
6  2028 Constant-fertility            3683.           0.988
7  2029 Constant-fertility            3673.           0.985
8  2030 Constant-fertility            3663.           0.983
9  2031 Constant-fertility            3653.           0.980</code></pre>
</div>
</div>
</section>
<section id="macro-scenarios" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Macro Scenarios</h1>
<p>Here we use the Excel tab names to create the names of the scenarios going forward, with a previous cleaning in which we convert names to lower case, replace spaces and special characters with underscores, we remove the word scenario from the name, and remove leading or trailing spaces or underscores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Macro Scenario File imported in "Datasets" section (scenario_file) </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">&lt;-</span> <span class="fu">excel_sheets</span>(scenario_file)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>scenario_sheets <span class="ot">&lt;-</span> sheets[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)]</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the names of the scenarios and the variants</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># modify list with the tab numbers in the Excel file</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> scenario_sheets <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert all text to lowercase</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_lower</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove all spaces and hyphens</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (we want lowercase one word scenario names for variable names)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"[ -]"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the word 'scenario' or 'scenarios'</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"scenario?s?"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove leading and trailing underscores</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"^_+|_+$"</span>, <span class="st">""</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our scenarios are: baseline, dryhot, wetwarm, and nzs. We now import data from Excel sheets corresponding to each scenario and combine them into one data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an empty list to store data frames for each scenario</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>scen_data_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import data for each scenario and store it in the list.</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the trick where we use the index `i` from `scenarios`</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># but access the scenario_sheets name to fetch the Excel</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tab.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(scenarios)) {</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  sheet_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(scenario_file, </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sheet =</span> scenario_sheets[i], </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">range =</span> <span class="st">"A3:AX30"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>                           <span class="at">col_names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  sheet_data<span class="sc">$</span>scenario_id <span class="ot">&lt;-</span> scenarios[i]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sheet_data) <span class="ot">&lt;-</span> scenario_varlist<span class="sc">$</span>var_short_name</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  scen_data_list[[i]] <span class="ot">&lt;-</span> sheet_data</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all data frames into one</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(scen_data_list)</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unnecessary list</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(scen_data_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then rename columns, create a ‘scenid’ to identify scenarios, and merge with population projections. Calculate real wages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename population_m from the data set because we will use </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># UN pop projections from the other data set.</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">population_m_macrodata =</span> population_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We prepare our population data to combine it with the macro data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variant, year) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">male =</span> <span class="fu">sum</span>(ym),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_population =</span> <span class="fu">sum</span>(total_population) ) <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Variant'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter population data to macro model years</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>pop_data <span class="ot">&lt;-</span> pop_data <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="fu">max</span>(macro_data<span class="sc">$</span>year),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         Variant <span class="sc">==</span> variants[<span class="dv">7</span>])</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the combined data with population projections</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pop_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are some calculated variables that we need to estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate real wages</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute real wages</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_agr_b_lcu =</span> (wage_agri_lcu1000s <span class="sc">*</span> emp_agri_million) <span class="sc">/</span> cpi,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_man_b_lcu =</span> (wage_manu_lcu1000s <span class="sc">*</span> emp_manu_million) <span class="sc">/</span> cpi,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_ser_b_lcu =</span> (wage_serv_lcu1000s <span class="sc">*</span> emp_serv_million) <span class="sc">/</span> cpi</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define labor market groups using the macro-based population base</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_1 =</span> emp_agri_million,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_2 =</span> emp_manu_million,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_3 =</span> emp_serv_million,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_4 =</span> working_age_pop_m <span class="sc">-</span> (lmarket_1 <span class="sc">+</span> lmarket_2 <span class="sc">+</span> lmarket_3),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_5 =</span> population_m_macrodata <span class="sc">-</span> working_age_pop_m</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We calculate columns for the totals by labor market group so we can derive our shares.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># And we label these variables</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>total_population, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Total population (million)"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_1, </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in agriculture (million)"</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_2, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in manufacturing (million)"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_3, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Employed in services (million)"</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_4, </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Unemployed and inactive (million)"</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(macro_data<span class="sc">$</span>lmarket_5, </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>     <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Outside the labor force (million)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With our demographic data added to our macroeconomic data, we need to estimate relative growth of some of the variables. For this we create a function to estimate growth per column to a named list of column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to add growth rate columns directly in the dataframe</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>calculate_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(data, value_column) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  growth_col_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(value_column, <span class="st">"_growth"</span>) <span class="co"># dynamic name for growth column</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Variant, scenario_id) <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">base_value =</span> <span class="fu">first</span>(<span class="sc">!!</span><span class="fu">sym</span>(value_column)),</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!!</span><span class="fu">sym</span>(growth_col_name) <span class="sc">:</span><span class="er">=</span> <span class="sc">!!</span><span class="fu">sym</span>(value_column) <span class="sc">/</span> base_value</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>base_value) <span class="sc">|&gt;</span> <span class="co"># optionally remove base_value column if not needed</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns to calculate growth for</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>value_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_agr_b_lcu"</span>,     <span class="co"># Real wage agriculture</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_man_b_lcu"</span>,     <span class="co"># Real wage manufacturing</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"rwage_ser_b_lcu"</span>,     <span class="co"># Real wage services</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_1"</span>,</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_2"</span>,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_3"</span>,</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_4"</span>,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"lmarket_5"</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We create the list and pass it to the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using purrr to apply the function column-wise, without a for loop.</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> <span class="fu">reduce</span>(value_columns, calculate_growth, <span class="at">.init =</span> macro_data)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We relocate some variables for clarity.</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>macro_data <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span> </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(scenario_id, Variant, <span class="at">.before =</span> year) <span class="sc">|&gt;</span> </span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(scenario_id, Variant, year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that <code>macro_data</code> has growth rate columns for each of the variables. We can check, for example, the employment and wage growth rates for our three scenarios in the analysis years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>macro_data[macro_data<span class="sc">$</span>year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>),<span class="fu">c</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"scenario_id"</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_1_growth"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_2_growth"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_3_growth"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_4_growth"</span>, </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"lmarket_5_growth"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>)] <span class="sc">|&gt;</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"scenario_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_1_growth =</span> <span class="fu">md</span>(<span class="st">"Agriculture"</span>),</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_2_growth =</span> <span class="fu">md</span>(<span class="st">"Manufacturing"</span>),</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_3_growth =</span> <span class="fu">md</span>(<span class="st">"Services"</span>),</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_4_growth =</span> <span class="fu">md</span>(<span class="st">"Unemployed"</span>),</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">lmarket_5_growth =</span> <span class="fu">md</span>(<span class="st">"OLF"</span>)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-lmarket-growth" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lmarket-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Labor market growth by category in analysis years
</figcaption>
<div aria-describedby="tbl-lmarket-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="wbpxqqvzws" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wbpxqqvzws table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wbpxqqvzws thead, #wbpxqqvzws tbody, #wbpxqqvzws tfoot, #wbpxqqvzws tr, #wbpxqqvzws td, #wbpxqqvzws th {
  border-style: none;
}

#wbpxqqvzws p {
  margin: 0;
  padding: 0;
}

#wbpxqqvzws .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wbpxqqvzws .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wbpxqqvzws .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wbpxqqvzws .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wbpxqqvzws .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbpxqqvzws .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbpxqqvzws .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbpxqqvzws .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wbpxqqvzws .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wbpxqqvzws .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wbpxqqvzws .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wbpxqqvzws .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wbpxqqvzws .gt_spanner_row {
  border-bottom-style: hidden;
}

#wbpxqqvzws .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wbpxqqvzws .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wbpxqqvzws .gt_from_md > :first-child {
  margin-top: 0;
}

#wbpxqqvzws .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wbpxqqvzws .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wbpxqqvzws .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wbpxqqvzws .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wbpxqqvzws .gt_row_group_first td {
  border-top-width: 2px;
}

#wbpxqqvzws .gt_row_group_first th {
  border-top-width: 2px;
}

#wbpxqqvzws .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbpxqqvzws .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wbpxqqvzws .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wbpxqqvzws .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbpxqqvzws .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbpxqqvzws .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wbpxqqvzws .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wbpxqqvzws .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wbpxqqvzws .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbpxqqvzws .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbpxqqvzws .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbpxqqvzws .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbpxqqvzws .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbpxqqvzws .gt_left {
  text-align: left;
}

#wbpxqqvzws .gt_center {
  text-align: center;
}

#wbpxqqvzws .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wbpxqqvzws .gt_font_normal {
  font-weight: normal;
}

#wbpxqqvzws .gt_font_bold {
  font-weight: bold;
}

#wbpxqqvzws .gt_font_italic {
  font-style: italic;
}

#wbpxqqvzws .gt_super {
  font-size: 65%;
}

#wbpxqqvzws .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wbpxqqvzws .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wbpxqqvzws .gt_indent_1 {
  text-indent: 5px;
}

#wbpxqqvzws .gt_indent_2 {
  text-indent: 10px;
}

#wbpxqqvzws .gt_indent_3 {
  text-indent: 15px;
}

#wbpxqqvzws .gt_indent_4 {
  text-indent: 20px;
}

#wbpxqqvzws .gt_indent_5 {
  text-indent: 25px;
}

#wbpxqqvzws .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wbpxqqvzws div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="lmarket_1_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Agriculture</th>
<th id="lmarket_2_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Manufacturing</th>
<th id="lmarket_3_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Services</th>
<th id="lmarket_4_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Unemployed</th>
<th id="lmarket_5_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">OLF</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_1_growth">0.93</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_2_growth">0.98</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_3_growth">1.00</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_4_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_1 lmarket_5_growth">1.00</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_1_growth">0.63</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_2_growth">0.90</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_3_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_4_growth">0.84</td>
<td class="gt_row gt_right" headers="stub_1_2 lmarket_5_growth">0.98</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">dryhot</td>
<td class="gt_row gt_right" headers="stub_1_3 lmarket_1_growth">0.94</td>
<td class="gt_row gt_right" headers="stub_1_3 lmarket_2_growth">0.98</td>
<td class="gt_row gt_right" headers="stub_1_3 lmarket_3_growth">0.99</td>
<td class="gt_row gt_right" headers="stub_1_3 lmarket_4_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_3 lmarket_5_growth">1.00</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">dryhot</td>
<td class="gt_row gt_right" headers="stub_1_4 lmarket_1_growth">0.63</td>
<td class="gt_row gt_right" headers="stub_1_4 lmarket_2_growth">0.90</td>
<td class="gt_row gt_right" headers="stub_1_4 lmarket_3_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_4 lmarket_4_growth">0.84</td>
<td class="gt_row gt_right" headers="stub_1_4 lmarket_5_growth">0.98</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">nzs</td>
<td class="gt_row gt_right" headers="stub_1_5 lmarket_1_growth">0.92</td>
<td class="gt_row gt_right" headers="stub_1_5 lmarket_2_growth">0.99</td>
<td class="gt_row gt_right" headers="stub_1_5 lmarket_3_growth">1.00</td>
<td class="gt_row gt_right" headers="stub_1_5 lmarket_4_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_5 lmarket_5_growth">1.00</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">nzs</td>
<td class="gt_row gt_right" headers="stub_1_6 lmarket_1_growth">0.59</td>
<td class="gt_row gt_right" headers="stub_1_6 lmarket_2_growth">0.92</td>
<td class="gt_row gt_right" headers="stub_1_6 lmarket_3_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_6 lmarket_4_growth">0.84</td>
<td class="gt_row gt_right" headers="stub_1_6 lmarket_5_growth">0.98</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">wetwarm</td>
<td class="gt_row gt_right" headers="stub_1_7 lmarket_1_growth">0.94</td>
<td class="gt_row gt_right" headers="stub_1_7 lmarket_2_growth">0.98</td>
<td class="gt_row gt_right" headers="stub_1_7 lmarket_3_growth">0.99</td>
<td class="gt_row gt_right" headers="stub_1_7 lmarket_4_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_7 lmarket_5_growth">1.00</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">wetwarm</td>
<td class="gt_row gt_right" headers="stub_1_8 lmarket_1_growth">0.63</td>
<td class="gt_row gt_right" headers="stub_1_8 lmarket_2_growth">0.90</td>
<td class="gt_row gt_right" headers="stub_1_8 lmarket_3_growth">0.96</td>
<td class="gt_row gt_right" headers="stub_1_8 lmarket_4_growth">0.84</td>
<td class="gt_row gt_right" headers="stub_1_8 lmarket_5_growth">0.98</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>macro_data[macro_data<span class="sc">$</span>year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2030</span>, <span class="dv">2050</span>),<span class="fu">c</span>(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"scenario_id"</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_agr_b_lcu_growth"</span>, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_man_b_lcu_growth"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rwage_ser_b_lcu_growth"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>)] <span class="sc">|&gt;</span> </span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="st">"scenario_id"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_agr_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Agriculture"</span>),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_man_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Manufacturing"</span>),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">rwage_ser_b_lcu_growth =</span> <span class="fu">md</span>(<span class="st">"Services"</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">decimals =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-wage-growth" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wage-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Wage bill growth by sector in analysis years
</figcaption>
<div aria-describedby="tbl-wage-growth-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="njqriqwufc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#njqriqwufc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#njqriqwufc thead, #njqriqwufc tbody, #njqriqwufc tfoot, #njqriqwufc tr, #njqriqwufc td, #njqriqwufc th {
  border-style: none;
}

#njqriqwufc p {
  margin: 0;
  padding: 0;
}

#njqriqwufc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#njqriqwufc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#njqriqwufc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#njqriqwufc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#njqriqwufc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njqriqwufc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njqriqwufc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#njqriqwufc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#njqriqwufc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#njqriqwufc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#njqriqwufc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#njqriqwufc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#njqriqwufc .gt_spanner_row {
  border-bottom-style: hidden;
}

#njqriqwufc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#njqriqwufc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#njqriqwufc .gt_from_md > :first-child {
  margin-top: 0;
}

#njqriqwufc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#njqriqwufc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#njqriqwufc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#njqriqwufc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#njqriqwufc .gt_row_group_first td {
  border-top-width: 2px;
}

#njqriqwufc .gt_row_group_first th {
  border-top-width: 2px;
}

#njqriqwufc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njqriqwufc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#njqriqwufc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#njqriqwufc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njqriqwufc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#njqriqwufc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#njqriqwufc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#njqriqwufc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#njqriqwufc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#njqriqwufc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njqriqwufc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njqriqwufc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#njqriqwufc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#njqriqwufc .gt_left {
  text-align: left;
}

#njqriqwufc .gt_center {
  text-align: center;
}

#njqriqwufc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#njqriqwufc .gt_font_normal {
  font-weight: normal;
}

#njqriqwufc .gt_font_bold {
  font-weight: bold;
}

#njqriqwufc .gt_font_italic {
  font-style: italic;
}

#njqriqwufc .gt_super {
  font-size: 65%;
}

#njqriqwufc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#njqriqwufc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#njqriqwufc .gt_indent_1 {
  text-indent: 5px;
}

#njqriqwufc .gt_indent_2 {
  text-indent: 10px;
}

#njqriqwufc .gt_indent_3 {
  text-indent: 15px;
}

#njqriqwufc .gt_indent_4 {
  text-indent: 20px;
}

#njqriqwufc .gt_indent_5 {
  text-indent: 25px;
}

#njqriqwufc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#njqriqwufc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="rwage_agr_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Agriculture</th>
<th id="rwage_man_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Manufacturing</th>
<th id="rwage_ser_b_lcu_growth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Services</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_agr_b_lcu_growth">1.20</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_man_b_lcu_growth">1.35</td>
<td class="gt_row gt_right" headers="stub_1_1 rwage_ser_b_lcu_growth">1.34</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">baseline</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_agr_b_lcu_growth">1.43</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_man_b_lcu_growth">2.68</td>
<td class="gt_row gt_right" headers="stub_1_2 rwage_ser_b_lcu_growth">2.63</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">dryhot</td>
<td class="gt_row gt_right" headers="stub_1_3 rwage_agr_b_lcu_growth">1.21</td>
<td class="gt_row gt_right" headers="stub_1_3 rwage_man_b_lcu_growth">1.34</td>
<td class="gt_row gt_right" headers="stub_1_3 rwage_ser_b_lcu_growth">1.32</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">dryhot</td>
<td class="gt_row gt_right" headers="stub_1_4 rwage_agr_b_lcu_growth">1.38</td>
<td class="gt_row gt_right" headers="stub_1_4 rwage_man_b_lcu_growth">2.59</td>
<td class="gt_row gt_right" headers="stub_1_4 rwage_ser_b_lcu_growth">2.50</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">nzs</td>
<td class="gt_row gt_right" headers="stub_1_5 rwage_agr_b_lcu_growth">1.18</td>
<td class="gt_row gt_right" headers="stub_1_5 rwage_man_b_lcu_growth">1.36</td>
<td class="gt_row gt_right" headers="stub_1_5 rwage_ser_b_lcu_growth">1.34</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">nzs</td>
<td class="gt_row gt_right" headers="stub_1_6 rwage_agr_b_lcu_growth">1.27</td>
<td class="gt_row gt_right" headers="stub_1_6 rwage_man_b_lcu_growth">2.80</td>
<td class="gt_row gt_right" headers="stub_1_6 rwage_ser_b_lcu_growth">2.54</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">wetwarm</td>
<td class="gt_row gt_right" headers="stub_1_7 rwage_agr_b_lcu_growth">1.21</td>
<td class="gt_row gt_right" headers="stub_1_7 rwage_man_b_lcu_growth">1.35</td>
<td class="gt_row gt_right" headers="stub_1_7 rwage_ser_b_lcu_growth">1.33</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">wetwarm</td>
<td class="gt_row gt_right" headers="stub_1_8 rwage_agr_b_lcu_growth">1.43</td>
<td class="gt_row gt_right" headers="stub_1_8 rwage_man_b_lcu_growth">2.64</td>
<td class="gt_row gt_right" headers="stub_1_8 rwage_ser_b_lcu_growth">2.58</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="reweighting-of-the-dataset" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Reweighting of the dataset</h1>
<section id="aggregation-of-population-data" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="aggregation-of-population-data"><span class="header-section-number">5.1</span> Aggregation of population data</h2>
<p>This is based on a custom command to reweight the survey according to macroeconomic data for every possible combination of variant, year, and country. In the macro data we know they only used the “medium” variant and we only need to reweight for two specific years for Georgia (GEO), so we will conduct the reweighting directly with these parameters.</p>
<p>We join several cohorts from 0 to 29 years old and from 60 onwards, because the reweighting procedure works best if each category is at least 5% of the population. The solution here works best for Georgia.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>population_projections <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Variant == "Medium") |&gt;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recoding cohorts into ordered factors</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">cohort_short =</span> <span class="fu">factor</span>(</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">case_when</span>(</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P0004"</span>, <span class="st">"P0509"</span>,<span class="st">"P1014"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P1519"</span>,<span class="st">"P2024"</span>, <span class="st">"P2529"</span>) <span class="sc">~</span> <span class="st">"P0029"</span>,</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P3034"</span>, <span class="st">"P3539"</span>) <span class="sc">~</span> <span class="st">"P3039"</span>,</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P4044"</span>, <span class="st">"P4549"</span>) <span class="sc">~</span> <span class="st">"P4049"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P5054"</span>, <span class="st">"P5559"</span>) <span class="sc">~</span> <span class="st">"P5059"</span>,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>          cohort <span class="sc">%in%</span> </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">c</span>(<span class="st">"P6064"</span>, <span class="st">"P6569"</span>,<span class="st">"P7074"</span>, <span class="st">"P7579"</span>,</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P8084"</span>, <span class="st">"P8589"</span>, <span class="st">"P9094"</span>, <span class="st">"P9599"</span>,</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">"P100up"</span>) <span class="sc">~</span> <span class="st">"P60up"</span>), </span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(<span class="st">"P0029"</span>, <span class="st">"P3039"</span>, <span class="st">"P4049"</span>,</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">"P5059"</span>, <span class="st">"P60up"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get also factor 'cohort' to numeric codes</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_code =</span> <span class="fu">as.integer</span>(cohort_short))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s now create cohorts in our <code>pp_microsim</code> data to match our population projection data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'age' into 'cohort' factor with levels ordered as specified</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>pp_microsim10 <span class="ot">&lt;-</span> pp_microsim09 <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">0</span>  <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">29</span> <span class="sc">~</span> <span class="st">"P0029"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">30</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">39</span> <span class="sc">~</span> <span class="st">"P3039"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">49</span> <span class="sc">~</span> <span class="st">"P4049"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">50</span> <span class="sc">&amp;</span> age <span class="sc">&lt;=</span> <span class="dv">59</span> <span class="sc">~</span> <span class="st">"P5059"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">&gt;=</span> <span class="dv">60</span>  <span class="sc">~</span> <span class="st">"P60up"</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  ), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"P0029"</span>, <span class="st">"P3039"</span>, <span class="st">"P4049"</span>, <span class="st">"P5059"</span>, <span class="st">"P60up"</span>)))</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the 'cohort' and 'gender' factor to numeric codes</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>pp_microsim11 <span class="ot">&lt;-</span> pp_microsim10  <span class="sc">|&gt;</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort_code =</span> <span class="fu">as.integer</span>(cohort))  <span class="sc">|&gt;</span>  </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_code =</span> <span class="fu">as.integer</span>(gender)) <span class="sc">|&gt;</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> Weights <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls(pattern = "^pp_microsim[0-9]+$"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We also need demographic targets for 2030 and 2050</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure pop_targets_2030 is correctly prepared</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We use the "Medium" variant = variants[7]</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>pop_targets_2030 <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2030</span>, Variant <span class="sc">==</span> variants[<span class="dv">7</span>])  <span class="sc">|&gt;</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort_code, cohort_short) <span class="sc">|&gt;</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">male   =</span> <span class="fu">sum</span>(ym), </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">total =</span> <span class="fu">sum</span>(total_population),</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">|&gt;</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>pop_targets_2050 <span class="ot">&lt;-</span> population_projections  <span class="sc">|&gt;</span> </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2050</span>, Variant <span class="sc">==</span> variants[<span class="dv">7</span>])  <span class="sc">|&gt;</span> </span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cohort_code, cohort_short) <span class="sc">|&gt;</span> </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">male   =</span> <span class="fu">sum</span>(ym), </span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">total =</span> <span class="fu">sum</span>(total_population),</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">|&gt;</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>pop_total_2030 <span class="ot">&lt;-</span> <span class="fu">sum</span>(pop_targets_2030<span class="sc">$</span>total)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>pop_total_2050 <span class="ot">&lt;-</span> <span class="fu">sum</span>(pop_targets_2050<span class="sc">$</span>total)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>pop_targets_2030 <span class="ot">&lt;-</span> pop_targets_2030 <span class="sc">|&gt;</span> </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_total =</span> total <span class="sc">/</span> pop_total_2030)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>pop_targets_2050 <span class="ot">&lt;-</span> pop_targets_2050 <span class="sc">|&gt;</span> </span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pct_total =</span> total <span class="sc">/</span> pop_total_2050)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a><span class="co">#writeClipboard(pop_targets_2030)</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(pop_targets_2030, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We add economic targets from lmarket, by combining totals from the survey and growth rates by share from the macro file so that shares do not have wild changes (since the shares of lmarket are so different between the macro file and the actual survey). We do this so that labor income doesn’t change in a completely radical way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Survey baseline (e.g. 2023) weighted totals by labor market group</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>survey_lmarket_base <span class="ot">&lt;-</span> pp_microsim11 <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lmarket) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">survey_total =</span> <span class="fu">sum</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(lmarket)  <span class="co"># Make sure it's in order 1 to 5</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>survey_totals <span class="ot">&lt;-</span> survey_lmarket_base<span class="sc">$</span>survey_total  <span class="co"># length 5</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the macro growth rates and apply them:</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>lmarket_targets <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> analysis_years, scenario_id <span class="sc">%in%</span> scenarios, Variant <span class="sc">==</span> variants[<span class="dv">7</span>]) <span class="sc">|&gt;</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(scenario_id, year, <span class="fu">starts_with</span>(<span class="st">"lmarket_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only *_growth columns</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(scenario_id, year, <span class="fu">matches</span>(<span class="st">"lmarket_</span><span class="sc">\\</span><span class="st">d+_growth"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(scenario_id, year) <span class="sc">|&gt;</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply growth rate to survey baseline</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">l1 =</span> survey_totals[<span class="dv">1</span>] <span class="sc">*</span> lmarket_1_growth,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">l2 =</span> survey_totals[<span class="dv">2</span>] <span class="sc">*</span> lmarket_2_growth,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">l3 =</span> survey_totals[<span class="dv">3</span>] <span class="sc">*</span> lmarket_3_growth,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">l4 =</span> survey_totals[<span class="dv">4</span>] <span class="sc">*</span> lmarket_4_growth,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">l5 =</span> survey_totals[<span class="dv">5</span>] <span class="sc">*</span> lmarket_5_growth</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> l1 <span class="sc">+</span> l2 <span class="sc">+</span> l3 <span class="sc">+</span> l4 <span class="sc">+</span> l5,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_1 =</span> l1 <span class="sc">/</span> total,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_2 =</span> l2 <span class="sc">/</span> total,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_3 =</span> l3 <span class="sc">/</span> total,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_4 =</span> l4 <span class="sc">/</span> total,</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_lmarket_5 =</span> l5 <span class="sc">/</span> total</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(scenario_id, year, <span class="fu">starts_with</span>(<span class="st">"target_lmarket"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="reweigting" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="reweigting"><span class="header-section-number">5.2</span> Reweigting</h2>
<p>We use anesrake to calculate targets from known future proportions of sex, age, economic sector. We first create a target list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list to store targets for each scenario and year</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>all_targets <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sc <span class="cf">in</span> scenarios) {</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. Get population targets</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    pop_targets <span class="ot">&lt;-</span> population_projections <span class="sc">|&gt;</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> yr, Variant <span class="sc">==</span> <span class="st">"Medium"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(cohort_code, cohort_short) <span class="sc">|&gt;</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">female =</span> <span class="fu">sum</span>(yf),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">male   =</span> <span class="fu">sum</span>(ym),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">total  =</span> <span class="fu">sum</span>(total_population),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">pct_total =</span> total <span class="sc">/</span> <span class="fu">sum</span>(total))</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    gender_code <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(pop_targets<span class="sc">$</span>female) <span class="sc">/</span> <span class="fu">sum</span>(pop_targets<span class="sc">$</span>total),</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(pop_targets<span class="sc">$</span>male)   <span class="sc">/</span> <span class="fu">sum</span>(pop_targets<span class="sc">$</span>total)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    cohort_code <span class="ot">&lt;-</span> pop_targets<span class="sc">$</span>pct_total</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Get labor market targets from the newly computed table</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    lmarket_code <span class="ot">&lt;-</span> lmarket_targets <span class="sc">|&gt;</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(scenario_id <span class="sc">==</span> sc, year <span class="sc">==</span> yr) <span class="sc">|&gt;</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"target_lmarket"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>(<span class="at">use.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. Store targets in named list</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    targets <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">gender_code =</span> gender_code,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">cohort_code =</span> cohort_code,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">lmarket =</span> lmarket_code</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(targets) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gender_code"</span>, <span class="st">"cohort_code"</span>, <span class="st">"lmarket"</span>)</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. Save using naming convention "name_year_scenario"</span></span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"targets_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>    all_targets[[key]] <span class="ot">&lt;-</span> targets</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we perform the reweighting, using the original weights. Initially we had used the default option type = “pctlim” combined with pctlim=0.05, because the method recommends that if reweighting changes for one variable according to its target are not of at least 5%, then it’s not worth burdening the procedure with it. It then ignored sex as a reweighting variable, leaving a small percentage difference between the target and the final population. However, we then tried removing this limitation and the procedure reached convergence in 40 and 49 iterations very efficiently for 2030 and 2050, respectively.</p>
<p>This has now been put into a for loop to facilitate multiple scenarios. See the original Armenia code for a simpler “by hand” version.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rakedata_base <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pp_microsim11)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>original_weight_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(rakedata_base<span class="sc">$</span>weight)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (key <span class="cf">in</span> <span class="fu">names</span>(all_targets)) {</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  parts <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(key, <span class="st">"_"</span>)[[<span class="dv">1</span>]]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  yr <span class="ot">&lt;-</span> parts[<span class="dv">2</span>]</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  sc <span class="ot">&lt;-</span> parts[<span class="dv">3</span>]</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  targets <span class="ot">&lt;-</span> all_targets[[key]]</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"🔁 Raking:"</span>, yr, sc, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  outsave <span class="ot">&lt;-</span> anesrake<span class="sc">::</span><span class="fu">anesrake</span>(</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    targets,            <span class="co"># &lt;- positional</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    rakedata_base,      <span class="co"># &lt;- positional</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">caseid       =</span> rakedata_base<span class="sc">$</span>MemberId,</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">choosemethod =</span> <span class="st">"total"</span>,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">type         =</span> <span class="st">"nolim"</span>,</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">nlim         =</span> <span class="dv">3</span>,</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">iterate      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">force1       =</span> <span class="cn">TRUE</span>,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">verbose      =</span> <span class="cn">TRUE</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  weight_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"weight_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>  new_weight <span class="ot">&lt;-</span> <span class="fu">unlist</span>(outsave[[<span class="dv">1</span>]])</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  rakedata_base[[weight_name]] <span class="ot">&lt;-</span> new_weight</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>  scaling_factor <span class="ot">&lt;-</span> pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="fu">as.integer</span>(yr)] <span class="sc">/</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a>                    pop_data<span class="sc">$</span>total_population[pop_data<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span>]</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a>  target_sum <span class="ot">&lt;-</span> original_weight_sum <span class="sc">*</span> scaling_factor</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a>  new_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(new_weight)</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>  rakedata_base[[weight_name]] <span class="ot">&lt;-</span> rakedata_base[[weight_name]] <span class="sc">*</span> (target_sum <span class="sc">/</span> new_sum)</span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"✅ Finished:"</span>, weight_name, </span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"| Rescaled sum ="</span>, <span class="fu">round</span>(<span class="fu">sum</span>(rakedata_base[[weight_name]])), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>🔁 Raking: 2030 baseline </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 10198.6236928413"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 1127.83410643334"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 105.331275545111"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 29.3179762115329"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 12.5350597845507"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 5.33204611403515"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 2.2627503653339"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 0.959752781272666"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 0.407028549556432"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 0.172612144088801"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 0.0731998955294041"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.0310417747231533"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.0131638022302782"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.0055823314047645"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.00236728013479159"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.0010038841452325"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.000425713568770913"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.000180530832390724"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 7.65570571219509e-05"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 3.24652799320035e-05"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 1.37674364605322e-05"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 5.8383036555254e-06"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 2.47582724105522e-06"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 1.04992399557746e-06"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 4.45227162360062e-07"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 1.88805963918792e-07"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 8.00703366388156e-08"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 3.39568085316877e-08"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 1.43948009623251e-08"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 6.10741224260636e-09"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 2.59449417505664e-09"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 1.09781445045698e-09"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.68473648762568e-10"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 1.97515559463568e-10"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 8.0315976092038e-11"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 3.81766840362729e-11"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 1.83053017188683e-11"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 9.18620735035347e-12"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 8.56448245656338e-12"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 5.33656452361697e-12"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 4.08151290542946e-12"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 7.0867756107873e-12"
[1] "Raking converged in 42 iterations"
✅ Finished: weight_2030_baseline | Rescaled sum = 3644937 

🔁 Raking: 2050 baseline </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 12166.9730452093"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 2555.84553890228"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 546.934305116116"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 239.683888795916"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 116.185080662759"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 57.352312014411"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 28.5093443557265"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 14.2157644921414"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 7.09903202907279"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 3.54770021052674"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 1.77359123884844"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.886828209194404"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.443470901140234"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.221773980549075"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.110908791568697"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.0554659320764487"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.0277388938274802"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.0138724510681142"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.00693773784603019"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 0.00346962772637716"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 0.00173519396468169"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 0.000867787236588813"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 0.000433988796801399"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 0.000217042013070101"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 0.000108544816291412"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 5.42843211668864e-05"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 2.71481206534641e-05"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 1.35770390352064e-05"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 6.79001472142504e-06"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 3.39574284752286e-06"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 1.69824613988068e-06"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 8.49310797357283e-07"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.24747395588732e-07"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.12422497591902e-07"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 1.06230828689213e-07"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 5.31263021907868e-08"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.65626183271195e-08"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.32883724579536e-08"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 6.64627408664131e-09"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 3.32198396568728e-09"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 1.67007246920647e-09"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 8.27481083653936e-10"
[1] "Raking...Iteration 43"
[1] "Current iteration changed total weights by 4.15582734891728e-10"
[1] "Raking...Iteration 44"
[1] "Current iteration changed total weights by 2.05765682270709e-10"
[1] "Raking...Iteration 45"
[1] "Current iteration changed total weights by 1.08098863194073e-10"
[1] "Raking...Iteration 46"
[1] "Current iteration changed total weights by 4.9506343469119e-11"
[1] "Raking...Iteration 47"
[1] "Current iteration changed total weights by 2.49518183892405e-11"
[1] "Raking...Iteration 48"
[1] "Current iteration changed total weights by 1.48233647578877e-11"
[1] "Raking...Iteration 49"
[1] "Current iteration changed total weights by 8.99130769838052e-12"
[1] "Raking...Iteration 50"
[1] "Current iteration changed total weights by 4.75675054900648e-12"
[1] "Raking...Iteration 51"
[1] "Current iteration changed total weights by 6.77613520849718e-12"
[1] "Raking converged in 51 iterations"
✅ Finished: weight_2050_baseline | Rescaled sum = 3373040 

🔁 Raking: 2030 dryhot 
[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 10092.8211003811"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 1099.72500554844"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 105.150437191272"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 30.7588105606399"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 13.1867775869429"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 5.60552660645767"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 2.37754822968345"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 1.00792736318368"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 0.427239750734547"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 0.181090001126004"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 0.0767555200720032"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.032532811317818"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.0137889829705943"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.00584443202548873"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.00247714910628599"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.00104993372004497"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.000445011846301357"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.000188617176996309"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 7.99449272522179e-05"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 3.38844589555243e-05"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 1.43618461846406e-05"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 6.08723607264938e-06"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 2.58005313463761e-06"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 1.09355344457551e-06"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 4.63499359781849e-07"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 1.96451841016909e-07"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 8.32673126005545e-08"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 3.52907800205138e-08"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 1.49575364871701e-08"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 6.34118213493906e-09"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 2.68501648692521e-09"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 1.14306630827343e-09"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.77524852993128e-10"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.0108364973126e-10"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 8.45125636139699e-11"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 3.79895004343211e-11"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 1.56520907346192e-11"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 7.63245022739056e-12"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 4.93360907682927e-12"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 1.01476604896789e-11"
[1] "Raking converged in 40 iterations"
✅ Finished: weight_2030_dryhot | Rescaled sum = 3644937 

🔁 Raking: 2050 dryhot </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 12106.2933773948"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 2526.45944838028"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 549.349401454554"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 241.524424852756"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 117.013685800146"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 57.7258836983039"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 28.6776280986623"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 14.2911591714348"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 7.13247750226392"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 3.56232516745599"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 1.77986122649579"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.889443408173408"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.444518937419049"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.222168298200355"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.111041122172557"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.0554996903867008"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.0277395722485096"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.0138646911446929"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.00692980891148254"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 0.00346363905896691"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 0.0017311876753543"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 0.000865278184505269"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 0.000432481360931769"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 0.000216161858694386"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 0.000108041526367841"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 5.40010754817022e-05"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 2.69906939704967e-05"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 1.34904286115956e-05"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 6.74275536705071e-06"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 3.37015249596284e-06"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 1.68445549902918e-06"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 8.41919677752045e-07"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.2081173812214e-07"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.10325613814177e-07"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 1.05132848760014e-07"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 5.2541417494556e-08"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.6262089225515e-08"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.31248361623371e-08"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 6.56191101455761e-09"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 3.28742305599761e-09"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 1.63145386089525e-09"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 8.19097567550386e-10"
[1] "Raking...Iteration 43"
[1] "Current iteration changed total weights by 4.13800105292239e-10"
[1] "Raking...Iteration 44"
[1] "Current iteration changed total weights by 2.04557204508404e-10"
[1] "Raking...Iteration 45"
[1] "Current iteration changed total weights by 9.81050241044557e-11"
[1] "Raking...Iteration 46"
[1] "Current iteration changed total weights by 5.28902477370252e-11"
[1] "Raking...Iteration 47"
[1] "Current iteration changed total weights by 3.22354920534451e-11"
[1] "Raking...Iteration 48"
[1] "Current iteration changed total weights by 1.09625641897537e-11"
[1] "Raking...Iteration 49"
[1] "Current iteration changed total weights by 6.39993613660295e-12"
[1] "Raking...Iteration 50"
[1] "Current iteration changed total weights by 1.26053056881403e-11"
[1] "Raking converged in 50 iterations"
✅ Finished: weight_2050_dryhot | Rescaled sum = 3373040 

🔁 Raking: 2030 wetwarm 
[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 10143.6303610591"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 1113.06870446721"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 105.037972609987"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 29.9472527882443"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 12.8230399590764"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 5.45254412008754"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 2.31319537664094"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 0.980864719763577"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 0.415861450094028"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 0.17630675687695"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 0.0747449329100002"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.031687754416488"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.0134338306667572"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.00569518355356508"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.00241443405678576"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.00102358254635254"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.000433940664588184"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.000183966107171363"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 7.79911425734525e-05"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 3.30637973288694e-05"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 1.40171649833376e-05"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 5.94247738694431e-06"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 2.51926749139653e-06"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 1.06802578830889e-06"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 4.52777600523646e-07"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 1.91947772842926e-07"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 8.13775889452195e-08"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 3.44996672341225e-08"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 1.46203362194619e-08"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 6.19908585575146e-09"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 2.62605176493125e-09"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 1.11392478574501e-09"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.74708217179654e-10"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.01649696940365e-10"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 8.35883029459694e-11"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 3.96921939760375e-11"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.0953350166053e-11"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 2.14316342450616e-11"
[1] "Raking converged in 38 iterations"
✅ Finished: weight_2030_wetwarm | Rescaled sum = 3644937 

🔁 Raking: 2050 wetwarm </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 12090.1233458528"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 2530.22683480276"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 545.289086929603"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 239.281867562689"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 115.949247522464"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 57.2090896353898"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 28.4239091829035"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 14.1658930184014"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 7.07045651113144"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 3.53157494715733"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 1.76460487893446"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.881871777955239"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.440760681424373"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.220302768535746"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.110115109338703"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.0550400471506076"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.0275114284937814"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.0137514570014133"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.00687361027012179"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 0.00343574877195935"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 0.00171734697735942"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 0.000858410010529165"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 0.000429073351381037"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 0.000214470876098494"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 0.000107202549742391"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 5.3584837172771e-05"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 2.67842064797241e-05"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 1.33879998085451e-05"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 6.6919454595471e-06"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 3.3449464078017e-06"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 1.67195333011794e-06"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 8.35729210946212e-07"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.17734884960996e-07"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.08805286450175e-07"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 1.0436439773498e-07"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 5.21646754125804e-08"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 2.60748477809436e-08"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.30374669393696e-08"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 6.51523252015451e-09"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 3.25329541084329e-09"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 1.62665081404612e-09"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 8.13767053742254e-10"
[1] "Raking...Iteration 43"
[1] "Current iteration changed total weights by 4.05445566009632e-10"
[1] "Raking...Iteration 44"
[1] "Current iteration changed total weights by 2.10180650661584e-10"
[1] "Raking...Iteration 45"
[1] "Current iteration changed total weights by 1.01577857236634e-10"
[1] "Raking...Iteration 46"
[1] "Current iteration changed total weights by 5.25938181894503e-11"
[1] "Raking...Iteration 47"
[1] "Current iteration changed total weights by 1.94128602082344e-11"
[1] "Raking...Iteration 48"
[1] "Current iteration changed total weights by 1.46402334699758e-11"
[1] "Raking...Iteration 49"
[1] "Current iteration changed total weights by 1.23349663816441e-11"
[1] "Raking...Iteration 50"
[1] "Current iteration changed total weights by 1.2398304605199e-11"
[1] "Raking converged in 50 iterations"
✅ Finished: weight_2050_wetwarm | Rescaled sum = 3373040 

🔁 Raking: 2030 nzs </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 10310.5139991802"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 1147.14331690837"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 101.733262402602"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 25.9315722748736"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 11.0252278065824"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 4.69483316897593"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 1.99393074738122"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 0.846385398511415"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 0.359228191684076"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 0.152459737715725"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 0.0647043282166533"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.0274605229968755"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.0116542182249344"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.00494603299837493"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.00209908811282927"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.000890849298668839"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.000378074842956433"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.000160454272056909"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 6.80965023867608e-05"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 2.89000258972272e-05"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 1.2265119010646e-05"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 5.20529340980458e-06"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 2.20912054499367e-06"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 9.37541801249164e-07"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 3.97889870940027e-07"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 1.68862695271166e-07"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 7.16640195519425e-08"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 3.04108449533658e-08"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 1.29057503017727e-08"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 5.47438200326766e-09"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 2.32431085489537e-09"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 9.85509063244905e-10"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 4.1738801304092e-10"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 1.79832648772305e-10"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 7.77217179503964e-11"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 3.09496317463243e-11"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 1.31100130751349e-11"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.86589632633627e-11"
[1] "Raking converged in 38 iterations"
✅ Finished: weight_2030_nzs | Rescaled sum = 3644937 

🔁 Raking: 2050 nzs </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Raking...Iteration 1"
[1] "Current iteration changed total weights by 12582.6080258256"
[1] "Raking...Iteration 2"
[1] "Current iteration changed total weights by 2656.25630869676"
[1] "Raking...Iteration 3"
[1] "Current iteration changed total weights by 579.244442638124"
[1] "Raking...Iteration 4"
[1] "Current iteration changed total weights by 255.466182139351"
[1] "Raking...Iteration 5"
[1] "Current iteration changed total weights by 124.12030371334"
[1] "Raking...Iteration 6"
[1] "Current iteration changed total weights by 61.4601183558639"
[1] "Raking...Iteration 7"
[1] "Current iteration changed total weights by 30.659206524823"
[1] "Raking...Iteration 8"
[1] "Current iteration changed total weights by 15.3451459877343"
[1] "Raking...Iteration 9"
[1] "Current iteration changed total weights by 7.69268071979611"
[1] "Raking...Iteration 10"
[1] "Current iteration changed total weights by 3.85949002141116"
[1] "Raking...Iteration 11"
[1] "Current iteration changed total weights by 1.93711317103484"
[1] "Raking...Iteration 12"
[1] "Current iteration changed total weights by 0.972448832449166"
[1] "Raking...Iteration 13"
[1] "Current iteration changed total weights by 0.488227274664997"
[1] "Raking...Iteration 14"
[1] "Current iteration changed total weights by 0.245131521603412"
[1] "Raking...Iteration 15"
[1] "Current iteration changed total weights by 0.123079933429499"
[1] "Raking...Iteration 16"
[1] "Current iteration changed total weights by 0.0617989151597148"
[1] "Raking...Iteration 17"
[1] "Current iteration changed total weights by 0.0310296741706161"
[1] "Raking...Iteration 18"
[1] "Current iteration changed total weights by 0.0155802695684296"
[1] "Raking...Iteration 19"
[1] "Current iteration changed total weights by 0.00782300155729376"
[1] "Raking...Iteration 20"
[1] "Current iteration changed total weights by 0.00392800666774296"
[1] "Raking...Iteration 21"
[1] "Current iteration changed total weights by 0.00197229190246329"
[1] "Raking...Iteration 22"
[1] "Current iteration changed total weights by 0.000990307926894141"
[1] "Raking...Iteration 23"
[1] "Current iteration changed total weights by 0.000497243783062373"
[1] "Raking...Iteration 24"
[1] "Current iteration changed total weights by 0.000249671222702641"
[1] "Raking...Iteration 25"
[1] "Current iteration changed total weights by 0.000125362489825309"
[1] "Raking...Iteration 26"
[1] "Current iteration changed total weights by 6.29458034132058e-05"
[1] "Raking...Iteration 27"
[1] "Current iteration changed total weights by 3.1605737912721e-05"
[1] "Raking...Iteration 28"
[1] "Current iteration changed total weights by 1.58695638226014e-05"
[1] "Raking...Iteration 29"
[1] "Current iteration changed total weights by 7.96826984250654e-06"
[1] "Raking...Iteration 30"
[1] "Current iteration changed total weights by 4.00095074870599e-06"
[1] "Raking...Iteration 31"
[1] "Current iteration changed total weights by 2.00891721136021e-06"
[1] "Raking...Iteration 32"
[1] "Current iteration changed total weights by 1.00869897295963e-06"
[1] "Raking...Iteration 33"
[1] "Current iteration changed total weights by 5.06479979012209e-07"
[1] "Raking...Iteration 34"
[1] "Current iteration changed total weights by 2.543062486704e-07"
[1] "Raking...Iteration 35"
[1] "Current iteration changed total weights by 1.2769646767774e-07"
[1] "Raking...Iteration 36"
[1] "Current iteration changed total weights by 6.41192587913508e-08"
[1] "Raking...Iteration 37"
[1] "Current iteration changed total weights by 3.21929598534609e-08"
[1] "Raking...Iteration 38"
[1] "Current iteration changed total weights by 1.61665286713131e-08"
[1] "Raking...Iteration 39"
[1] "Current iteration changed total weights by 8.11006850565121e-09"
[1] "Raking...Iteration 40"
[1] "Current iteration changed total weights by 4.07511735467381e-09"
[1] "Raking...Iteration 41"
[1] "Current iteration changed total weights by 2.04322259111933e-09"
[1] "Raking...Iteration 42"
[1] "Current iteration changed total weights by 1.0333868205592e-09"
[1] "Raking...Iteration 43"
[1] "Current iteration changed total weights by 5.13258435752562e-10"
[1] "Raking...Iteration 44"
[1] "Current iteration changed total weights by 2.60030219578766e-10"
[1] "Raking...Iteration 45"
[1] "Current iteration changed total weights by 1.27842236796738e-10"
[1] "Raking...Iteration 46"
[1] "Current iteration changed total weights by 6.4663441268209e-11"
[1] "Raking...Iteration 47"
[1] "Current iteration changed total weights by 3.36362604436147e-11"
[1] "Raking...Iteration 48"
[1] "Current iteration changed total weights by 1.82366344247953e-11"
[1] "Raking...Iteration 49"
[1] "Current iteration changed total weights by 1.16116005699496e-11"
[1] "Raking...Iteration 50"
[1] "Current iteration changed total weights by 9.08839670188399e-12"
[1] "Raking...Iteration 51"
[1] "Current iteration changed total weights by 9.20125087233714e-12"
[1] "Raking converged in 51 iterations"
✅ Finished: weight_2050_nzs | Rescaled sum = 3373040 </code></pre>
</div>
</div>
<p>Weights for the household database. In any household survey, family members share the same household weight. Multiplying that weight by the number of household members over all observations adds to the total population of that year. In the persons dataset, the individual’s weight is the household weight divided by the number of family members. But when we do our raking procedure to reweight the dataset to match projected future conditions, we change the individual weights of some family members, but not of others who are not subject to the new conditions. So the family weights need to change to reflect that. This is what is happening below where we create the variables <code>hh_weight_year_scenario</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute hhsize (if not done already)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>hh_size <span class="ot">&lt;-</span> rakedata_base <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ones =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">hhsize =</span> <span class="fu">sum</span>(ones, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge household size back into rakedata_base</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>rakedata_base <span class="ot">&lt;-</span> rakedata_base <span class="sc">|&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">hhsize_old =</span> hhsize) <span class="sc">|&gt;</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_size, <span class="at">by =</span> <span class="st">"UID"</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all hh_weight_* columns</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get all dynamically created person-weight columns</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>weight_cols <span class="ot">&lt;-</span> <span class="fu">names</span>(rakedata_base)[<span class="fu">grepl</span>(<span class="st">"^weight_</span><span class="sc">\\</span><span class="st">d{4}_.+"</span>, <span class="fu">names</span>(rakedata_base))]</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create household weight columns</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (wcol <span class="cf">in</span> weight_cols) {</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  hhcol <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"weight_"</span>, <span class="st">"hh_weight_"</span>, wcol)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>  rakedata_base[[hhcol]] <span class="ot">&lt;-</span> rakedata_base[[wcol]] <span class="sc">/</span> rakedata_base<span class="sc">$</span>hhsize</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate to household level</span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="co"># All household-weight columns including 2023</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>hh_weight_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^hh_weight_"</span>, <span class="fu">names</span>(rakedata_base), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>weights_scenarios <span class="ot">&lt;-</span> rakedata_base <span class="sc">|&gt;</span> </span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(hh_weight_cols), <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Save pp_microsim12</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>pp_microsim12 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(rakedata_base)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="rescaling-labor-income-according-to-changes-to-the-wage-bill" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Rescaling labor income according to changes to the wage bill</h1>
<p>As a last step, we rescale labor income according to changes to the wage bill in the macro scenario. Recall that in our macrodata file, we estimated growth rates for a number of variables, including the wage bill for the three sectors. We take stock of the wage bill for each of those in the survey year and then we scale each category’s total to match the growth rate in the macro file and see how the individual wages change for each individual involved and add back the family labor income to see the impact on total income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get wage growth rates for all scenarios/years</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>wage_growth_factors <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">%in%</span> analysis_years, scenario_id <span class="sc">%in%</span> scenarios, Variant <span class="sc">==</span> variants[<span class="dv">7</span>]) <span class="sc">|&gt;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    scenario_id, year,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    rwage_agr_b_lcu_growth,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    rwage_man_b_lcu_growth,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    rwage_ser_b_lcu_growth</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note the use of the newer <code>cross_join()</code> below, which replaced a left_join(by = character() ) that has been depracated after dplyr 1.1.0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute actual wages by sector and year-scenario weight</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>wage_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sc <span class="cf">in</span> scenarios) {</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    wname <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"weight_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    wages_sector <span class="ot">&lt;-</span> pp_microsim12 <span class="sc">|&gt;</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SAM3_job1)) <span class="sc">|&gt;</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(SAM3_job1) <span class="sc">|&gt;</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">wages_2023 =</span> <span class="fu">sum</span>(annual_labor_total <span class="sc">*</span> weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">wages_proj =</span> <span class="fu">sum</span>(annual_labor_total <span class="sc">*</span> .data[[wname]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cross_join</span>(</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>        wage_growth_factors <span class="sc">|&gt;</span> </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>          <span class="fu">filter</span>(year <span class="sc">==</span> yr, scenario_id <span class="sc">==</span> sc)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">wages_target =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>          SAM3_job1 <span class="sc">==</span> <span class="st">"Agriculture"</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> rwage_agr_b_lcu_growth,</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>          SAM3_job1 <span class="sc">==</span> <span class="st">"Manufactures"</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> rwage_man_b_lcu_growth,</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>          SAM3_job1 <span class="sc">==</span> <span class="st">"Services"</span> <span class="sc">~</span> wages_2023 <span class="sc">*</span> rwage_ser_b_lcu_growth</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">wage_coef =</span> wages_target <span class="sc">/</span> wages_proj,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">scenario_id =</span> sc,</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">year =</span> yr</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(yr, <span class="st">"_"</span>, sc)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>    wage_results[[key]] <span class="ot">&lt;-</span> wages_sector</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Loop to apply wage_coef to each year-scenario</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pp_microsim13 <span class="ot">&lt;-</span> pp_microsim12 <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_labor_income_2023 =</span> monthly_labor_total,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_labor_total_2023   =</span> annual_labor_total</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sc <span class="cf">in</span> scenarios) {</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> <span class="fu">paste0</span>(yr, <span class="st">"_"</span>, sc)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    coef_table <span class="ot">&lt;-</span> wage_results[[key]]</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a named vector: wage_coef by SAM3_job1</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    coef_lookup <span class="ot">&lt;-</span> <span class="fu">setNames</span>(coef_table<span class="sc">$</span>wage_coef, coef_table<span class="sc">$</span>SAM3_job1)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dynamic column names</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    mon_out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"monthly_labor_income_"</span>, key)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    ann_out <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"annual_labor_total_"</span>, key)</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Match and apply</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    pp_microsim13[[mon_out]] <span class="ot">&lt;-</span> coef_lookup[pp_microsim13<span class="sc">$</span>SAM3_job1] <span class="sc">*</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>      pp_microsim13<span class="sc">$</span>monthly_labor_income_2023</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    pp_microsim13[[ann_out]] <span class="ot">&lt;-</span> coef_lookup[pp_microsim13<span class="sc">$</span>SAM3_job1] <span class="sc">*</span></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>      pp_microsim13<span class="sc">$</span>annual_labor_total_2023</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="microsimulations" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Microsimulations</h1>
<p>We now implement different shocks according to various scenarios.</p>
<section id="macro-scenarios-without-additional-impacts" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="macro-scenarios-without-additional-impacts"><span class="header-section-number">7.1</span> Macro scenarios without additional impacts</h2>
<p>First we only adjust labor income according to the reweighting procedure and rescaling of the wage bill. We create household-level total monthly labor income (mli_<em>) and multiplier coefficients (mli_coef_</em>) for each scenario. These will allow us to rescale, labor income, and self-employment income. There is a mix of naming conventions within the transformation below born out of mixing different codebases, but the end result is consistent with the naming convention that we have been using here.</p>
<p>Total income in the household dataset (hh_income).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the new income columns</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>mli_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^monthly_labor_income_</span><span class="sc">\\</span><span class="st">d{4}_.+"</span>, <span class="fu">names</span>(pp_microsim13), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Household aggregation</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>hh_li <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2023 =</span> <span class="fu">sum</span>(monthly_labor_income_2023, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">all_of</span>(mli_cols), <span class="sc">~</span><span class="fu">sum</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.names =</span> <span class="st">"mli_{.col}"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute multipliers</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract only the rescaled mli columns</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>mli_scen_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^mli_monthly_labor_income_"</span>, <span class="fu">names</span>(hh_li), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create coefficients</span></span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> mli_scen_cols) {</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  coef_col <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"mli_monthly_labor_income_"</span>, <span class="st">"mli_coef_"</span>, col)</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  hh_li[[coef_col]] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    hh_li<span class="sc">$</span>mli_2023 <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">1</span>,</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    hh_li[[col]] <span class="sc">/</span> hh_li<span class="sc">$</span>mli_2023</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean final format</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: rename scenario mli columns to match old style (mli_2030_baseline)</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(hh_li) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"mli_monthly_labor_income_"</span>, <span class="st">"mli_"</span>, <span class="fu">names</span>(hh_li))</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep what we need</span></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>hh_li <span class="ot">&lt;-</span> hh_li <span class="sc">|&gt;</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, <span class="fu">starts_with</span>(<span class="st">"mli_"</span>), <span class="fu">starts_with</span>(<span class="st">"mli_coef_"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We are now ready to merge this into hh_income and use the mli_coef_* variables to rescale household-level income per scenario.</p>
<p>Build IC microsim 01</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ic_microsim01 <span class="ot">&lt;-</span> hh_income <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_li, <span class="at">by =</span> <span class="st">"UID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_scenarios, <span class="at">by =</span> <span class="st">"UID"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2023 =</span> ShemDaq,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2023 =</span> ShemTviTdasaqm,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">agr_income_2023 =</span> Shem_Sof,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2023 =</span> Shemosavalisul</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rescale incomes using dynamic multipliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all mli_coef_* columns</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>coef_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^mli_coef_"</span>, <span class="fu">names</span>(ic_microsim01), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create rescaled income columns</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (coef <span class="cf">in</span> coef_cols) {</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  suffix <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"mli_coef_"</span>, <span class="st">""</span>, coef)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create income variable names</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  ic_microsim01[[<span class="fu">paste0</span>(<span class="st">"labor_income_"</span>, suffix)]] <span class="ot">&lt;-</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    ic_microsim01<span class="sc">$</span>labor_income_2023 <span class="sc">*</span> ic_microsim01[[coef]]</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  ic_microsim01[[<span class="fu">paste0</span>(<span class="st">"self_employment_income_"</span>, suffix)]] <span class="ot">&lt;-</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>    ic_microsim01<span class="sc">$</span>self_employment_income_2023 <span class="sc">*</span> ic_microsim01[[coef]]</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And recalculate total income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Find all suffixes again</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>suffixes <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"mli_coef_"</span>, <span class="st">""</span>, coef_cols)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (sfx <span class="cf">in</span> suffixes) {</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  ic_microsim01[[<span class="fu">paste0</span>(<span class="st">"totalinc_"</span>, sfx)]] <span class="ot">&lt;-</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    ic_microsim01<span class="sc">$</span>totalinc_2023 <span class="sc">-</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coalesce</span>(ic_microsim01<span class="sc">$</span>labor_income_2023, <span class="dv">0</span>) <span class="sc">-</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coalesce</span>(ic_microsim01<span class="sc">$</span>self_employment_income_2023, <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coalesce</span>(ic_microsim01[[<span class="fu">paste0</span>(<span class="st">"labor_income_"</span>, sfx)]], <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coalesce</span>(ic_microsim01[[<span class="fu">paste0</span>(<span class="st">"self_employment_income_"</span>, sfx)]], <span class="dv">0</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recalculate adult-equivalent consumption and poverty status</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>totinc_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^totalinc_"</span>, <span class="fu">names</span>(ic_microsim01), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>totinc_suffixes <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"totalinc_"</span>, <span class="st">""</span>, totinc_cols)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> totinc_cols) {</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  suffix <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"totalinc_"</span>, <span class="st">""</span>, col)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  coef_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"totinc_coef_"</span>, suffix)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  ic_microsim01[[coef_name]] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    ic_microsim01<span class="sc">$</span>totalinc_2023 <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>,</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    ic_microsim01[[col]] <span class="sc">/</span> ic_microsim01<span class="sc">$</span>totalinc_2023</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Build IC Coef scenarios</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>coef_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^totinc_coef_"</span>, <span class="fu">names</span>(ic_microsim01), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>ic_coef_scenarios <span class="ot">&lt;-</span> ic_microsim01 <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID, <span class="fu">all_of</span>(coef_cols))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we apply to consumption:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ca_microsim01 <span class="ot">&lt;-</span> poverty <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(weights_scenarios, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ic_coef_scenarios, <span class="fu">join_by</span>(UID <span class="sc">==</span> UID)) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">tc_2023 =</span> totcons) <span class="sc">|&gt;</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">hh_weight_2023 =</span> weights,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">adult_equivalent =</span> tc_2023 <span class="sc">/</span> aecons  <span class="co"># derives equivalent household size</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Adjust tc_* and recalculate poverty</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (coef <span class="cf">in</span> coef_cols) {</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  suffix <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"totinc_coef_"</span>, <span class="st">""</span>, coef)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  tc_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"tc_"</span>, suffix)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  ae_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"aecons_"</span>, suffix)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  poor_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"poor_"</span>, suffix)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  ca_microsim01[[tc_col]] <span class="ot">&lt;-</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    ca_microsim01<span class="sc">$</span>tc_2023 <span class="sc">*</span> ca_microsim01[[coef]]</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  ca_microsim01[[ae_col]] <span class="ot">&lt;-</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    ca_microsim01[[tc_col]] <span class="sc">/</span> ca_microsim01<span class="sc">$</span>adult_equivalent</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  ca_microsim01[[poor_col]] <span class="ot">&lt;-</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">if_else</span>(ca_microsim01[[ae_col]] <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>At this point we re-calculate decile groups for the NZS scenario, to be able to “give back” energy tax revenues to the lower deciles. This scenario is not ready yet, so we need to come back to this. Review Armenia’s microsimulation file for this.</p>
</section>
<section id="climate-change" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="climate-change"><span class="header-section-number">7.2</span> Climate change</h2>
<p>In these sections we use Administrative Level 1 data on yield losses and labor productivity losses due to climate change that are provided in the study commissioned for Armenia’s CCDR <em>Estimating the Economic Impacts of Climate Change in Armenia</em> <span class="citation" data-cites="strzepek_estimating_2024">(<a href="#ref-strzepek_estimating_2024" role="doc-biblioref">Strzepek, Boehlert, Castillo, &amp; Smet, 2024</a>)</span>.</p>
<p>In the climate change scenario, we ask ourselves, what would happen if agriculture revenues from crops and livestock are reduced due to losses in productivity due to heat? For this, we use crops data.</p>
<p>We add a moving window average and max value for our labor productivity data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First calculate moving window average</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>labor_productivity01 <span class="ot">&lt;-</span> labor_productivity <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix region names</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ajaria"</span> <span class="sc">~</span> <span class="st">"Adjara A.R."</span>,</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Racha-Lechkhumi-Kvemo Svaneti"</span> <span class="sc">~</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span>,</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Abkhazia"</span> <span class="sc">~</span> <span class="st">"Autonomous Republic of Abkhazia"</span>,</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>           scenario) <span class="sc">|&gt;</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Moving window average 5 years before, 5 after</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">moving_avg =</span> <span class="fu">rollapply</span>(</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>      pct_change,</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> mean,</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">partial =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Clim scenarios to select</span></span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(labor_productivity01<span class="sc">$</span>scenario))</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving average for year of interest</span></span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="co"># We are interested in cs[1] = "Hot/Dry"</span></span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a>labor_pdcvty_loss <span class="ot">&lt;-</span> labor_productivity01 <span class="sc">|&gt;</span></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a>    regions[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)],</span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(region)</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scenario <span class="sc">==</span> cs[<span class="dv">1</span>] <span class="sc">&amp;</span> year <span class="sc">%in%</span> analysis_years) <span class="sc">|&gt;</span></span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>pct_change,</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>scenario) <span class="sc">|&gt;</span></span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(sector,year),</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> moving_avg,</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"labprod_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We add a moving window average and max value for our crops productivity data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>agriculture_productivity01 <span class="ot">&lt;-</span> agriculture_productivity <span class="sc">|&gt;</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix region names</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Ajaria"</span> <span class="sc">~</span> <span class="st">"Adjara A.R."</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Racha-Lechkhumi-Kvemo Svaneti"</span> <span class="sc">~</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Abkhazia"</span> <span class="sc">~</span> <span class="st">"Autonomous Republic of Abkhazia"</span>,</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>           scenario) <span class="sc">|&gt;</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">|&gt;</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix missing</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_change =</span> <span class="fu">if_else</span>(</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(pct_change),<span class="dv">0</span>,pct_change</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Moving window average</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">moving_avg =</span> <span class="fu">rollapply</span>(</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>      pct_change,</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">11</span>,</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 5 years before, 5 after + reference year = 11</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> mean,</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">partial =</span> <span class="cn">TRUE</span>,</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Clim scenarios to select</span></span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(agriculture_productivity01<span class="sc">$</span>scenario))</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving average for year of interest</span></span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>ag_pdcvty_loss <span class="ot">&lt;-</span> agriculture_productivity01 <span class="sc">|&gt;</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    regions[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)],</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(region)</span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(scenario <span class="sc">==</span> cs[<span class="dv">1</span>] <span class="sc">&amp;</span> </span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>         year <span class="sc">%in%</span> analysis_years) <span class="sc">|&gt;</span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>pct_change, </span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>scenario,</span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>product) <span class="sc">|&gt;</span></span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> <span class="fu">c</span>(year), </span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> moving_avg,</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"agprod_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There is no explicit livestock income in this dataset, so we leave livestock productivity out.</p>
<p>And then we introduce these values in our ag income and labor income data. First, we attach the percentage losses to the appropriate data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Persons processed dataset</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pp_microsim_cc01 <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(labor_pdcvty_loss, </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(region <span class="sc">==</span> RegNo))</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Household income processed dataset</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We also impact ag income with ag labor productivity</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc01 <span class="ot">&lt;-</span> ic_microsim01 <span class="sc">|&gt;</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_basics, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span> </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(labor_pdcvty_loss[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>)],</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cross_join</span>(ag_pdcvty_loss[,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>)])</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="do">##write.table(lab_loss_avg, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And we first shock labor income (need to automate this in a loop).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Labor income according to sector</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>pp_microsim_cc02 <span class="ot">&lt;-</span> pp_microsim_cc01 <span class="sc">|&gt;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sector =</span> <span class="fu">as.numeric</span>(SAM3_job1)) <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_cc =</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Industry_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2030_baseline <span class="sc">*</span> </span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Services_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_cc =</span></span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_when</span>(</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span></span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Industry_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>        sector <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span></span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>          monthly_labor_income_2050_baseline <span class="sc">*</span> </span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>          (<span class="dv">100</span> <span class="sc">+</span> labprod_Services_2050)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="cn">NA</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We aggregate at household level and take note of the percent difference between the two labor incomes, so that we can impact labor income by that amount. We don’t do it with absolute numbers because we don’t know the assumptions made by the poverty team to construct the income variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>ic_new_incomes01 <span class="ot">&lt;-</span> pp_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(UID) <span class="sc">|&gt;</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_cc =</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(mli_2030_baseline_cc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_cc =</span> </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(mli_2050_baseline_cc, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_original =</span> </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(monthly_labor_income_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_original =</span> </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(monthly_labor_income_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2030_baseline_cc_coef =</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        mli_2030_original <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(mli_2030_original),</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        mli_2030_baseline_cc <span class="sc">/</span> mli_2030_original</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mli_2050_baseline_cc_coef =</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>        mli_2050_original <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(mli_2050_original),</span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>,</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>        mli_2050_baseline_cc <span class="sc">/</span> mli_2050_original</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc02 <span class="ot">&lt;-</span> ic_microsim_cc01 <span class="sc">|&gt;</span></span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ic_new_incomes01, </span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2030_baseline_cc =</span> </span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a>      labor_income_2030_baseline <span class="sc">*</span> mli_2030_baseline_cc_coef,</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2030_baseline_cc =</span> </span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2030_baseline <span class="sc">*</span> mli_2030_baseline_cc_coef,</span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">labor_income_2050_baseline_cc =</span> </span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>      labor_income_2050_baseline <span class="sc">*</span> mli_2050_baseline_cc_coef,</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">self_employment_income_2050_baseline_cc =</span> </span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>      self_employment_income_2050_baseline <span class="sc">*</span> mli_2050_baseline_cc_coef</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we impact agricultural income <code>agr_income_2030_baseline</code> (there is no livestock income<code>lvstk</code> in this dataset).</p>
<p>And recalculate total income. First labor productivity alone. I learned about pick with this one, because the (.) is no longer interpreted as “this”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>ic_microsim_cc03 <span class="ot">&lt;-</span> ic_microsim_cc02 <span class="sc">|&gt;</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labor productivity applied to ag income</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">agr_income_2030_cc =</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>      agr_income_2023 <span class="sc">*</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Labor shock</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2030)<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Crops shock</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">100</span> <span class="sc">+</span> agprod_2030)<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">agr_income_2050_cc =</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>      agr_income_2023 <span class="sc">*</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Labor shock</span></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">100</span> <span class="sc">+</span> labprod_Agriculture_2050)<span class="sc">/</span><span class="dv">100</span> <span class="sc">*</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Crops shock</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">100</span> <span class="sc">+</span> agprod_2050)<span class="sc">/</span><span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_cc =</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>      totalinc_2030_baseline <span class="sc">-</span></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2030_baseline,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2030_baseline,</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>                   agr_income_2023), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    <span class="sc">+</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2030_baseline_cc,</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2030_baseline_cc,</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>                   agr_income_2030_cc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_cc =</span></span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>      totalinc_2050_baseline <span class="sc">-</span></span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2050_baseline,</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2050_baseline,</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>                   agr_income_2023), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">pick</span>(labor_income_2050_baseline_cc,</span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>                   self_employment_income_2050_baseline_cc,</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>                   agr_income_2050_cc), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_cc_coef =</span></span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(totalinc_2030_baseline <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2030_baseline_cc <span class="sc">/</span></span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>                totalinc_2030_baseline),</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_cc_coef =</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(totalinc_2050_baseline <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2050_baseline_cc <span class="sc">/</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>                totalinc_2050_baseline)</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2030_baseline_cc_coef =</span></span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(<span class="fu">is.na</span>(totalinc_2030_baseline_cc_coef),</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2030_baseline_cc_coef),</span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">totalinc_2050_baseline_cc_coef =</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">if_else</span>(<span class="fu">is.na</span>(totalinc_2050_baseline_cc_coef),</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>, totalinc_2050_baseline_cc_coef)</span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We assume that the loss in income translates into a loss of expenditure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>income_losses <span class="ot">&lt;-</span> ic_microsim_cc03 <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(UID,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>         totalinc_2030_baseline_cc, </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>         totalinc_2050_baseline_cc,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>         totalinc_2030_baseline_cc_coef, </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>         totalinc_2050_baseline_cc_coef)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>ca_microsim02 <span class="ot">&lt;-</span> ca_microsim01 <span class="sc">|&gt;</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(income_losses, <span class="fu">join_by</span>(UID))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="co"># And now reduce total consumption</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>ca_microsim03 <span class="ot">&lt;-</span> ca_microsim02 <span class="sc">|&gt;</span> </span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tc_2030_baseline_cc =</span> tc_2030_baseline <span class="sc">*</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>           totalinc_2030_baseline_cc_coef,</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">tc_2050_baseline_cc =</span> tc_2050_baseline <span class="sc">*</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>           totalinc_2050_baseline_cc_coef         </span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span> </span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">aecons_2030_baseline_cc =</span> </span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>           tc_2030_baseline_cc <span class="sc">/</span> adult_equivalent,</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">aecons_2050_baseline_cc =</span> </span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>           tc_2050_baseline_cc <span class="sc">/</span> adult_equivalent) <span class="sc">|&gt;</span> </span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poor_2030_baseline_cc =</span> </span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(aecons_2030_baseline_cc <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">poor_2050_baseline_cc =</span> </span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>           <span class="fu">if_else</span>(aecons_2050_baseline_cc <span class="sc">&lt;</span> pline, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a><span class="do">##write.table(test, "clipboard", sep="\t", row.names=FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="agregate-consumption-effects" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Agregate consumption effects</h1>
<p>We first estimate quintiles from our scenario estimated consumption.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ca_microsim04 <span class="ot">&lt;-</span> ca_microsim03</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you already have `analysis_years` and `scenarios` defined</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sc <span class="cf">in</span> scenarios) {</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construct variable names</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    inc_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"tc_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    wgt_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"hh_weight_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    qnt_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"quintiles_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract income and weights</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    inc <span class="ot">&lt;-</span> ca_microsim04[[inc_var]]</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    wgt <span class="ot">&lt;-</span> ca_microsim04[[wgt_var]]</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace NAs in income with zero</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    inc[<span class="fu">is.na</span>(inc)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute weighted quintile cutoffs</span></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    cuts <span class="ot">&lt;-</span> Hmisc<span class="sc">::</span><span class="fu">wtd.quantile</span>(inc, <span class="at">weights =</span> wgt, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>, <span class="fl">0.2</span>))</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cut into quintile groups and assign to new column</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>    ca_microsim04[[qnt_var]] <span class="ot">&lt;-</span> <span class="fu">cut</span>(inc,</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, cuts, <span class="cn">Inf</span>),</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we process the HH consumption effects from the macro team and adjust our dataset accordingly by scenario.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modify in place: parse quintile and type</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>hh_consumption_effects <span class="ot">&lt;-</span> hh_consumption_effects <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">quintile =</span> <span class="fu">as.integer</span>(<span class="fu">sub</span>(<span class="st">"h-hh([1-5])_.*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, hh_type)),</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">if_else</span>(<span class="fu">grepl</span>(<span class="st">"_rur$"</span>, hh_type), <span class="dv">2</span>L, <span class="dv">1</span>L)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hh_type) <span class="sc">%&gt;%</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(scenario_id, quintile, type),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"shock"</span></span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Only use subset of scenarios present in hh_consumption_effects</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sc_subset <span class="ot">&lt;-</span> <span class="fu">unique</span>(hh_consumption_effects<span class="sc">$</span>scenario_id)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>ca_microsim05 <span class="ot">&lt;-</span> ca_microsim04</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sc <span class="cf">in</span> sc_subset) {</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    ae_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"aecons_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>    quint_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"quintiles_"</span>, yr, <span class="st">"_"</span>, sc)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    new_var <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"aecons_"</span>, yr, <span class="st">"_"</span>, sc, <span class="st">"_pc"</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>    shock_df <span class="ot">&lt;-</span> hh_consumption_effects <span class="sc">%&gt;%</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> yr, scenario_id <span class="sc">==</span> sc) <span class="sc">%&gt;%</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(quintile, type, shock)</span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>    ca_microsim05 <span class="ot">&lt;-</span> ca_microsim05 <span class="sc">%&gt;%</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">.quintile_join =</span> <span class="fu">as.integer</span>(.data[[quint_var]])) <span class="sc">%&gt;%</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(shock_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">".quintile_join"</span> <span class="ot">=</span> <span class="st">"quintile"</span>, <span class="st">"type"</span> <span class="ot">=</span> <span class="st">"type"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">new_var :=</span> .data[[ae_var]] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> shock)) <span class="sc">%&gt;%</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(<span class="sc">-</span>shock, <span class="sc">-</span>.quintile_join)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we reestimate poverty for these columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>ca_microsim06 <span class="ot">&lt;-</span> ca_microsim05</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (yr <span class="cf">in</span> analysis_years) {</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (sc <span class="cf">in</span> sc_subset) {</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    ae_pc_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"aecons_"</span>, yr, <span class="st">"_"</span>, sc, <span class="st">"_pc"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    poor_pc_col <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"poor_"</span>, yr, <span class="st">"_"</span>, sc, <span class="st">"_pc"</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    ca_microsim06[[poor_pc_col]] <span class="ot">&lt;-</span> <span class="fu">if_else</span>(</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>      ca_microsim06[[ae_pc_col]] <span class="sc">&lt;</span> pline, <span class="dv">1</span>L, <span class="dv">0</span>L</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="poverty-tabulates" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Poverty tabulates</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial year</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>poor_2023 <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2023) <span class="sc">|&gt;</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2023 =</span> <span class="fu">sum</span>(hh_weight_2023, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2023 =</span> <span class="fu">sum</span>(hh_weight_2023 <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_baseline =</span> <span class="fu">sum</span>(hh_weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>poor_2050_baseline <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_baseline =</span> <span class="fu">sum</span>(hh_weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_baseline =</span> <span class="fu">sum</span>(hh_weight_2050_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Dry/Hot</span></span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>poor_2030_dryhot <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_dryhot) <span class="sc">|&gt;</span> </span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a>poor_2050_dryhot <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_dryhot) <span class="sc">|&gt;</span> </span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_dryhot =</span> <span class="fu">sum</span>(hh_weight_2050_dryhot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_dryhot =</span> <span class="fu">sum</span>(hh_weight_2050_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Wet/Warm</span></span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>poor_2030_wetwarm <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_wetwarm) <span class="sc">|&gt;</span> </span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2030_wetwarm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2030_wetwarm <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>poor_2050_wetwarm <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_wetwarm) <span class="sc">|&gt;</span> </span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2050_wetwarm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2050_wetwarm <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a><span class="co"># NZS</span></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a>poor_2030_nzs <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_nzs) <span class="sc">|&gt;</span> </span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>poor_2050_nzs <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_nzs) <span class="sc">|&gt;</span> </span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_nzs =</span> <span class="fu">sum</span>(hh_weight_2050_nzs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_nzs =</span> <span class="fu">sum</span>(hh_weight_2050_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline_cc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_baseline_cc) <span class="sc">|&gt;</span></span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_baseline_cc =</span> <span class="fu">sum</span>(hh_weight_2030_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline_cc =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a>poor_2050_baseline_cc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_baseline_cc) <span class="sc">|&gt;</span></span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_baseline_cc =</span> <span class="fu">sum</span>(hh_weight_2050_baseline, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_baseline_cc =</span> <span class="fu">sum</span>(hh_weight_2050_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Price effects</span></span>
<span id="cb75-95"><a href="#cb75-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-96"><a href="#cb75-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Dry/Hot</span></span>
<span id="cb75-97"><a href="#cb75-97" aria-hidden="true" tabindex="-1"></a>poor_2030_dryhot_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-98"><a href="#cb75-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_dryhot_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-99"><a href="#cb75-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-100"><a href="#cb75-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-101"><a href="#cb75-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-102"><a href="#cb75-102" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-103"><a href="#cb75-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-104"><a href="#cb75-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-105"><a href="#cb75-105" aria-hidden="true" tabindex="-1"></a>poor_2050_dryhot_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-106"><a href="#cb75-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_dryhot_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-107"><a href="#cb75-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-108"><a href="#cb75-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_dryhot =</span> <span class="fu">sum</span>(hh_weight_2050_dryhot, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-109"><a href="#cb75-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_dryhot =</span> <span class="fu">sum</span>(hh_weight_2050_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-110"><a href="#cb75-110" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-111"><a href="#cb75-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-112"><a href="#cb75-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-113"><a href="#cb75-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Wet/Warm</span></span>
<span id="cb75-114"><a href="#cb75-114" aria-hidden="true" tabindex="-1"></a>poor_2030_wetwarm_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-115"><a href="#cb75-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_wetwarm_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-116"><a href="#cb75-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-117"><a href="#cb75-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2030_wetwarm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-118"><a href="#cb75-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2030_wetwarm <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-119"><a href="#cb75-119" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-120"><a href="#cb75-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-121"><a href="#cb75-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-122"><a href="#cb75-122" aria-hidden="true" tabindex="-1"></a>poor_2050_wetwarm_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-123"><a href="#cb75-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_wetwarm_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-124"><a href="#cb75-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-125"><a href="#cb75-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2050_wetwarm, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-126"><a href="#cb75-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_wetwarm =</span> <span class="fu">sum</span>(hh_weight_2050_wetwarm <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-127"><a href="#cb75-127" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-128"><a href="#cb75-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-129"><a href="#cb75-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-130"><a href="#cb75-130" aria-hidden="true" tabindex="-1"></a><span class="co"># NZS</span></span>
<span id="cb75-131"><a href="#cb75-131" aria-hidden="true" tabindex="-1"></a>poor_2030_nzs_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-132"><a href="#cb75-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2030_nzs_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-133"><a href="#cb75-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-134"><a href="#cb75-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-135"><a href="#cb75-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-136"><a href="#cb75-136" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-137"><a href="#cb75-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-138"><a href="#cb75-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-139"><a href="#cb75-139" aria-hidden="true" tabindex="-1"></a>poor_2050_nzs_pc <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span></span>
<span id="cb75-140"><a href="#cb75-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(poor_2050_nzs_pc) <span class="sc">|&gt;</span> </span>
<span id="cb75-141"><a href="#cb75-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb75-142"><a href="#cb75-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_hh_2050_nzs =</span> <span class="fu">sum</span>(hh_weight_2050_nzs, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-143"><a href="#cb75-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2050_nzs =</span> <span class="fu">sum</span>(hh_weight_2050_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb75-144"><a href="#cb75-144" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb75-145"><a href="#cb75-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb75-146"><a href="#cb75-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-147"><a href="#cb75-147" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2023, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-148"><a href="#cb75-148" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_baseline, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-149"><a href="#cb75-149" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_baseline, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-150"><a href="#cb75-150" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_dryhot, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-151"><a href="#cb75-151" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_dryhot, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-152"><a href="#cb75-152" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_wetwarm, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-153"><a href="#cb75-153" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_wetwarm, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-154"><a href="#cb75-154" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_nzs, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-155"><a href="#cb75-155" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_nzs, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-156"><a href="#cb75-156" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_baseline_cc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-157"><a href="#cb75-157" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_baseline_cc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-158"><a href="#cb75-158" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_dryhot_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-159"><a href="#cb75-159" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_dryhot_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-160"><a href="#cb75-160" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_wetwarm_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-161"><a href="#cb75-161" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_wetwarm_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-162"><a href="#cb75-162" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2030_nzs_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span>
<span id="cb75-163"><a href="#cb75-163" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_nzs_pc, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Scenario drivers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>macro_drivers <span class="ot">&lt;-</span> macro_data <span class="sc">|&gt;</span> <span class="fu">filter</span>(year<span class="sc">==</span><span class="dv">2030</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">c</span>(scenario_id,<span class="fu">ends_with</span>(<span class="st">"growth"</span>)))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(macro_drivers, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inequality-measurements" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Inequality measurements</h1>
<p>Here we estimate weighted inequality measurements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ca_microsim07 <span class="ot">&lt;-</span> ca_microsim06 <span class="co">#|&gt; </span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(RegNo == 8)</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get list of income and weight variable pairs</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>income_vars <span class="ot">&lt;-</span> <span class="fu">names</span>(ca_microsim07)[<span class="fu">grepl</span>(<span class="st">"^aecons_</span><span class="sc">\\</span><span class="st">d{4}(_[a-zA-Z0-9]+)?$"</span>, <span class="fu">names</span>(ca_microsim07))]</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We had to add the subscenarios by hand, because of poor planning in naming conventions</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>lookup_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Income_Variable =</span> <span class="fu">c</span>(income_vars, </span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2030_baseline_cc"</span>, </span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2050_baseline_cc"</span>,</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2030_dryhot_pc"</span>, </span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2050_dryhot_pc"</span>,</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2030_wetwarm_pc"</span>, </span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2050_wetwarm_pc"</span>,</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2030_nzs_pc"</span>, </span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"aecons_2050_nzs_pc"</span>),</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Weight_Variable =</span> <span class="fu">c</span>(<span class="fu">gsub</span>(<span class="st">"^aecons_"</span>, <span class="st">"hh_weight_"</span>, income_vars),</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2030_baseline"</span>,</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2050_baseline"</span>,</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2030_dryhot"</span>,</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2050_dryhot"</span>,</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2030_wetwarm"</span>,</span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2050_wetwarm"</span>,</span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2030_nzs"</span>,</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"hh_weight_2050_nzs"</span>)</span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Weighted FGT function</span></span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>weighted_FGT <span class="ot">&lt;-</span> <span class="cf">function</span>(income, weight, pline, alpha) {</span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (alpha <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(weight[income <span class="sc">&lt;</span> pline], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>    gap <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="dv">0</span>, (pline <span class="sc">-</span> income) <span class="sc">/</span> pline)</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>((gap <span class="sc">^</span> alpha) <span class="sc">*</span> weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure calculation function</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>calculate_measures <span class="ot">&lt;-</span> <span class="cf">function</span>(income_var, weight_var) {</span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>  income <span class="ot">&lt;-</span> ca_microsim07[[income_var]]</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">&lt;-</span> ca_microsim07[[weight_var]] <span class="sc">*</span> ca_microsim07<span class="sc">$</span>hhsize</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Income Variable</span><span class="st">`</span> <span class="ot">=</span> income_var,</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">FGT (alpha=0) - Poverty Headcount</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">weighted_FGT</span>(income, weight, pline, <span class="at">alpha =</span> <span class="dv">0</span>),</span>
<span id="cb77-47"><a href="#cb77-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">FGT (alpha=1) - Poverty Gap</span><span class="st">`</span>       <span class="ot">=</span> <span class="fu">weighted_FGT</span>(income, weight, pline, <span class="at">alpha =</span> <span class="dv">1</span>),</span>
<span id="cb77-48"><a href="#cb77-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">FGT (alpha=2) - Poverty Severity</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">weighted_FGT</span>(income, weight, pline, <span class="at">alpha =</span> <span class="dv">2</span>),</span>
<span id="cb77-49"><a href="#cb77-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Gini Coefficient</span><span class="st">`</span> <span class="ot">=</span> acid<span class="sc">::</span><span class="fu">weighted.gini</span>(income, <span class="at">w =</span> weight)</span>
<span id="cb77-50"><a href="#cb77-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb77-51"><a href="#cb77-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb77-52"><a href="#cb77-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-53"><a href="#cb77-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-54"><a href="#cb77-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Run it</span></span>
<span id="cb77-55"><a href="#cb77-55" aria-hidden="true" tabindex="-1"></a>inequality_results <span class="ot">&lt;-</span> <span class="fu">pmap_dfr</span>(</span>
<span id="cb77-56"><a href="#cb77-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(lookup_table<span class="sc">$</span>Income_Variable, lookup_table<span class="sc">$</span>Weight_Variable),</span>
<span id="cb77-57"><a href="#cb77-57" aria-hidden="true" tabindex="-1"></a>  calculate_measures) <span class="sc">|&gt;</span> </span>
<span id="cb77-58"><a href="#cb77-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".Gini"</span>), <span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">"bcGini"</span>))</span>
<span id="cb77-59"><a href="#cb77-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-60"><a href="#cb77-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Review results</span></span>
<span id="cb77-61"><a href="#cb77-61" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(inequality_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Income.Variable FGT..alpha.0....Poverty.Headcount
1              aecons_2023                        0.11804520
2     aecons_2030_baseline                        0.10897804
3     aecons_2050_baseline                        0.07114242
4       aecons_2030_dryhot                        0.10955173
5       aecons_2050_dryhot                        0.07253352
6      aecons_2030_wetwarm                        0.10930649
7      aecons_2050_wetwarm                        0.07173584
8          aecons_2030_nzs                        0.10915058
9          aecons_2050_nzs                        0.07195993
10 aecons_2030_baseline_cc                        0.11121886
11 aecons_2050_baseline_cc                        0.07625666
12   aecons_2030_dryhot_pc                        0.11385126
13   aecons_2050_dryhot_pc                        0.07751656
14  aecons_2030_wetwarm_pc                        0.11175696
15  aecons_2050_wetwarm_pc                        0.07360172
16      aecons_2030_nzs_pc                        0.11040860
17      aecons_2050_nzs_pc                        0.07483337
   FGT..alpha.1....Poverty.Gap FGT..alpha.2....Poverty.Severity
1                   0.02964151                      0.011246463
2                   0.02994465                      0.012190210
3                   0.02011892                      0.008351611
4                   0.03017059                      0.012281244
5                   0.02044762                      0.008477885
6                   0.03009012                      0.012248394
7                   0.02024141                      0.008398739
8                   0.02998075                      0.012204836
9                   0.02031517                      0.008429306
10                  0.03071693                      0.012534159
11                  0.02189336                      0.009169587
12                  0.03139125                      0.012832522
13                  0.02180335                      0.009076644
14                  0.03097776                      0.012658551
15                  0.02072681                      0.008621592
16                  0.03044306                      0.012434160
17                  0.02128754                      0.008902893
   Gini.Coefficient.bcwGini
1                 0.2999614
2                 0.3257317
3                 0.3878845
4                 0.3249626
5                 0.3835812
6                 0.3251997
7                 0.3863877
8                 0.3255582
9                 0.3847287
10                0.3253775
11                0.3903108
12                0.3246516
13                0.3814793
14                0.3255370
15                0.3867021
16                0.3267898
17                0.3896767</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(inequality_results, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plotting inequality among scenarios and years</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data as before</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>inequality_results_long <span class="ot">&lt;-</span> inequality_results <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">as.integer</span>(<span class="fu">sub</span>(<span class="st">"aecons_(</span><span class="sc">\\</span><span class="st">d{4}).*"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, Income.Variable)),</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario =</span> <span class="fu">sub</span>(<span class="st">"aecons_</span><span class="sc">\\</span><span class="st">d{4}_?"</span>, <span class="st">""</span>, Income.Variable),</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario =</span> <span class="fu">ifelse</span>(scenario <span class="sc">==</span> <span class="st">""</span>, <span class="st">"2023"</span>, scenario)</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">!=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario =</span> <span class="fu">factor</span>(scenario),</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="fu">factor</span>(year),</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Poverty_Headcount =</span> <span class="dv">100</span> <span class="sc">*</span> FGT..alpha.<span class="dv">0</span>....Poverty.Headcount,</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Poverty_Gap =</span> <span class="dv">100</span> <span class="sc">*</span> FGT..alpha.<span class="dv">1</span>....Poverty.Gap,</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Poverty_Severity =</span> <span class="dv">100</span> <span class="sc">*</span> FGT..alpha.<span class="dv">2</span>....Poverty.Severity</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, scenario, Poverty_Headcount, Poverty_Gap, Poverty_Severity) <span class="sc">%&gt;%</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(Poverty_Headcount, Poverty_Gap, Poverty_Severity),</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Measure"</span>,</span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Measure =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(<span class="fu">as.character</span>(Measure),</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty_Headcount"</span> <span class="ot">=</span> <span class="st">"Poverty Headcount"</span>,</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty_Gap"</span> <span class="ot">=</span> <span class="st">"Poverty Gap"</span>,</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Poverty_Severity"</span> <span class="ot">=</span> <span class="st">"Poverty Severity"</span></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with value labels</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(inequality_results_long, <span class="fu">aes</span>(<span class="at">x =</span> scenario, <span class="at">y =</span> Value, <span class="at">fill =</span> scenario)) <span class="sc">+</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>), <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">sprintf</span>(<span class="st">"%.1f"</span>, Value)),</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.9</span>)) <span class="sc">+</span></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Measure <span class="sc">~</span> year, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-40"><a href="#cb80-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Poverty Metrics by Scenario and Year"</span>,</span>
<span id="cb80-41"><a href="#cb80-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Scenario"</span>,</span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Value (%)"</span>,</span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Scenario"</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">11</span>) <span class="sc">+</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="geo-microsimulation_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Changes by region</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>poor_2030_cc_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_baseline_cc) <span class="sc">|&gt;</span>  </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_cc =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_baseline_cc,</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_cc)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_baseline) <span class="sc">|&gt;</span>  </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_baseline,</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_baseline)</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_2050_baseline, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="maps" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Maps</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>poor_2023_region <span class="ot">&lt;-</span> ca_microsim06  <span class="sc">|&gt;</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2023) <span class="sc">|&gt;</span>  </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2023 =</span> <span class="fu">sum</span>(hh_weight_2023 <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2023,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2023)</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>poor_2023_region_map <span class="ot">&lt;-</span> adm1 <span class="sc">|&gt;</span> </span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2023_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb86-28"><a href="#cb86-28" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb86-29"><a href="#cb86-29" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Racha-Lechkhumi</span><span class="sc">\n</span><span class="st">and Kvemo Svaneti"</span>,</span>
<span id="cb86-30"><a href="#cb86-30" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samegrelo-Zemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb86-31"><a href="#cb86-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samegrelo-</span><span class="sc">\n</span><span class="st">Zemo</span><span class="sc">\n</span><span class="st">Svaneti"</span>,</span>
<span id="cb86-32"><a href="#cb86-32" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Mtskheta-Mtianeti"</span> <span class="sc">~</span></span>
<span id="cb86-33"><a href="#cb86-33" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Mtskheta-</span><span class="sc">\n</span><span class="st">Mtianeti"</span>,</span>
<span id="cb86-34"><a href="#cb86-34" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samtskhe-Javakheti"</span> <span class="sc">~</span></span>
<span id="cb86-35"><a href="#cb86-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samtskhe-</span><span class="sc">\n</span><span class="st">Javakheti"</span>,</span>
<span id="cb86-36"><a href="#cb86-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb86-37"><a href="#cb86-37" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb86-38"><a href="#cb86-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb86-39"><a href="#cb86-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(pct_poor), </span>
<span id="cb86-40"><a href="#cb86-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb86-41"><a href="#cb86-41" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb86-42"><a href="#cb86-42" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb86-43"><a href="#cb86-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, pct_poor)</span>
<span id="cb86-44"><a href="#cb86-44" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb86-45"><a href="#cb86-45" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb86-46"><a href="#cb86-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-47"><a href="#cb86-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-48"><a href="#cb86-48" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb86-49"><a href="#cb86-49" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2023_region_map) <span class="sc">+</span></span>
<span id="cb86-50"><a href="#cb86-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"pct_poor"</span>,</span>
<span id="cb86-51"><a href="#cb86-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">"Percent"</span>, </span>
<span id="cb86-52"><a href="#cb86-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb86-53"><a href="#cb86-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb86-54"><a href="#cb86-54" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale =</span> <span class="fl">0.5</span>,</span>
<span id="cb86-55"><a href="#cb86-55" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">35</span>),</span>
<span id="cb86-56"><a href="#cb86-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"YlOrRd"</span>,</span>
<span id="cb86-57"><a href="#cb86-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">textNA =</span> <span class="st">"Unavailable"</span>,</span>
<span id="cb86-58"><a href="#cb86-58" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey"</span></span>
<span id="cb86-59"><a href="#cb86-59" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb86-60"><a href="#cb86-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_poor_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb86-61"><a href="#cb86-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb86-62"><a href="#cb86-62" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.outside = TRUE,</span></span>
<span id="cb86-63"><a href="#cb86-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb86-64"><a href="#cb86-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#title.snap.to.legend = FALSE,</span></span>
<span id="cb86-65"><a href="#cb86-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> </span>
<span id="cb86-66"><a href="#cb86-66" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Percent below poverty line"</span>,</span>
<span id="cb86-67"><a href="#cb86-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb86-68"><a href="#cb86-68" aria-hidden="true" tabindex="-1"></a><span class="co">#            outer.margins=c(.10,.10, .10, .10), </span></span>
<span id="cb86-69"><a href="#cb86-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb86-70"><a href="#cb86-70" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb86-71"><a href="#cb86-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-72"><a href="#cb86-72" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb86-73"><a href="#cb86-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb86-74"><a href="#cb86-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poverty_by_region.svg",</span></span>
<span id="cb86-75"><a href="#cb86-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb86-76"><a href="#cb86-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb86-77"><a href="#cb86-77" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in"</span></span>
<span id="cb86-78"><a href="#cb86-78" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb86-79"><a href="#cb86-79" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb86-80"><a href="#cb86-80" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb86-81"><a href="#cb86-81" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poverty_by_region.png",</span></span>
<span id="cb86-82"><a href="#cb86-82" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb86-83"><a href="#cb86-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb86-84"><a href="#cb86-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in",</span></span>
<span id="cb86-85"><a href="#cb86-85" aria-hidden="true" tabindex="-1"></a><span class="co">#   dpi = 300</span></span>
<span id="cb86-86"><a href="#cb86-86" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb86-87"><a href="#cb86-87" aria-hidden="true" tabindex="-1"></a>map_object</span>
<span id="cb86-88"><a href="#cb86-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-89"><a href="#cb86-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-90"><a href="#cb86-90" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(poor_numbers, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-exposed-and-poor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exposed-and-poor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="geo-microsimulation_files/figure-html/fig-exposed-and-poor-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exposed-and-poor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Percent below poverty line by region
</figcaption>
</figure>
</div>
</div>
</div>
<p>Map request: Increase in poverty between Baseline and NZS and between Baseline and Hot/Dry at the regional level for 2030.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_baseline) <span class="sc">|&gt;</span>  </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_baseline,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_baseline)</span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_baseline =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_baseline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>poor_2030_nzs_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_nzs) <span class="sc">|&gt;</span>  </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_nzs,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_nzs)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_nzs =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_nzs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>poor_2030_dryhot_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_dryhot) <span class="sc">|&gt;</span>  </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_dryhot,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_dryhot)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_dryhot =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_dryhot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>poor_2030_scenarios_diff <span class="ot">&lt;-</span> poor_2030_baseline_region <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_nzs_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_dryhot_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_nzs_diff =</span> (poor_2030_nzs <span class="sc">-</span> poor_2030_baseline)<span class="sc">/</span>poor_2030_baseline <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_dryhot_diff =</span> (poor_2030_dryhot <span class="sc">-</span> poor_2030_baseline) <span class="sc">/</span> poor_2030_baseline <span class="sc">*</span><span class="dv">100</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we map it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>poor_2030_scenarios_diff_map <span class="ot">&lt;-</span> adm1 <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_scenarios_diff, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Racha-Lechkhumi</span><span class="sc">\n</span><span class="st">and Kvemo Svaneti"</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samegrelo-Zemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samegrelo-</span><span class="sc">\n</span><span class="st">Zemo</span><span class="sc">\n</span><span class="st">Svaneti"</span>,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Mtskheta-Mtianeti"</span> <span class="sc">~</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Mtskheta-</span><span class="sc">\n</span><span class="st">Mtianeti"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samtskhe-Javakheti"</span> <span class="sc">~</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samtskhe-</span><span class="sc">\n</span><span class="st">Javakheti"</span>,</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_nzs_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(poor_2030_nzs_diff), </span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, poor_2030_nzs_diff)</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_dryhot_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(poor_2030_dryhot_diff), </span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, poor_2030_dryhot_diff)</span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-33"><a href="#cb94-33" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb94-34"><a href="#cb94-34" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2030_scenarios_diff_map) <span class="sc">+</span></span>
<span id="cb94-35"><a href="#cb94-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"poor_2030_nzs_diff"</span>,</span>
<span id="cb94-36"><a href="#cb94-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">"Percent"</span>, </span>
<span id="cb94-37"><a href="#cb94-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb94-38"><a href="#cb94-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb94-39"><a href="#cb94-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale =</span> <span class="fl">0.5</span>,</span>
<span id="cb94-40"><a href="#cb94-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb94-41"><a href="#cb94-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"-RdYlGn"</span>,</span>
<span id="cb94-42"><a href="#cb94-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">textNA =</span> <span class="st">"Unavailable"</span>,</span>
<span id="cb94-43"><a href="#cb94-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey"</span></span>
<span id="cb94-44"><a href="#cb94-44" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb94-45"><a href="#cb94-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_nzs_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb94-46"><a href="#cb94-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb94-47"><a href="#cb94-47" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.outside = TRUE,</span></span>
<span id="cb94-48"><a href="#cb94-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb94-49"><a href="#cb94-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#title.snap.to.legend = FALSE,</span></span>
<span id="cb94-50"><a href="#cb94-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> </span>
<span id="cb94-51"><a href="#cb94-51" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Percent difference between NZS and Baseline"</span>,</span>
<span id="cb94-52"><a href="#cb94-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb94-53"><a href="#cb94-53" aria-hidden="true" tabindex="-1"></a><span class="co">#            outer.margins=c(.10,.10, .10, .10), </span></span>
<span id="cb94-54"><a href="#cb94-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb94-55"><a href="#cb94-55" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── tmap v3 code detected ───────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[v3-&gt;v4] `tm_polygons()`: instead of `style = "fixed"`, use fill.scale =
`tm_scale_intervals()`.
ℹ Migrate the argument(s) 'style', 'breaks', 'palette' (rename to 'values'),
  'colorNA' (rename to 'value.na'), 'textNA' (rename to 'label.na') to
  'tm_scale_intervals(&lt;HERE&gt;)'
For small multiples, specify a 'tm_scale_' for each multiple, and put them in a
list: 'fill'.scale = list(&lt;scale1&gt;, &lt;scale2&gt;, ...)'
[v3-&gt;v4] `tm_polygons()`: migrate the argument(s) related to the legend of the
visual variable `fill` namely 'title' to 'fill.legend = tm_legend(&lt;HERE&gt;)'
[tm_polygons()] Argument `scale` unknown.
[v3-&gt;v4] `tm_layout()`: use `tm_title()` instead of `tm_layout(title = )`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_nzs_diff.png",</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in",</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   dpi = 300</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_nzs_diff.svg",</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in"</span></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2030_scenarios_diff_map) <span class="sc">+</span></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"poor_2030_dryhot_diff"</span>,</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">"Percent"</span>, </span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">legend.show =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale =</span> <span class="fl">0.5</span>,</span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"-RdYlGn"</span>,</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">textNA =</span> <span class="st">"Unavailable"</span>,</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey"</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_dryhot_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.outside = TRUE,</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">#title.snap.to.legend = FALSE,</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> </span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Percent difference between Dry/Hot and Baseline"</span>,</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a><span class="co">#            outer.margins=c(.10,.10, .10, .10), </span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[v3-&gt;v4] `tm_polygons()`: migrate the argument(s) related to the legend of the
visual variable `fill` namely 'title' to 'fill.legend = tm_legend(&lt;HERE&gt;)'
[tm_polygons()] Argument `scale` unknown.
[v3-&gt;v4] `tm_layout()`: use `tm_title()` instead of `tm_layout(title = )`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_dryhot_diff.png",</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in",</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   dpi = 300</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_dryhot_diff.svg",</span></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in"</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Map request: Increase in poverty between Baseline and NZS + PC and between Baseline and Hot/Dry + PC at the regional level for 2030. Effects of prices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>poor_2030_baseline_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_baseline) <span class="sc">|&gt;</span>  </span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_baseline =</span> <span class="fu">sum</span>(hh_weight_2030_baseline <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_baseline,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_baseline)</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_baseline =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_baseline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>poor_2030_nzs_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_nzs_pc) <span class="sc">|&gt;</span>  </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_nzs =</span> <span class="fu">sum</span>(hh_weight_2030_nzs <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_nzs_pc,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_nzs)</span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_nzs =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_nzs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>poor_2030_dryhot_region <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo,poor_2030_dryhot_pc) <span class="sc">|&gt;</span>  </span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no_hh_2023 = sum(weight_2023, na.rm = TRUE),</span></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp_2030_dryhot =</span> <span class="fu">sum</span>(hh_weight_2030_dryhot <span class="sc">*</span> hhsize, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> RegNo,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> poor_2030_dryhot_pc,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># no_hh_2023,</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>      no_pp_2030_dryhot)</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">RegNo =</span> <span class="fu">as.integer</span>(RegNo),</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_poor =</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">/</span> (<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span>))<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_dryhot =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>,</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">non_poor =</span> <span class="st">`</span><span class="at">0</span><span class="st">`</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(RegNo, poor_2030_dryhot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'RegNo'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>poor_2030_scenarios_pc_diff <span class="ot">&lt;-</span> poor_2030_baseline_region <span class="sc">|&gt;</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_nzs_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_dryhot_region, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_nzs_diff =</span> (poor_2030_nzs <span class="sc">-</span> poor_2030_baseline)<span class="sc">/</span>poor_2030_baseline <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">poor_2030_dryhot_diff =</span> (poor_2030_dryhot <span class="sc">-</span> poor_2030_baseline) <span class="sc">/</span> poor_2030_baseline <span class="sc">*</span><span class="dv">100</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And now we map it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>poor_2030_scenarios_pc_diff_map <span class="ot">&lt;-</span> adm1 <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(poor_2030_scenarios_pc_diff, <span class="fu">join_by</span>(RegNo)) <span class="sc">|&gt;</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="fu">case_when</span>(</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Racha-Lechkhumi and Kvemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Racha-Lechkhumi</span><span class="sc">\n</span><span class="st">and Kvemo Svaneti"</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samegrelo-Zemo Svaneti"</span> <span class="sc">~</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samegrelo-</span><span class="sc">\n</span><span class="st">Zemo</span><span class="sc">\n</span><span class="st">Svaneti"</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Mtskheta-Mtianeti"</span> <span class="sc">~</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Mtskheta-</span><span class="sc">\n</span><span class="st">Mtianeti"</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>      region <span class="sc">==</span> <span class="st">"Samtskhe-Javakheti"</span> <span class="sc">~</span></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Samtskhe-</span><span class="sc">\n</span><span class="st">Javakheti"</span>,</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> region</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_nzs_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(poor_2030_nzs_diff), </span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, poor_2030_nzs_diff)</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_dryhot_label =</span> <span class="fu">if_else</span>(</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(poor_2030_dryhot_diff), </span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Unavailable"</span>,</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>        region,</span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sprintf</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">%.1f%%"</span>, poor_2030_dryhot_diff)</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2030_scenarios_pc_diff_map) <span class="sc">+</span></span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"poor_2030_nzs_diff"</span>,</span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(</span>
<span id="cb108-37"><a href="#cb108-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb108-38"><a href="#cb108-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb108-39"><a href="#cb108-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>, <span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>),</span>
<span id="cb108-40"><a href="#cb108-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">values =</span> <span class="st">"-brewer.rd_yl_gn"</span>,</span>
<span id="cb108-41"><a href="#cb108-41" aria-hidden="true" tabindex="-1"></a>                <span class="at">value.na =</span> <span class="cn">NA</span>,</span>
<span id="cb108-42"><a href="#cb108-42" aria-hidden="true" tabindex="-1"></a>                <span class="at">label.na =</span> <span class="st">"Unavailable"</span>),</span>
<span id="cb108-43"><a href="#cb108-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(</span>
<span id="cb108-44"><a href="#cb108-44" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Percent"</span>)</span>
<span id="cb108-45"><a href="#cb108-45" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb108-46"><a href="#cb108-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Percent difference between</span><span class="sc">\n</span><span class="st">NZS + PC and Baseline"</span>) <span class="sc">+</span></span>
<span id="cb108-47"><a href="#cb108-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_nzs_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb108-48"><a href="#cb108-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb108-49"><a href="#cb108-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#legend.outside = TRUE,</span></span>
<span id="cb108-50"><a href="#cb108-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb108-51"><a href="#cb108-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb108-52"><a href="#cb108-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb108-53"><a href="#cb108-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb108-54"><a href="#cb108-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-55"><a href="#cb108-55" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb108-56"><a href="#cb108-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb108-57"><a href="#cb108-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_nzs_pc_diff.png",</span></span>
<span id="cb108-58"><a href="#cb108-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb108-59"><a href="#cb108-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb108-60"><a href="#cb108-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in",</span></span>
<span id="cb108-61"><a href="#cb108-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   dpi = 300</span></span>
<span id="cb108-62"><a href="#cb108-62" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb108-63"><a href="#cb108-63" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb108-64"><a href="#cb108-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb108-65"><a href="#cb108-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_nzs_pc_diff.svg",</span></span>
<span id="cb108-66"><a href="#cb108-66" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb108-67"><a href="#cb108-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb108-68"><a href="#cb108-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in"</span></span>
<span id="cb108-69"><a href="#cb108-69" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb108-70"><a href="#cb108-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-71"><a href="#cb108-71" aria-hidden="true" tabindex="-1"></a>map_object <span class="ot">&lt;-</span></span>
<span id="cb108-72"><a href="#cb108-72" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(poor_2030_scenarios_pc_diff_map) <span class="sc">+</span></span>
<span id="cb108-73"><a href="#cb108-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="st">"poor_2030_dryhot_diff"</span>,</span>
<span id="cb108-74"><a href="#cb108-74" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(</span>
<span id="cb108-75"><a href="#cb108-75" aria-hidden="true" tabindex="-1"></a>                <span class="at">style =</span> <span class="st">"fixed"</span>,</span>
<span id="cb108-76"><a href="#cb108-76" aria-hidden="true" tabindex="-1"></a>                <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb108-77"><a href="#cb108-77" aria-hidden="true" tabindex="-1"></a>                <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">12</span>),</span>
<span id="cb108-78"><a href="#cb108-78" aria-hidden="true" tabindex="-1"></a>                <span class="at">values =</span> <span class="st">"-brewer.rd_yl_gn"</span>,</span>
<span id="cb108-79"><a href="#cb108-79" aria-hidden="true" tabindex="-1"></a>                <span class="at">value.na =</span> <span class="cn">NA</span>,</span>
<span id="cb108-80"><a href="#cb108-80" aria-hidden="true" tabindex="-1"></a>                <span class="at">label.na =</span> <span class="st">"Unavailable"</span>),</span>
<span id="cb108-81"><a href="#cb108-81" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(</span>
<span id="cb108-82"><a href="#cb108-82" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">"Percent"</span>)</span>
<span id="cb108-83"><a href="#cb108-83" aria-hidden="true" tabindex="-1"></a>              ) <span class="sc">+</span></span>
<span id="cb108-84"><a href="#cb108-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="fu">c</span>(<span class="st">"pct_dryhot_label"</span>), <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb108-85"><a href="#cb108-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">"Percent difference between</span><span class="sc">\n</span><span class="st">Dry/Hot + PC and Baseline"</span>) <span class="sc">+</span></span>
<span id="cb108-86"><a href="#cb108-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb108-87"><a href="#cb108-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">"right"</span>, <span class="st">"top"</span>),</span>
<span id="cb108-88"><a href="#cb108-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb108-89"><a href="#cb108-89" aria-hidden="true" tabindex="-1"></a><span class="co">#           outer.margins=c(.10,.10, .10, .10), </span></span>
<span id="cb108-90"><a href="#cb108-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.position =</span> <span class="fu">c</span>(<span class="st">'left'</span>, <span class="st">'bottom'</span>),</span>
<span id="cb108-91"><a href="#cb108-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.9</span>)</span>
<span id="cb108-92"><a href="#cb108-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-93"><a href="#cb108-93" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb108-94"><a href="#cb108-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb108-95"><a href="#cb108-95" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_dryhot_pc_diff.png",</span></span>
<span id="cb108-96"><a href="#cb108-96" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb108-97"><a href="#cb108-97" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb108-98"><a href="#cb108-98" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in",</span></span>
<span id="cb108-99"><a href="#cb108-99" aria-hidden="true" tabindex="-1"></a><span class="co">#   dpi = 300</span></span>
<span id="cb108-100"><a href="#cb108-100" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb108-101"><a href="#cb108-101" aria-hidden="true" tabindex="-1"></a><span class="co"># tmap_save(</span></span>
<span id="cb108-102"><a href="#cb108-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   map_object,</span></span>
<span id="cb108-103"><a href="#cb108-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/vulnerability_img/other/poor_2030_dryhot_pc_diff.svg",</span></span>
<span id="cb108-104"><a href="#cb108-104" aria-hidden="true" tabindex="-1"></a><span class="co">#   width = 8,</span></span>
<span id="cb108-105"><a href="#cb108-105" aria-hidden="true" tabindex="-1"></a><span class="co">#   height = 5,</span></span>
<span id="cb108-106"><a href="#cb108-106" aria-hidden="true" tabindex="-1"></a><span class="co">#   units = "in"</span></span>
<span id="cb108-107"><a href="#cb108-107" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Maps show a very interesting behavior in Mtskheta-Mtianeti, where most of the changes in poverty between scenarios concentrate. Here, we will explore a few possible pathways to explain why that is happening.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>lmarket_region <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region, lmarket) <span class="sc">|&gt;</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pp_labor =</span> <span class="fu">sum</span>(weight_2030_dryhot, <span class="at">na.rm =</span> T)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> region,</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> lmarket,</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> pp_labor</span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regions[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)], <span class="fu">join_by</span>(region <span class="sc">==</span> RegNo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'region'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(lmarket_region, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Employment does not appear to be the culprit as changes between scenarios appear similar for all regions. Now we will explore changes in sources of income.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>income_regions <span class="ot">&lt;-</span> pp_microsim13 <span class="sc">|&gt;</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(lmarket <span class="sc">&lt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(region) <span class="sc">|&gt;</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab_inc_baseline =</span> <span class="fu">sum</span>(monthly_labor_income_2030_baseline <span class="sc">*</span> weight_2030_baseline, <span class="at">na.rm =</span> T),</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab_inc_dryhot =</span> <span class="fu">sum</span>(monthly_labor_income_2030_dryhot <span class="sc">*</span> weight_2030_dryhot, <span class="at">na.rm =</span> T),</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab_inc_nzs =</span> <span class="fu">sum</span>(monthly_labor_income_2030_nzs <span class="sc">*</span> weight_2030_nzs, <span class="at">na.rm =</span> T)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regions[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)], <span class="fu">join_by</span>(region <span class="sc">==</span> RegNo))</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(income_regions, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Income does not give us any particular indications either, so the last thing we can check out is the share that labor income has in this region versus other regions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>income_share_regions <span class="ot">&lt;-</span> ic_microsim01 <span class="sc">|&gt;</span> </span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(hh_basics, <span class="fu">join_by</span>(UID)) <span class="sc">|&gt;</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">weight_2023 =</span> Weights<span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">shr_lab =</span> (<span class="fu">coalesce</span>(labor_income_2023,<span class="fl">0.0001</span>) <span class="sc">+</span> <span class="fu">coalesce</span>(self_employment_income_2023,<span class="dv">0</span>)) <span class="sc">/</span> totalinc_2023,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">shr_agr =</span> <span class="fu">coalesce</span>(agr_income_2023,<span class="fl">0.0001</span>)<span class="sc">/</span>totalinc_2023,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">shr_ssp =</span> <span class="fu">coalesce</span>(PensStipDaxm,<span class="fl">0.0001</span>)<span class="sc">/</span>totalinc_2023,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">shr_rem =</span> <span class="fu">coalesce</span>(Ucxoetidan,<span class="fl">0.0001</span>)<span class="sc">/</span>totalinc_2023,</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">shr_csh =</span> <span class="fu">coalesce</span>(Axloblebisagan,<span class="fl">0.0001</span>)<span class="sc">/</span>totalinc_2023</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo) <span class="sc">|&gt;</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_shr_lab =</span> <span class="fu">weighted.mean</span>(shr_lab, weight_2023, <span class="at">na.rm =</span> T),</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_shr_agr =</span> <span class="fu">weighted.mean</span>(shr_agr, weight_2023, <span class="at">na.rm =</span> T),</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_shr_ssp =</span> <span class="fu">weighted.mean</span>(shr_ssp, weight_2023, <span class="at">na.rm =</span> T),</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_shr_rem =</span> <span class="fu">weighted.mean</span>(shr_rem, weight_2023, <span class="at">na.rm =</span> T),</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_shr_csh =</span> <span class="fu">weighted.mean</span>(shr_csh, weight_2023, <span class="at">na.rm =</span> T)</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regions[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)], <span class="fu">join_by</span>(RegNo <span class="sc">==</span> RegNo))</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(income_share_regions, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This exploration did not yield anything noteworthy. So, now we turn our attention to distance above poverty line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>distance_pl <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(aecons_2023 <span class="sc">&gt;</span> pline0) <span class="sc">|&gt;</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_above_pl =</span> <span class="fu">coalesce</span>(aecons_2023,<span class="dv">0</span>) <span class="sc">-</span> pline0</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(RegNo) <span class="sc">|&gt;</span> </span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_distance_above_pl =</span> <span class="fu">weighted.mean</span>(distance_above_pl, weights)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(regions[,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)], <span class="fu">join_by</span>(RegNo <span class="sc">==</span> RegNo))</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>distance_pl <span class="sc">|&gt;</span> </span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="rmdrbpwhfg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rmdrbpwhfg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rmdrbpwhfg thead, #rmdrbpwhfg tbody, #rmdrbpwhfg tfoot, #rmdrbpwhfg tr, #rmdrbpwhfg td, #rmdrbpwhfg th {
  border-style: none;
}

#rmdrbpwhfg p {
  margin: 0;
  padding: 0;
}

#rmdrbpwhfg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rmdrbpwhfg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rmdrbpwhfg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rmdrbpwhfg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rmdrbpwhfg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmdrbpwhfg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmdrbpwhfg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rmdrbpwhfg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rmdrbpwhfg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rmdrbpwhfg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rmdrbpwhfg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rmdrbpwhfg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rmdrbpwhfg .gt_spanner_row {
  border-bottom-style: hidden;
}

#rmdrbpwhfg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rmdrbpwhfg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rmdrbpwhfg .gt_from_md > :first-child {
  margin-top: 0;
}

#rmdrbpwhfg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rmdrbpwhfg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rmdrbpwhfg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rmdrbpwhfg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rmdrbpwhfg .gt_row_group_first td {
  border-top-width: 2px;
}

#rmdrbpwhfg .gt_row_group_first th {
  border-top-width: 2px;
}

#rmdrbpwhfg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmdrbpwhfg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rmdrbpwhfg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rmdrbpwhfg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmdrbpwhfg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmdrbpwhfg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rmdrbpwhfg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rmdrbpwhfg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rmdrbpwhfg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rmdrbpwhfg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmdrbpwhfg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmdrbpwhfg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rmdrbpwhfg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rmdrbpwhfg .gt_left {
  text-align: left;
}

#rmdrbpwhfg .gt_center {
  text-align: center;
}

#rmdrbpwhfg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rmdrbpwhfg .gt_font_normal {
  font-weight: normal;
}

#rmdrbpwhfg .gt_font_bold {
  font-weight: bold;
}

#rmdrbpwhfg .gt_font_italic {
  font-style: italic;
}

#rmdrbpwhfg .gt_super {
  font-size: 65%;
}

#rmdrbpwhfg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rmdrbpwhfg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rmdrbpwhfg .gt_indent_1 {
  text-indent: 5px;
}

#rmdrbpwhfg .gt_indent_2 {
  text-indent: 10px;
}

#rmdrbpwhfg .gt_indent_3 {
  text-indent: 15px;
}

#rmdrbpwhfg .gt_indent_4 {
  text-indent: 20px;
}

#rmdrbpwhfg .gt_indent_5 {
  text-indent: 25px;
}

#rmdrbpwhfg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rmdrbpwhfg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="RegNo" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Region</th>
<th id="avg_distance_above_pl" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">avg_distance_above_pl</th>
<th id="ADM1_EN" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">ADM1_EN</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">0</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">399.8268</td>
<td class="gt_row gt_left" headers="ADM1_EN">Kakheti</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="RegNo">1</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">382.7393</td>
<td class="gt_row gt_left" headers="ADM1_EN">Tbilisi</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">2</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">322.7042</td>
<td class="gt_row gt_left" headers="ADM1_EN">Shida Kartli</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="RegNo">3</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">266.1606</td>
<td class="gt_row gt_left" headers="ADM1_EN">Kvemo Kartli</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">5</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">312.6785</td>
<td class="gt_row gt_left" headers="ADM1_EN">Samtskhe-Javakheti</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="RegNo">7</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">319.0661</td>
<td class="gt_row gt_left" headers="ADM1_EN">Autonomous Republic of Adjara</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">8</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">243.1254</td>
<td class="gt_row gt_left" headers="ADM1_EN">Guria</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="RegNo">9</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">333.1285</td>
<td class="gt_row gt_left" headers="ADM1_EN">Samegrelo-Zemo Svaneti</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">10</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">381.0584</td>
<td class="gt_row gt_left" headers="ADM1_EN">Imereti</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="RegNo">11</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">247.5373</td>
<td class="gt_row gt_left" headers="ADM1_EN">Mtskheta-Mtianeti</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="RegNo">13</td>
<td class="gt_row gt_right" headers="avg_distance_above_pl">296.9857</td>
<td class="gt_row gt_left" headers="ADM1_EN">Racha-Lechkhumi and Kvemo Svaneti</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(distance_pl, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And sure enough, the combination between mean distance above the poverty line, the share of total income that comes from labor, and the share of workers in manufacture explain the regional results quite well.</p>
<p>Now we need to explain why impacts from prices are so relevant and the only mechanism that we used for that was rurality, quintiles, and adult equivalent consumption, so we will explore once again the distance above the poverty line and the changes by region, urban/rural, and quintile.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>distance_pl <span class="ot">&lt;-</span> ca_microsim06 <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(RegNo==8) |&gt; </span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distance_above_pl =</span> <span class="fu">if_else</span>(</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>      aecons_2030_baseline <span class="sc">&gt;</span> pline0,</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coalesce</span>(aecons_2030_baseline,<span class="dv">0</span>) <span class="sc">-</span> pline0,</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>),</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp =</span> hh_weight_2030_baseline <span class="sc">*</span> hhsize</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type, quintiles_2030_baseline) <span class="sc">|&gt;</span> </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_distance_above_pl =</span> <span class="fu">weighted.mean</span>(distance_above_pl, hh_weight_2030_baseline),</span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">no_pp =</span> <span class="fu">sum</span>(no_pp, <span class="at">na.rm =</span> T)</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'type'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>distance_pl <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="lobxqbtohm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lobxqbtohm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lobxqbtohm thead, #lobxqbtohm tbody, #lobxqbtohm tfoot, #lobxqbtohm tr, #lobxqbtohm td, #lobxqbtohm th {
  border-style: none;
}

#lobxqbtohm p {
  margin: 0;
  padding: 0;
}

#lobxqbtohm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lobxqbtohm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lobxqbtohm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lobxqbtohm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lobxqbtohm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lobxqbtohm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lobxqbtohm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lobxqbtohm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lobxqbtohm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lobxqbtohm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lobxqbtohm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lobxqbtohm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lobxqbtohm .gt_spanner_row {
  border-bottom-style: hidden;
}

#lobxqbtohm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lobxqbtohm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lobxqbtohm .gt_from_md > :first-child {
  margin-top: 0;
}

#lobxqbtohm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lobxqbtohm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lobxqbtohm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lobxqbtohm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lobxqbtohm .gt_row_group_first td {
  border-top-width: 2px;
}

#lobxqbtohm .gt_row_group_first th {
  border-top-width: 2px;
}

#lobxqbtohm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lobxqbtohm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lobxqbtohm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lobxqbtohm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lobxqbtohm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lobxqbtohm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lobxqbtohm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lobxqbtohm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lobxqbtohm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lobxqbtohm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lobxqbtohm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lobxqbtohm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lobxqbtohm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lobxqbtohm .gt_left {
  text-align: left;
}

#lobxqbtohm .gt_center {
  text-align: center;
}

#lobxqbtohm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lobxqbtohm .gt_font_normal {
  font-weight: normal;
}

#lobxqbtohm .gt_font_bold {
  font-weight: bold;
}

#lobxqbtohm .gt_font_italic {
  font-style: italic;
}

#lobxqbtohm .gt_super {
  font-size: 65%;
}

#lobxqbtohm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lobxqbtohm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lobxqbtohm .gt_indent_1 {
  text-indent: 5px;
}

#lobxqbtohm .gt_indent_2 {
  text-indent: 10px;
}

#lobxqbtohm .gt_indent_3 {
  text-indent: 15px;
}

#lobxqbtohm .gt_indent_4 {
  text-indent: 20px;
}

#lobxqbtohm .gt_indent_5 {
  text-indent: 25px;
}

#lobxqbtohm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#lobxqbtohm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="quintiles_2030_baseline" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">quintiles_2030_baseline</th>
<th id="avg_distance_above_pl" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">avg_distance_above_pl</th>
<th id="no_pp" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">no_pp</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="gt_group_heading_row odd">
<td colspan="3" id="1" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">1</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_center" headers="1  quintiles_2030_baseline">1</td>
<td class="gt_row gt_right" headers="1  avg_distance_above_pl">135.92324</td>
<td class="gt_row gt_right" headers="1  no_pp">144168.1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="1  quintiles_2030_baseline">2</td>
<td class="gt_row gt_right" headers="1  avg_distance_above_pl">256.54157</td>
<td class="gt_row gt_right" headers="1  no_pp">246097.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="1  quintiles_2030_baseline">3</td>
<td class="gt_row gt_right" headers="1  avg_distance_above_pl">366.02585</td>
<td class="gt_row gt_right" headers="1  no_pp">299544.0</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="1  quintiles_2030_baseline">4</td>
<td class="gt_row gt_right" headers="1  avg_distance_above_pl">482.59890</td>
<td class="gt_row gt_right" headers="1  no_pp">382695.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="1  quintiles_2030_baseline">5</td>
<td class="gt_row gt_right" headers="1  avg_distance_above_pl">844.02204</td>
<td class="gt_row gt_right" headers="1  no_pp">540306.1</td>
</tr>
<tr class="gt_group_heading_row odd">
<td colspan="3" id="2" class="gt_group_heading" data-quarto-table-cell-role="th" scope="colgroup">2</td>
</tr>
<tr class="gt_row_group_first even">
<td class="gt_row gt_center" headers="2  quintiles_2030_baseline">1</td>
<td class="gt_row gt_right" headers="2  avg_distance_above_pl">97.93749</td>
<td class="gt_row gt_right" headers="2  no_pp">299836.2</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="2  quintiles_2030_baseline">2</td>
<td class="gt_row gt_right" headers="2  avg_distance_above_pl">209.90062</td>
<td class="gt_row gt_right" headers="2  no_pp">362159.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="2  quintiles_2030_baseline">3</td>
<td class="gt_row gt_right" headers="2  avg_distance_above_pl">296.78219</td>
<td class="gt_row gt_right" headers="2  no_pp">443811.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="2  quintiles_2030_baseline">4</td>
<td class="gt_row gt_right" headers="2  avg_distance_above_pl">427.74697</td>
<td class="gt_row gt_right" headers="2  no_pp">488240.7</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="2  quintiles_2030_baseline">5</td>
<td class="gt_row gt_right" headers="2  avg_distance_above_pl">707.38572</td>
<td class="gt_row gt_right" headers="2  no_pp">438078.8</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write.table(distance_pl, file = pipe("xclip -selection clipboard"), sep = "\t", row.names = FALSE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="save-to-excel" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Save to Excel</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wb &lt;- loadWorkbook("data/outputs/microsimulation_results.xlsx")</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="co"># names(wb)</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="co"># writeData(</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   wb, </span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Poverty", </span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   poor_2023 , </span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   startRow = 3, </span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   startCol = 1, </span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   rowNames = F,</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   na.string = "")</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a><span class="co"># writeData(</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   wb, </span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Poverty", </span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   poor_2030_baseline , </span></span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   startRow = 3 + (dim(poor_2023)[1] + 3) * 1, </span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   startCol = 1, </span></span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   rowNames = F,</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   na.string = "")</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a><span class="co"># writeData(</span></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   wb, </span></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   "Poverty", </span></span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   poor_2050_baseline , </span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   startRow = 3 + (dim(poor_2023)[1] + 3) * 2, </span></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   startCol = 1, </span></span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   rowNames = F,</span></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   na.string = "")</span></span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a><span class="co"># saveWorkbook(</span></span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   wb,</span></span>
<span id="cb120-29"><a href="#cb120-29" aria-hidden="true" tabindex="-1"></a><span class="co">#   "data/outputs/microsimulation_results.xlsx",</span></span>
<span id="cb120-30"><a href="#cb120-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   overwrite = T)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="end" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> End</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test &lt;- poverty |&gt; </span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(cpsc) |&gt; </span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarize(</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     hh_total = sum(weights, na.rm = T),</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     pp_total = sum(weights * hhsize, na.rm =T)</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-geostat_integrated_2023" class="csl-entry" role="listitem">
GEOSTAT. (2023). <em>Integrated <span>Living</span> <span>Conditions</span> <span>Survey</span> 2023</em>.
</div>
<div id="ref-strzepek_estimating_2024" class="csl-entry" role="listitem">
Strzepek, K., Boehlert, B., Castillo, D., &amp; Smet, K. (2024). <em>Estimating the <span>Economic</span> <span>Impacts</span> of <span>Climate</span> <span>Change</span> in <span>Armenia</span></em>. Industrial Economics, Incorporated / The World Bank.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/rvconsulting/geo-ccdr24/blob/master/supporting-materials/geo-microsimulation.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/rvconsulting/geo-ccdr24/issues" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>